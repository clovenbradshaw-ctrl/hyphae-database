"use strict";(self.webpackChunkhyphae_e2ee_client=self.webpackChunkhyphae_e2ee_client||[]).push([[481],{481:(e,t,r)=>{r.r(t),r.d(t,{initRustCrypto:()=>lc});var n={};r.r(n),r.d(n,{Attachment:()=>ce,BackupDecryptionKey:()=>ue,BackupKeys:()=>le,BackupSecretsBundle:()=>we,Base64EncodedPkMessage:()=>be,BaseMigrationData:()=>fe,CancelInfo:()=>me,CheckCode:()=>Se,CollectStrategy:()=>Ke,CrossSigningBootstrapRequests:()=>Ce,CrossSigningKeyExport:()=>Ee,CrossSigningStatus:()=>Me,Curve25519PublicKey:()=>qe,Curve25519SecretKey:()=>Te,DecryptedRoomEvent:()=>Ue,DecryptedToDeviceEvent:()=>Pe,DecryptionErrorCode:()=>x,DecryptionSettings:()=>ze,DehydratedDevice:()=>je,DehydratedDeviceKey:()=>We,DehydratedDevices:()=>Qe,Device:()=>He,DeviceId:()=>Xe,DeviceKey:()=>Ze,DeviceKeyAlgorithm:()=>tt,DeviceKeyAlgorithmName:()=>j,DeviceKeyId:()=>nt,DeviceKeyName:()=>L,DeviceLists:()=>st,Ecies:()=>ot,Ed25519PublicKey:()=>ct,Ed25519Signature:()=>ut,Emoji:()=>lt,EncryptedAttachment:()=>wt,EncryptionAlgorithm:()=>W,EncryptionInfo:()=>bt,EncryptionSettings:()=>ft,EstablishedEcies:()=>mt,EventId:()=>St,HistoryVisibility:()=>G,IdentityKeys:()=>Kt,InboundCreationResult:()=>Ct,InboundGroupSession:()=>Et,InvalidToDeviceEvent:()=>Mt,KeysBackupRequest:()=>qt,KeysClaimRequest:()=>Tt,KeysQueryRequest:()=>Ut,KeysUploadRequest:()=>Pt,LocalTrust:()=>Q,LoggerLevel:()=>J,MaybeSignature:()=>zt,MegolmDecryptionError:()=>jt,MegolmV1BackupKey:()=>Wt,Migration:()=>Qt,OlmMachine:()=>Ht,OtherUserIdentity:()=>Xt,OutboundCreationResult:()=>Zt,OwnUserIdentity:()=>tr,PickledInboundGroupSession:()=>nr,PickledSession:()=>sr,PkDecryption:()=>or,PkEncryption:()=>cr,PkMessage:()=>ur,PlainTextToDeviceEvent:()=>lr,ProcessedToDeviceEventType:()=>H,PutDehydratedDeviceRequest:()=>wr,Qr:()=>br,QrCode:()=>fr,QrCodeData:()=>mr,QrCodeMode:()=>Y,QrCodeScan:()=>Sr,QrState:()=>X,RehydratedDevice:()=>Kr,RequestType:()=>$,RoomId:()=>Cr,RoomKeyCounts:()=>Er,RoomKeyImportResult:()=>Mr,RoomKeyInfo:()=>qr,RoomKeyWithheldInfo:()=>Tr,RoomMessageRequest:()=>Ur,RoomSettings:()=>Pr,Sas:()=>zr,SecretsBundle:()=>jr,ServerName:()=>Wr,ShieldColor:()=>Z,ShieldState:()=>Qr,ShieldStateCode:()=>ee,Signature:()=>Hr,SignatureState:()=>te,SignatureUploadRequest:()=>Xr,SignatureVerification:()=>Zr,Signatures:()=>tn,StoreHandle:()=>nn,StoredRoomKeyBundleData:()=>_n,ToDeviceEncryptionInfo:()=>an,ToDeviceRequest:()=>gn,ToDeviceUnableToDecryptInfo:()=>dn,ToDeviceUnableToDecryptReason:()=>re,Tracing:()=>pn,TrustRequirement:()=>ne,UTDToDeviceEvent:()=>yn,UploadSigningKeysRequest:()=>hn,UserDevices:()=>vn,UserId:()=>kn,VerificationMethod:()=>ie,VerificationRequest:()=>Rn,VerificationRequestPhase:()=>se,Versions:()=>In,__wbg_Error_0497d5bdba9362e5:()=>Cn,__wbg_String_8f0eb39a4a4c2f66:()=>On,__wbg_Window_b0044ac7db258535:()=>En,__wbg_WorkerGlobalScope_b74cefefc62a37da:()=>Dn,__wbg_add_64c6e51ab0ed12dd:()=>Mn,__wbg_add_dd833f9f523abe36:()=>An,__wbg_at_5b2884630cb66ea6:()=>qn,__wbg_backupkeys_new:()=>Bn,__wbg_bound_0274374bea7f6bca:()=>Tn,__wbg_bound_eb572b424befade3:()=>Fn,__wbg_buffer_a1a27a0dfa70165d:()=>Un,__wbg_call_1b920c3ac0afee4b:()=>Vn,__wbg_call_36f1bbf64b4cf7c7:()=>Pn,__wbg_call_f2db6205e5c51dc8:()=>Nn,__wbg_call_fbe8be8bf6436ce5:()=>zn,__wbg_clearTimeout_5a54f8841c30079a:()=>xn,__wbg_clear_e6ec1cc113e1555e:()=>jn,__wbg_close_2079e209ea5709b5:()=>Ln,__wbg_code_5e459ca721f994f5:()=>Wn,__wbg_continue_7d9cdafc888cb902:()=>Gn,__wbg_count_2941fdbb8154c02d:()=>Qn,__wbg_count_5ceb291ba9a02b4b:()=>Jn,__wbg_createIndex_32ba53785b2ef24e:()=>Hn,__wbg_createIndex_a343510ba567e58c:()=>Yn,__wbg_createObjectStore_b1f08961900155dd:()=>Xn,__wbg_crosssigningbootstraprequests_new:()=>$n,__wbg_crosssigningkeyexport_new:()=>Zn,__wbg_crosssigningstatus_new:()=>ei,__wbg_crypto_574e78ad8b13b65f:()=>ti,__wbg_debug_58d16ea352cfbca1:()=>ri,__wbg_debug_ada37632f0e8cdde:()=>ni,__wbg_decryptedroomevent_new:()=>ii,__wbg_decryptedtodeviceevent_new:()=>si,__wbg_dehydrateddevice_new:()=>_i,__wbg_dehydrateddevicekey_new:()=>oi,__wbg_deleteObjectStore_7b427b19378475fd:()=>ai,__wbg_delete_1af2aac87b36c0f1:()=>ci,__wbg_delete_71b7921c73aa9378:()=>gi,__wbg_device_new:()=>ui,__wbg_deviceid_new:()=>di,__wbg_devicekey_new:()=>li,__wbg_devicekeyid_new:()=>pi,__wbg_done_4d01f352bade43b7:()=>wi,__wbg_emoji_new:()=>yi,__wbg_encryptedattachment_new:()=>bi,__wbg_encryptioninfo_new:()=>hi,__wbg_entries_41651c850143b957:()=>fi,__wbg_entries_c951fa14164704e7:()=>vi,__wbg_error_24afdcd463ac8bd9:()=>mi,__wbg_error_4e978abc9692c0c5:()=>ki,__wbg_error_51ecdd39ec054205:()=>Si,__wbg_error_7534b8e9a36f1ab4:()=>Ri,__wbg_from_12ff8e47307bd4c7:()=>Ki,__wbg_getAllKeys_fce3f6ef8201c450:()=>Ii,__wbg_getAll_22a744d3b40f0fb5:()=>Ci,__wbg_getAll_654e689108532352:()=>Oi,__wbg_getAll_864be044b219e256:()=>Ei,__wbg_getRandomValues_38a1ff1ea09f6cc7:()=>Di,__wbg_getRandomValues_b8f5dbd5f3995a9e:()=>Mi,__wbg_getTime_2afe67905d873e92:()=>Ai,__wbg_get_92470be87867c2e5:()=>qi,__wbg_get_a131a44bd1eb6979:()=>Bi,__wbg_get_a4719581b0d717ad:()=>Ti,__wbg_get_d37904b955701f99:()=>Fi,__wbg_getwithrefkey_1dc361bd10053bfe:()=>Ui,__wbg_global_b6f5c73312f62313:()=>Vi,__wbg_inboundgroupsession_new:()=>Pi,__wbg_index_405783ca8da5f008:()=>Ni,__wbg_indexedDB_317016dcb8a872d6:()=>zi,__wbg_indexedDB_601ec26c63e333de:()=>xi,__wbg_indexedDB_63b82e158eb67cbd:()=>ji,__wbg_info_e56933705c348038:()=>Li,__wbg_info_f3589034369581f6:()=>Wi,__wbg_instanceof_ArrayBuffer_a8b6f580b363f2bc:()=>Gi,__wbg_instanceof_Map_80cc65041c96417a:()=>Qi,__wbg_instanceof_Promise_66f94afc64d9039f:()=>Ji,__wbg_instanceof_Uint8Array_ca460677bc155827:()=>Hi,__wbg_invalidtodeviceevent_new:()=>Yi,__wbg_isArray_2a07fd175d45c496:()=>Xi,__wbg_isArray_5f090bed72bd4f89:()=>$i,__wbg_isSafeInteger_90d7c4674047d684:()=>Zi,__wbg_item_15285ca2d766f142:()=>es,__wbg_iterator_4068add5b2aef7a6:()=>ts,__wbg_key_a17a68df9ec1b180:()=>rs,__wbg_keysbackuprequest_new:()=>ns,__wbg_keysclaimrequest_new:()=>is,__wbg_keysqueryrequest_new:()=>ss,__wbg_keysuploadrequest_new:()=>_s,__wbg_length_471141fa24df24b2:()=>os,__wbg_length_ab6d22b5ead75c72:()=>as,__wbg_length_f00ec12454a5d9fd:()=>cs,__wbg_lowerBound_13c8e875a3fb9f7d:()=>gs,__wbg_maybesignature_new:()=>us,__wbg_megolmdecryptionerror_new:()=>ds,__wbg_message_2d95ea5aff0d63b9:()=>ls,__wbg_msCrypto_a61aeb35a24c1329:()=>ps,__wbg_name_2acff1e83d9735f9:()=>ws,__wbg_new_07b483f72211fd66:()=>ys,__wbg_new_58353953ad2097cc:()=>bs,__wbg_new_8a6f238a6ece86ea:()=>hs,__wbg_new_a2957aa5684de228:()=>fs,__wbg_new_a979b4b45bd55c7f:()=>vs,__wbg_new_b3a08d2910ee5170:()=>ms,__wbg_new_db7d9b0ee94df522:()=>ks,__wbg_new_e30c39c06edaabf2:()=>Ss,__wbg_new_e52b3efaaa774f96:()=>Rs,__wbg_newnoargs_ff528e72d35de39a:()=>Ks,__wbg_newwithbyteoffsetandlength_06e8c938173769b5:()=>Is,__wbg_newwithbyteoffsetandlength_3b01ecda099177e8:()=>Cs,__wbg_newwithlength_08f872dc1e3ada2e:()=>Os,__wbg_newwithlength_8a0d31010560ce9a:()=>Es,__wbg_newwithmessage_54042111509ba20c:()=>Ds,__wbg_next_8bb824d217961b5d:()=>Ms,__wbg_next_e2da48d8fff7439a:()=>As,__wbg_node_905d3e251edff8a2:()=>qs,__wbg_now_2c95c9de01293173:()=>Bs,__wbg_now_eb0821f3bd9f6529:()=>Ts,__wbg_objectStoreNames_e82275eb2d403a92:()=>Fs,__wbg_objectStore_b463d32c86d6b543:()=>Us,__wbg_oldVersion_af5af638a028177c:()=>Vs,__wbg_olmmachine_new:()=>Ps,__wbg_openCursor_7c13a2cd32c6258b:()=>Ns,__wbg_openCursor_a53133c898e0829c:()=>zs,__wbg_openCursor_dbd279400634ae67:()=>xs,__wbg_open_0f04f50fa4d98f67:()=>js,__wbg_open_b70fb421d97aad40:()=>Ls,__wbg_otheruseridentity_new:()=>Ws,__wbg_ownuseridentity_new:()=>Gs,__wbg_parse_c7ba327fb6231e7f:()=>Qs,__wbg_performance_7a3ffd0b17f663ad:()=>Js,__wbg_pickledinboundgroupsession_unwrap:()=>Hs,__wbg_pickledsession_unwrap:()=>Ys,__wbg_plaintexttodeviceevent_new:()=>Xs,__wbg_process_dc0fbacc7c1c06f7:()=>$s,__wbg_push_73fd7b5550ebf707:()=>Zs,__wbg_put_7f0b4dcc666f09e3:()=>e_,__wbg_putdehydrateddevicerequest_new:()=>t_,__wbg_qr_new:()=>r_,__wbg_queueMicrotask_46c1df247678729f:()=>n_,__wbg_queueMicrotask_8acf3ccb75ed8d11:()=>i_,__wbg_randomFillSync_ac0988aba3254290:()=>s_,__wbg_readyState_249e5707a38b7a7a:()=>__,__wbg_rehydrateddevice_new:()=>o_,__wbg_require_60cc747a6bc5215a:()=>a_,__wbg_resolve_0dac8c580ffd4678:()=>c_,__wbg_result_a0f1bf2fe64a516c:()=>g_,__wbg_roomid_unwrap:()=>u_,__wbg_roomkeycounts_new:()=>d_,__wbg_roomkeyimportresult_new:()=>l_,__wbg_roomkeyinfo_new:()=>p_,__wbg_roomkeywithheldinfo_new:()=>w_,__wbg_roommessagerequest_new:()=>y_,__wbg_roomsettings_new:()=>b_,__wbg_sas_new:()=>h_,__wbg_secretsbundle_new:()=>f_,__wbg_setTimeout_db2dbaeefb6f39c7:()=>v_,__wbg_set_3f1d0b984ed272ed:()=>m_,__wbg_set_7422acbe992d64ab:()=>k_,__wbg_set_d6bdfd275fb8a4ce:()=>S_,__wbg_set_fd40eacc85c5ab66:()=>R_,__wbg_set_fe4e79d1ed3b0e9b:()=>K_,__wbg_set_wasm:()=>o,__wbg_setonabort_479ebb5884fcb171:()=>I_,__wbg_setonblocked_046331b614d6f8e3:()=>C_,__wbg_setoncomplete_27bdbca012e45c05:()=>O_,__wbg_setonerror_537b68f474e27d4e:()=>E_,__wbg_setonerror_ce5c4d34aed931bb:()=>D_,__wbg_setonsuccess_0b2b45bd8cc13b95:()=>M_,__wbg_setonupgradeneeded_be2e0ae927917f82:()=>A_,__wbg_setonversionchange_407ebf1ad930c84c:()=>q_,__wbg_setunique_727cefd7e14cf677:()=>B_,__wbg_signatures_new:()=>T_,__wbg_signatureuploadrequest_new:()=>F_,__wbg_signatureverification_new:()=>U_,__wbg_stack_0ed75d68575b0f3c:()=>V_,__wbg_static_accessor_GLOBAL_487c52c58d65314d:()=>P_,__wbg_static_accessor_GLOBAL_THIS_ee9704f328b6b291:()=>N_,__wbg_static_accessor_SELF_78c9e3071b912620:()=>z_,__wbg_static_accessor_WINDOW_a093d21393777366:()=>x_,__wbg_storedroomkeybundledata_new:()=>j_,__wbg_storehandle_new:()=>L_,__wbg_stringify_c242842b97f054cc:()=>W_,__wbg_subarray_dd4ade7d53bd8e26:()=>G_,__wbg_target_15f1da583855ac4e:()=>Q_,__wbg_then_82ab9fb4080f1707:()=>J_,__wbg_then_db882932c0c714c6:()=>H_,__wbg_todevicerequest_new:()=>Y_,__wbg_transaction_34c41b46ca391af6:()=>X_,__wbg_transaction_36c8b28ed4349a9a:()=>$_,__wbg_transaction_399fc15f5bba1880:()=>Z_,__wbg_update_297181dae0cc0af4:()=>eo,__wbg_userdevices_new:()=>to,__wbg_userid_new:()=>ro,__wbg_userid_unwrap:()=>no,__wbg_utdtodeviceevent_new:()=>io,__wbg_value_17b896954e14f896:()=>so,__wbg_value_648dc44894c8dc95:()=>_o,__wbg_values_81045499c3c8e670:()=>oo,__wbg_verificationrequest_new:()=>ao,__wbg_version_2c3ed4a311fdabdf:()=>co,__wbg_versions_c01dfd4722a88165:()=>go,__wbg_warn_9b968a0475b49f6b:()=>uo,__wbg_warn_d89f6637da554c8d:()=>lo,__wbindgen_array_new:()=>po,__wbindgen_array_push:()=>wo,__wbindgen_as_number:()=>yo,__wbindgen_bigint_from_i64:()=>bo,__wbindgen_bigint_from_u64:()=>ho,__wbindgen_bigint_get_as_i64:()=>fo,__wbindgen_boolean_get:()=>vo,__wbindgen_cb_drop:()=>mo,__wbindgen_closure_wrapper1160:()=>ko,__wbindgen_closure_wrapper2391:()=>So,__wbindgen_closure_wrapper5618:()=>Ro,__wbindgen_closure_wrapper7116:()=>Ko,__wbindgen_closure_wrapper7121:()=>Io,__wbindgen_debug_string:()=>Co,__wbindgen_in:()=>Oo,__wbindgen_init_externref_table:()=>Eo,__wbindgen_is_bigint:()=>Do,__wbindgen_is_function:()=>Mo,__wbindgen_is_null:()=>Ao,__wbindgen_is_object:()=>qo,__wbindgen_is_string:()=>Bo,__wbindgen_is_undefined:()=>To,__wbindgen_jsval_eq:()=>Fo,__wbindgen_jsval_loose_eq:()=>Uo,__wbindgen_memory:()=>Vo,__wbindgen_number_get:()=>Po,__wbindgen_number_new:()=>No,__wbindgen_string_get:()=>zo,__wbindgen_string_new:()=>xo,__wbindgen_throw:()=>jo,__wbindgen_try_into_number:()=>Lo,getVersions:()=>T,start:()=>F});var i=r(4705),s=r(467);let _;function o(e){_=e}let a=null;function c(){return null!==a&&0!==a.byteLength||(a=new Uint8Array(_.memory.buffer)),a}const g="undefined"==typeof TextDecoder?(0,module.require)("util").TextDecoder:TextDecoder;let u=new g("utf-8",{ignoreBOM:!0,fatal:!0});u.decode();const d=2146435072;let l=0;function p(e,t){return function(e,t){return l+=t,l>=d&&(u=new g("utf-8",{ignoreBOM:!0,fatal:!0}),u.decode(),l=t),u.decode(c().subarray(e,e+t))}(e>>>=0,t)}let w=0;const y=new("undefined"==typeof TextEncoder?(0,module.require)("util").TextEncoder:TextEncoder)("utf-8"),b="function"==typeof y.encodeInto?function(e,t){return y.encodeInto(e,t)}:function(e,t){const r=y.encode(e);return t.set(r),{read:e.length,written:r.length}};function h(e,t,r){if(void 0===r){const r=y.encode(e),n=t(r.length,1)>>>0;return c().subarray(n,n+r.length).set(r),w=r.length,n}let n=e.length,i=t(n,1)>>>0;const s=c();let _=0;for(;_<n;_++){const t=e.charCodeAt(_);if(t>127)break;s[i+_]=t}if(_!==n){0!==_&&(e=e.slice(_)),i=r(i,n,n=_+3*e.length,1)>>>0;const t=c().subarray(i+_,i+n);_+=b(e,t).written,i=r(i,n,_,1)>>>0}return w=_,i}let f=null;function v(){return(null===f||!0===f.buffer.detached||void 0===f.buffer.detached&&f.buffer!==_.memory.buffer)&&(f=new DataView(_.memory.buffer)),f}function m(e){const t=_.__externref_table_alloc();return _.__wbindgen_export_4.set(t,e),t}function k(e,t){try{return e.apply(this,t)}catch(e){const t=m(e);_.__wbindgen_exn_store(t)}}function S(e){return null==e}function R(e,t){return e>>>=0,c().subarray(e/1,e/1+t)}const K="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>{_.__wbindgen_export_6.get(e.dtor)(e.a,e.b)});function I(e,t,r,n){const i={a:e,b:t,cnt:1,dtor:r},s=(...e)=>{i.cnt++;const t=i.a;i.a=0;try{return n(t,i.b,...e)}finally{0===--i.cnt?(_.__wbindgen_export_6.get(i.dtor)(t,i.b),K.unregister(i)):i.a=t}};return s.original=i,K.register(s,i,i),s}function C(e,t,r,n){const i={a:e,b:t,cnt:1,dtor:r},s=(...e)=>{i.cnt++;try{return n(i.a,i.b,...e)}finally{0===--i.cnt&&(_.__wbindgen_export_6.get(i.dtor)(i.a,i.b),i.a=0,K.unregister(i))}};return s.original=i,K.register(s,i,i),s}function O(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let r="[";t>0&&(r+=O(e[0]));for(let n=1;n<t;n++)r+=", "+O(e[n]);return r+="]",r}const r=/\[object ([^\]]+)\]/.exec(toString.call(e));let n;if(!(r&&r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}function E(e,t){const r=t(1*e.length,1)>>>0;return c().set(e,r/1),w=e.length,r}function D(e){const t=_.__wbindgen_export_4.get(e);return _.__externref_table_dealloc(e),t}function M(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}function A(e,t){const r=t(4*e.length,4)>>>0;for(let t=0;t<e.length;t++){const n=m(e[t]);v().setUint32(r+4*t,n,!0)}return w=e.length,r}function q(e,t){e>>>=0;const r=v(),n=[];for(let i=e;i<e+4*t;i+=4)n.push(_.__wbindgen_export_4.get(r.getUint32(i,!0)));return _.__externref_drop_slice(e,t),n}let B=null;function T(){const e=_.getVersions();return In.__wrap(e)}function F(){_.start()}function U(e,t,r){const n=_.closure41_externref_shim_multivalue_shim(e,t,r);if(n[1])throw D(n[0])}function V(e,t){_.wasm_bindgen__convert__closures_____invoke__h8861d869601ff522(e,t)}function P(e,t,r){_.closure756_externref_shim(e,t,r)}function N(e,t,r){_.closure438_externref_shim(e,t,r)}function z(e,t){_.wasm_bindgen__convert__closures_____invoke__hce61fd14ea1a6ce1(e,t)}const x=Object.freeze({MissingRoomKey:0,0:"MissingRoomKey",UnknownMessageIndex:1,1:"UnknownMessageIndex",MismatchedIdentityKeys:2,2:"MismatchedIdentityKeys",UnknownSenderDevice:3,3:"UnknownSenderDevice",UnsignedSenderDevice:4,4:"UnsignedSenderDevice",SenderIdentityVerificationViolation:5,5:"SenderIdentityVerificationViolation",UnableToDecrypt:6,6:"UnableToDecrypt",MismatchedSender:7,7:"MismatchedSender"}),j=Object.freeze({Ed25519:0,0:"Ed25519",Curve25519:1,1:"Curve25519",Unknown:3,3:"Unknown"}),L=Object.freeze({Curve25519:0,0:"Curve25519",Ed25519:1,1:"Ed25519",Unknown:2,2:"Unknown"}),W=Object.freeze({OlmV1Curve25519AesSha2:0,0:"OlmV1Curve25519AesSha2",MegolmV1AesSha2:1,1:"MegolmV1AesSha2",Unknown:2,2:"Unknown"}),G=Object.freeze({Invited:0,0:"Invited",Joined:1,1:"Joined",Shared:2,2:"Shared",WorldReadable:3,3:"WorldReadable"}),Q=Object.freeze({Verified:0,0:"Verified",BlackListed:1,1:"BlackListed",Ignored:2,2:"Ignored",Unset:3,3:"Unset"}),J=Object.freeze({Trace:0,0:"Trace",Debug:1,1:"Debug",Info:2,2:"Info",Warn:3,3:"Warn",Error:4,4:"Error"}),H=Object.freeze({Decrypted:0,0:"Decrypted",UnableToDecrypt:1,1:"UnableToDecrypt",PlainText:2,2:"PlainText",Invalid:3,3:"Invalid"}),Y=Object.freeze({Login:0,0:"Login",Reciprocate:1,1:"Reciprocate"}),X=Object.freeze({Created:0,0:"Created",Scanned:1,1:"Scanned",Confirmed:2,2:"Confirmed",Reciprocated:3,3:"Reciprocated",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),$=Object.freeze({KeysUpload:0,0:"KeysUpload",KeysQuery:1,1:"KeysQuery",KeysClaim:2,2:"KeysClaim",ToDevice:3,3:"ToDevice",SignatureUpload:4,4:"SignatureUpload",RoomMessage:5,5:"RoomMessage",KeysBackup:6,6:"KeysBackup"}),Z=Object.freeze({Red:0,0:"Red",Grey:1,1:"Grey",None:2,2:"None"}),ee=Object.freeze({AuthenticityNotGuaranteed:0,0:"AuthenticityNotGuaranteed",UnknownDevice:1,1:"UnknownDevice",UnsignedDevice:2,2:"UnsignedDevice",UnverifiedIdentity:3,3:"UnverifiedIdentity",SentInClear:4,4:"SentInClear",VerificationViolation:5,5:"VerificationViolation",MismatchedSender:6,6:"MismatchedSender"}),te=Object.freeze({Missing:0,0:"Missing",Invalid:1,1:"Invalid",ValidButNotTrusted:2,2:"ValidButNotTrusted",ValidAndTrusted:3,3:"ValidAndTrusted"}),re=Object.freeze({DecryptionFailure:0,0:"DecryptionFailure",UnverifiedSenderDevice:1,1:"UnverifiedSenderDevice",NoOlmMachine:2,2:"NoOlmMachine",EncryptionIsDisabled:3,3:"EncryptionIsDisabled"}),ne=Object.freeze({Untrusted:0,0:"Untrusted",CrossSignedOrLegacy:1,1:"CrossSignedOrLegacy",CrossSigned:2,2:"CrossSigned"}),ie=Object.freeze({SasV1:0,0:"SasV1",QrCodeScanV1:1,1:"QrCodeScanV1",QrCodeShowV1:2,2:"QrCodeShowV1",ReciprocateV1:3,3:"ReciprocateV1"}),se=Object.freeze({Created:0,0:"Created",Requested:1,1:"Requested",Ready:2,2:"Ready",Transitioned:3,3:"Transitioned",Done:4,4:"Done",Cancelled:5,5:"Cancelled"}),_e=["pending","done"],oe=["readonly","readwrite","versionchange","readwriteflush","cleanup"],ae="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_attachment_free(e>>>0,1));class ce{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ae.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_attachment_free(e,0)}static encrypt(e){const t=E(e,_.__wbindgen_malloc),r=w,n=_.attachment_encrypt(t,r);if(n[2])throw D(n[1]);return wt.__wrap(n[0])}static decrypt(e){M(e,wt);const t=_.attachment_decrypt(e.__wbg_ptr);if(t[3])throw D(t[2]);var r=R(t[0],t[1]).slice();return _.__wbindgen_free(t[0],1*t[1],1),r}}const ge="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_backupdecryptionkey_free(e>>>0,1));class ue{static __wrap(e){e>>>=0;const t=Object.create(ue.prototype);return t.__wbg_ptr=e,ge.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ge.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_backupdecryptionkey_free(e,0)}static createRandomKey(){const e=_.backupdecryptionkey_createRandomKey();return ue.__wrap(e)}static fromBase64(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.backupdecryptionkey_fromBase64(t,r);if(n[2])throw D(n[1]);return ue.__wrap(n[0])}toBase64(){return _.backupdecryptionkey_toBase64(this.__wbg_ptr)}get megolmV1PublicKey(){const e=_.backupdecryptionkey_megolmV1PublicKey(this.__wbg_ptr);return Wt.__wrap(e)}decryptV1(e,t,r){let n,i;try{const a=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),c=w,g=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),u=w,d=h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),l=w,y=_.backupdecryptionkey_decryptV1(this.__wbg_ptr,a,c,g,u,d,l);var s=y[0],o=y[1];if(y[3])throw s=0,o=0,D(y[2]);return n=s,i=o,p(s,o)}finally{_.__wbindgen_free(n,i,1)}}}const de="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_backupkeys_free(e>>>0,1));class le{static __wrap(e){e>>>=0;const t=Object.create(le.prototype);return t.__wbg_ptr=e,de.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,de.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_backupkeys_free(e,0)}get decryptionKey(){const e=_.__wbg_get_backupkeys_decryptionKey(this.__wbg_ptr);return 0===e?void 0:ue.__wrap(e)}set decryptionKey(e){let t=0;S(e)||(M(e,ue),t=e.__destroy_into_raw()),_.__wbg_set_backupkeys_decryptionKey(this.__wbg_ptr,t)}get backupVersion(){const e=_.__wbg_get_backupkeys_backupVersion(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set backupVersion(e){var t=S(e)?0:h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupkeys_backupVersion(this.__wbg_ptr,t,r)}get decryptionKeyBase64(){return _.backupkeys_decryptionKeyBase64(this.__wbg_ptr)}}const pe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_backupsecretsbundle_free(e>>>0,1));class we{static __wrap(e){e>>>=0;const t=Object.create(we.prototype);return t.__wbg_ptr=e,pe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_backupsecretsbundle_free(e,0)}get key(){let e,t;try{const r=_.__wbg_get_backupsecretsbundle_key(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set key(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backup_version(){let e,t;try{const r=_.__wbg_get_backupsecretsbundle_backup_version(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set backup_version(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}}const ye="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_base64encodedpkmessage_free(e>>>0,1));class be{static __wrap(e){e>>>=0;const t=Object.create(be.prototype);return t.__wbg_ptr=e,ye.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ye.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_base64encodedpkmessage_free(e,0)}get ciphertext(){let e,t;try{const r=_.__wbg_get_base64encodedpkmessage_ciphertext(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set ciphertext(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get mac(){let e,t;try{const r=_.__wbg_get_base64encodedpkmessage_mac(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set mac(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get ephemeralKey(){let e,t;try{const r=_.__wbg_get_base64encodedpkmessage_ephemeralKey(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set ephemeralKey(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_base64encodedpkmessage_ephemeralKey(this.__wbg_ptr,t,r)}constructor(e,t,r){const n=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w,s=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),o=w,a=h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),c=w,g=_.base64encodedpkmessage_new(n,i,s,o,a,c);return this.__wbg_ptr=g>>>0,ye.register(this,this.__wbg_ptr,this),this}}const he="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_basemigrationdata_free(e>>>0,1));class fe{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,he.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_basemigrationdata_free(e,0)}get userId(){const e=_.__wbg_get_basemigrationdata_userId(this.__wbg_ptr);return 0===e?void 0:kn.__wrap(e)}set userId(e){let t=0;S(e)||(M(e,kn),t=e.__destroy_into_raw()),_.__wbg_set_basemigrationdata_userId(this.__wbg_ptr,t)}get deviceId(){const e=_.__wbg_get_basemigrationdata_deviceId(this.__wbg_ptr);return 0===e?void 0:Xe.__wrap(e)}set deviceId(e){let t=0;S(e)||(M(e,Xe),t=e.__destroy_into_raw()),_.__wbg_set_basemigrationdata_deviceId(this.__wbg_ptr,t)}get pickledAccount(){let e,t;try{const r=_.__wbg_get_basemigrationdata_pickledAccount(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set pickledAccount(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get backupVersion(){const e=_.__wbg_get_basemigrationdata_backupVersion(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set backupVersion(e){var t=S(e)?0:h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_basemigrationdata_backupVersion(this.__wbg_ptr,t,r)}get backupRecoveryKey(){const e=_.__wbg_get_basemigrationdata_backupRecoveryKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set backupRecoveryKey(e){var t=S(e)?0:h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get privateCrossSigningMasterKey(){const e=_.__wbg_get_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningMasterKey(e){var t=S(e)?0:h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_basemigrationdata_privateCrossSigningMasterKey(this.__wbg_ptr,t,r)}get privateCrossSigningSelfSigningKey(){const e=_.__wbg_get_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningSelfSigningKey(e){var t=S(e)?0:h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_basemigrationdata_privateCrossSigningSelfSigningKey(this.__wbg_ptr,t,r)}get privateCrossSigningUserSigningKey(){const e=_.__wbg_get_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set privateCrossSigningUserSigningKey(e){var t=S(e)?0:h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_basemigrationdata_privateCrossSigningUserSigningKey(this.__wbg_ptr,t,r)}constructor(){const e=_.basemigrationdata_new();return this.__wbg_ptr=e>>>0,he.register(this,this.__wbg_ptr,this),this}}const ve="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_cancelinfo_free(e>>>0,1));class me{static __wrap(e){e>>>=0;const t=Object.create(me.prototype);return t.__wbg_ptr=e,ve.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ve.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_cancelinfo_free(e,0)}reason(){return _.cancelinfo_reason(this.__wbg_ptr)}cancelCode(){let e,t;try{const r=_.cancelinfo_cancelCode(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}cancelledbyUs(){return 0!==_.cancelinfo_cancelledbyUs(this.__wbg_ptr)}}const ke="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_checkcode_free(e>>>0,1));class Se{static __wrap(e){e>>>=0;const t=Object.create(Se.prototype);return t.__wbg_ptr=e,ke.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ke.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_checkcode_free(e,0)}as_bytes(){const e=_.checkcode_as_bytes(this.__wbg_ptr);var t=R(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}to_digit(){return _.checkcode_to_digit(this.__wbg_ptr)}}const Re="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_collectstrategy_free(e>>>0,1));class Ke{static __wrap(e){e>>>=0;const t=Object.create(Ke.prototype);return t.__wbg_ptr=e,Re.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Re.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_collectstrategy_free(e,0)}eq(e){return M(e,Ke),0!==_.collectstrategy_eq(this.__wbg_ptr,e.__wbg_ptr)}static deviceBasedStrategy(e,t){const r=_.collectstrategy_deviceBasedStrategy(e,t);return Ke.__wrap(r)}static allDevices(){const e=_.collectstrategy_allDevices();return Ke.__wrap(e)}static errorOnUnverifiedUserProblem(){const e=_.collectstrategy_errorOnUnverifiedUserProblem();return Ke.__wrap(e)}static identityBasedStrategy(){const e=_.collectstrategy_identityBasedStrategy();return Ke.__wrap(e)}static onlyTrustedDevices(){const e=_.collectstrategy_onlyTrustedDevices();return Ke.__wrap(e)}}const Ie="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_crosssigningbootstraprequests_free(e>>>0,1));class Ce{static __wrap(e){e>>>=0;const t=Object.create(Ce.prototype);return t.__wbg_ptr=e,Ie.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ie.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_crosssigningbootstraprequests_free(e,0)}get uploadKeysRequest(){return _.__wbg_get_crosssigningbootstraprequests_uploadKeysRequest(this.__wbg_ptr)}get uploadSigningKeysRequest(){const e=_.__wbg_get_crosssigningbootstraprequests_uploadSigningKeysRequest(this.__wbg_ptr);return hn.__wrap(e)}get uploadSignaturesRequest(){const e=_.__wbg_get_crosssigningbootstraprequests_uploadSignaturesRequest(this.__wbg_ptr);return Xr.__wrap(e)}}const Oe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_crosssigningkeyexport_free(e>>>0,1));class Ee{static __wrap(e){e>>>=0;const t=Object.create(Ee.prototype);return t.__wbg_ptr=e,Oe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Oe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_crosssigningkeyexport_free(e,0)}get masterKey(){const e=_.crosssigningkeyexport_masterKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}get self_signing_key(){const e=_.crosssigningkeyexport_self_signing_key(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}get userSigningKey(){const e=_.crosssigningkeyexport_userSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}}const De="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_crosssigningstatus_free(e>>>0,1));class Me{static __wrap(e){e>>>=0;const t=Object.create(Me.prototype);return t.__wbg_ptr=e,De.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,De.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_crosssigningstatus_free(e,0)}get hasMaster(){return 0!==_.crosssigningstatus_hasMaster(this.__wbg_ptr)}get hasSelfSigning(){return 0!==_.crosssigningstatus_hasSelfSigning(this.__wbg_ptr)}get hasUserSigning(){return 0!==_.crosssigningstatus_hasUserSigning(this.__wbg_ptr)}}const Ae="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_curve25519publickey_free(e>>>0,1));class qe{static __wrap(e){e>>>=0;const t=Object.create(qe.prototype);return t.__wbg_ptr=e,Ae.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ae.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_curve25519publickey_free(e,0)}constructor(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.curve25519publickey_new(t,r);if(n[2])throw D(n[1]);return this.__wbg_ptr=n[0]>>>0,Ae.register(this,this.__wbg_ptr,this),this}get length(){return _.curve25519publickey_length(this.__wbg_ptr)>>>0}toBase64(){let e,t;try{const r=_.curve25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Be="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_curve25519secretkey_free(e>>>0,1));class Te{static __wrap(e){e>>>=0;const t=Object.create(Te.prototype);return t.__wbg_ptr=e,Be.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Be.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_curve25519secretkey_free(e,0)}static new(){const e=_.curve25519secretkey_new();return Te.__wrap(e)}static fromBase64(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.curve25519secretkey_fromBase64(t,r);if(n[2])throw D(n[1]);return Te.__wrap(n[0])}toBase64(){let e,t;try{const r=_.curve25519secretkey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}toUint8Array(){const e=_.curve25519secretkey_toUint8Array(this.__wbg_ptr);var t=R(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}static fromUint8Array(e){const t=E(e,_.__wbindgen_malloc),r=w,n=_.curve25519secretkey_fromUint8Array(t,r);if(n[2])throw D(n[1]);return Te.__wrap(n[0])}}const Fe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_decryptedroomevent_free(e>>>0,1));class Ue{static __wrap(e){e>>>=0;const t=Object.create(Ue.prototype);return t.__wbg_ptr=e,Fe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Fe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_decryptedroomevent_free(e,0)}get event(){return _.__wbg_get_decryptedroomevent_event(this.__wbg_ptr)}get sender(){const e=_.decryptedroomevent_sender(this.__wbg_ptr);return kn.__wrap(e)}get senderDevice(){const e=_.decryptedroomevent_senderDevice(this.__wbg_ptr);return 0===e?void 0:Xe.__wrap(e)}get senderCurve25519Key(){let e,t;try{const r=_.decryptedroomevent_senderCurve25519Key(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get senderClaimedEd25519Key(){return _.decryptedroomevent_senderClaimedEd25519Key(this.__wbg_ptr)}get forwardingCurve25519KeyChain(){return _.decryptedroomevent_forwardingCurve25519KeyChain(this.__wbg_ptr)}shieldState(e){const t=_.decryptedroomevent_shieldState(this.__wbg_ptr,e);return Qr.__wrap(t)}}const Ve="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_decryptedtodeviceevent_free(e>>>0,1));class Pe{static __wrap(e){e>>>=0;const t=Object.create(Pe.prototype);return t.__wbg_ptr=e,Ve.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ve.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_decryptedtodeviceevent_free(e,0)}get rawEvent(){return _.__wbg_get_decryptedtodeviceevent_rawEvent(this.__wbg_ptr)}get encryptionInfo(){const e=_.__wbg_get_decryptedtodeviceevent_encryptionInfo(this.__wbg_ptr);return an.__wrap(e)}get type(){return _.decryptedtodeviceevent_type(this.__wbg_ptr)}}const Ne="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_decryptionsettings_free(e>>>0,1));class ze{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ne.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_decryptionsettings_free(e,0)}get sender_device_trust_requirement(){return _.__wbg_get_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr)}set sender_device_trust_requirement(e){_.__wbg_set_decryptionsettings_sender_device_trust_requirement(this.__wbg_ptr,e)}constructor(e){const t=_.decryptionsettings_new(e);return this.__wbg_ptr=t>>>0,Ne.register(this,this.__wbg_ptr,this),this}}const xe="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_dehydrateddevice_free(e>>>0,1));class je{static __wrap(e){e>>>=0;const t=Object.create(je.prototype);return t.__wbg_ptr=e,xe.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xe.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_dehydrateddevice_free(e,0)}keysForUpload(e,t){return M(t,We),_.dehydrateddevice_keysForUpload(this.__wbg_ptr,e,t.__wbg_ptr)}}const Le="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_dehydrateddevicekey_free(e>>>0,1));class We{static __wrap(e){e>>>=0;const t=Object.create(We.prototype);return t.__wbg_ptr=e,Le.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Le.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_dehydrateddevicekey_free(e,0)}static createRandomKey(){const e=_.dehydrateddevicekey_createRandomKey();if(e[2])throw D(e[1]);return We.__wrap(e[0])}static createKeyFromArray(e){const t=_.dehydrateddevicekey_createKeyFromArray(e);if(t[2])throw D(t[1]);return We.__wrap(t[0])}toBase64(){return _.dehydrateddevicekey_toBase64(this.__wbg_ptr)}}const Ge="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_dehydrateddevices_free(e>>>0,1));class Qe{static __wrap(e){e>>>=0;const t=Object.create(Qe.prototype);return t.__wbg_ptr=e,Ge.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ge.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_dehydrateddevices_free(e,0)}create(){return _.dehydrateddevices_create(this.__wbg_ptr)}rehydrate(e,t,r){M(e,We),M(t,Xe);const n=h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w;return _.dehydrateddevices_rehydrate(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,n,i)}getDehydratedDeviceKey(){return _.dehydrateddevices_getDehydratedDeviceKey(this.__wbg_ptr)}saveDehydratedDeviceKey(e){return M(e,We),_.dehydrateddevices_saveDehydratedDeviceKey(this.__wbg_ptr,e.__wbg_ptr)}deleteDehydratedDeviceKey(){return _.dehydrateddevices_deleteDehydratedDeviceKey(this.__wbg_ptr)}}const Je="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_device_free(e>>>0,1));class He{static __wrap(e){e>>>=0;const t=Object.create(He.prototype);return t.__wbg_ptr=e,Je.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Je.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_device_free(e,0)}requestVerification(e){var t=S(e)?0:A(e,_.__wbindgen_malloc),r=w;const n=_.device_requestVerification(this.__wbg_ptr,t,r);if(n[2])throw D(n[1]);return D(n[0])}encryptToDeviceEvent(e,t,r){const n=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w;let s=0;return S(r)||(M(r,Ke),s=r.__destroy_into_raw()),_.device_encryptToDeviceEvent(this.__wbg_ptr,n,i,t,s)}isVerified(){return 0!==_.device_isVerified(this.__wbg_ptr)}isCrossSigningTrusted(){return 0!==_.device_isCrossSigningTrusted(this.__wbg_ptr)}isCrossSignedByOwner(){return 0!==_.device_isCrossSignedByOwner(this.__wbg_ptr)}setLocalTrust(e){return _.device_setLocalTrust(this.__wbg_ptr,e)}get userId(){const e=_.device_userId(this.__wbg_ptr);return kn.__wrap(e)}get deviceId(){const e=_.device_deviceId(this.__wbg_ptr);return Xe.__wrap(e)}get displayName(){const e=_.device_displayName(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}getKey(e){const t=_.device_getKey(this.__wbg_ptr,e);if(t[2])throw D(t[1]);return 0===t[0]?void 0:Ze.__wrap(t[0])}get curve25519Key(){const e=_.device_curve25519Key(this.__wbg_ptr);return 0===e?void 0:qe.__wrap(e)}get ed25519Key(){const e=_.device_ed25519Key(this.__wbg_ptr);return 0===e?void 0:ct.__wrap(e)}get keys(){return _.device_keys(this.__wbg_ptr)}get algorithms(){return _.device_algorithms(this.__wbg_ptr)}get signatures(){const e=_.device_signatures(this.__wbg_ptr);return tn.__wrap(e)}get localTrustState(){return _.device_localTrustState(this.__wbg_ptr)}isLocallyTrusted(){return 0!==_.device_isLocallyTrusted(this.__wbg_ptr)}isBlacklisted(){return 0!==_.device_isBlacklisted(this.__wbg_ptr)}isDeleted(){return 0!==_.device_isDeleted(this.__wbg_ptr)}firstTimeSeen(){const e=_.device_firstTimeSeen(this.__wbg_ptr);return BigInt.asUintN(64,e)}verify(){return _.device_verify(this.__wbg_ptr)}get isDehydrated(){return 0!==_.device_isDehydrated(this.__wbg_ptr)}}const Ye="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_deviceid_free(e>>>0,1));class Xe{static __wrap(e){e>>>=0;const t=Object.create(Xe.prototype);return t.__wbg_ptr=e,Ye.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ye.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_deviceid_free(e,0)}constructor(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.deviceid_new(t,r);return this.__wbg_ptr=n>>>0,Ye.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=_.deviceid_toString(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const $e="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_devicekey_free(e>>>0,1));class Ze{static __wrap(e){e>>>=0;const t=Object.create(Ze.prototype);return t.__wbg_ptr=e,$e.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$e.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_devicekey_free(e,0)}get name(){return _.devicekey_name(this.__wbg_ptr)}get curve25519(){const e=_.devicekey_curve25519(this.__wbg_ptr);return 0===e?void 0:qe.__wrap(e)}get ed25519(){const e=_.devicekey_ed25519(this.__wbg_ptr);return 0===e?void 0:ct.__wrap(e)}get unknown(){const e=_.devicekey_unknown(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}toBase64(){let e,t;try{const r=_.devicekey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const et="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_devicekeyalgorithm_free(e>>>0,1));class tt{static __wrap(e){e>>>=0;const t=Object.create(tt.prototype);return t.__wbg_ptr=e,et.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,et.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_devicekeyalgorithm_free(e,0)}get name(){return _.devicekeyalgorithm_name(this.__wbg_ptr)}toString(){let e,t;try{const r=_.devicekeyalgorithm_toString(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const rt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_devicekeyid_free(e>>>0,1));class nt{static __wrap(e){e>>>=0;const t=Object.create(nt.prototype);return t.__wbg_ptr=e,rt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,rt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_devicekeyid_free(e,0)}constructor(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.devicekeyid_new(t,r);if(n[2])throw D(n[1]);return this.__wbg_ptr=n[0]>>>0,rt.register(this,this.__wbg_ptr,this),this}get algorithm(){const e=_.devicekeyid_algorithm(this.__wbg_ptr);return tt.__wrap(e)}get deviceId(){const e=_.devicekeyid_deviceId(this.__wbg_ptr);return Xe.__wrap(e)}toString(){let e,t;try{const r=_.devicekeyid_toString(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const it="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_devicelists_free(e>>>0,1));class st{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,it.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_devicelists_free(e,0)}constructor(e,t){var r=S(e)?0:A(e,_.__wbindgen_malloc),n=w,i=S(t)?0:A(t,_.__wbindgen_malloc),s=w;const o=_.devicelists_new(r,n,i,s);if(o[2])throw D(o[1]);return this.__wbg_ptr=o[0]>>>0,it.register(this,this.__wbg_ptr,this),this}isEmpty(){return 0!==_.devicelists_isEmpty(this.__wbg_ptr)}get changed(){const e=_.devicelists_changed(this.__wbg_ptr);var t=q(e[0],e[1]).slice();return _.__wbindgen_free(e[0],4*e[1],4),t}get left(){const e=_.devicelists_left(this.__wbg_ptr);var t=q(e[0],e[1]).slice();return _.__wbindgen_free(e[0],4*e[1],4),t}}const _t="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_ecies_free(e>>>0,1));class ot{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_t.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_ecies_free(e,0)}constructor(){const e=_.ecies_new();return this.__wbg_ptr=e>>>0,_t.register(this,this.__wbg_ptr,this),this}public_key(){const e=_.ecies_public_key(this.__wbg_ptr);return qe.__wrap(e)}establish_inbound_channel(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.ecies_establish_inbound_channel(this.__wbg_ptr,t,r);if(n[2])throw D(n[1]);return Ct.__wrap(n[0])}establish_outbound_channel(e,t){M(e,qe);const r=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w,i=_.ecies_establish_outbound_channel(this.__wbg_ptr,e.__wbg_ptr,r,n);if(i[2])throw D(i[1]);return Zt.__wrap(i[0])}}const at="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_ed25519publickey_free(e>>>0,1));class ct{static __wrap(e){e>>>=0;const t=Object.create(ct.prototype);return t.__wbg_ptr=e,at.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,at.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_ed25519publickey_free(e,0)}get length(){return _.ed25519publickey_length(this.__wbg_ptr)>>>0}toBase64(){let e,t;try{const r=_.ed25519publickey_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const gt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_ed25519signature_free(e>>>0,1));class ut{static __wrap(e){e>>>=0;const t=Object.create(ut.prototype);return t.__wbg_ptr=e,gt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,gt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_ed25519signature_free(e,0)}constructor(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.ed25519signature_new(t,r);if(n[2])throw D(n[1]);return this.__wbg_ptr=n[0]>>>0,gt.register(this,this.__wbg_ptr,this),this}toBase64(){let e,t;try{const r=_.ed25519signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const dt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_emoji_free(e>>>0,1));class lt{static __wrap(e){e>>>=0;const t=Object.create(lt.prototype);return t.__wbg_ptr=e,dt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,dt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_emoji_free(e,0)}get symbol(){return _.emoji_symbol(this.__wbg_ptr)}get description(){return _.emoji_description(this.__wbg_ptr)}}const pt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_encryptedattachment_free(e>>>0,1));class wt{static __wrap(e){e>>>=0;const t=Object.create(wt.prototype);return t.__wbg_ptr=e,pt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_encryptedattachment_free(e,0)}constructor(e,t){const r=E(e,_.__wbindgen_malloc),n=w,i=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),s=w,o=_.encryptedattachment_new(r,n,i,s);if(o[2])throw D(o[1]);return this.__wbg_ptr=o[0]>>>0,pt.register(this,this.__wbg_ptr,this),this}get encryptedData(){const e=_.encryptedattachment_encryptedData(this.__wbg_ptr);var t=R(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}get mediaEncryptionInfo(){const e=_.encryptedattachment_mediaEncryptionInfo(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}get hasMediaEncryptionInfoBeenConsumed(){return 0!==_.encryptedattachment_hasMediaEncryptionInfoBeenConsumed(this.__wbg_ptr)}}const yt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_encryptioninfo_free(e>>>0,1));class bt{static __wrap(e){e>>>=0;const t=Object.create(bt.prototype);return t.__wbg_ptr=e,yt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,yt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_encryptioninfo_free(e,0)}get sender(){const e=_.__wbg_get_encryptioninfo_sender(this.__wbg_ptr);return kn.__wrap(e)}set sender(e){M(e,kn);var t=e.__destroy_into_raw();_.__wbg_set_encryptioninfo_sender(this.__wbg_ptr,t)}get senderDevice(){const e=_.__wbg_get_encryptioninfo_senderDevice(this.__wbg_ptr);return 0===e?void 0:Xe.__wrap(e)}set senderDevice(e){let t=0;S(e)||(M(e,Xe),t=e.__destroy_into_raw()),_.__wbg_set_encryptioninfo_senderDevice(this.__wbg_ptr,t)}get senderCurve25519Key(){let e,t;try{const r=_.__wbg_get_encryptioninfo_senderCurve25519Key(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set senderCurve25519Key(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderClaimedEd25519Key(){const e=_.__wbg_get_encryptioninfo_senderClaimedEd25519Key(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set senderClaimedEd25519Key(e){var t=S(e)?0:h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_basemigrationdata_backupVersion(this.__wbg_ptr,t,r)}shieldState(e){const t=_.encryptioninfo_shieldState(this.__wbg_ptr,e);return Qr.__wrap(t)}}const ht="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_encryptionsettings_free(e>>>0,1));class ft{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ht.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_encryptionsettings_free(e,0)}get algorithm(){return _.__wbg_get_encryptionsettings_algorithm(this.__wbg_ptr)}set algorithm(e){_.__wbg_set_encryptionsettings_algorithm(this.__wbg_ptr,e)}get encryptStateEvents(){return 0!==_.__wbg_get_encryptionsettings_encryptStateEvents(this.__wbg_ptr)}set encryptStateEvents(e){_.__wbg_set_encryptionsettings_encryptStateEvents(this.__wbg_ptr,e)}get rotationPeriod(){const e=_.__wbg_get_encryptionsettings_rotationPeriod(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriod(e){_.__wbg_set_encryptionsettings_rotationPeriod(this.__wbg_ptr,e)}get rotationPeriodMessages(){const e=_.__wbg_get_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr);return BigInt.asUintN(64,e)}set rotationPeriodMessages(e){_.__wbg_set_encryptionsettings_rotationPeriodMessages(this.__wbg_ptr,e)}get historyVisibility(){return _.__wbg_get_encryptionsettings_historyVisibility(this.__wbg_ptr)}set historyVisibility(e){_.__wbg_set_encryptionsettings_historyVisibility(this.__wbg_ptr,e)}get sharingStrategy(){const e=_.__wbg_get_encryptionsettings_sharingStrategy(this.__wbg_ptr);return Ke.__wrap(e)}set sharingStrategy(e){M(e,Ke);var t=e.__destroy_into_raw();_.__wbg_set_encryptionsettings_sharingStrategy(this.__wbg_ptr,t)}constructor(){const e=_.encryptionsettings_new();return this.__wbg_ptr=e>>>0,ht.register(this,this.__wbg_ptr,this),this}}const vt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_establishedecies_free(e>>>0,1));class mt{static __wrap(e){e>>>=0;const t=Object.create(mt.prototype);return t.__wbg_ptr=e,vt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,vt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_establishedecies_free(e,0)}public_key(){const e=_.establishedecies_public_key(this.__wbg_ptr);return qe.__wrap(e)}encrypt(e){let t,r;try{const n=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w,s=_.establishedecies_encrypt(this.__wbg_ptr,n,i);return t=s[0],r=s[1],p(s[0],s[1])}finally{_.__wbindgen_free(t,r,1)}}decrypt(e){let t,r;try{const s=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=w,a=_.establishedecies_decrypt(this.__wbg_ptr,s,o);var n=a[0],i=a[1];if(a[3])throw n=0,i=0,D(a[2]);return t=n,r=i,p(n,i)}finally{_.__wbindgen_free(t,r,1)}}check_code(){const e=_.establishedecies_check_code(this.__wbg_ptr);return Se.__wrap(e)}}const kt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_eventid_free(e>>>0,1));class St{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,kt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_eventid_free(e,0)}constructor(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.eventid_new(t,r);if(n[2])throw D(n[1]);return this.__wbg_ptr=n[0]>>>0,kt.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=_.eventid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get serverName(){const e=_.eventid_serverName(this.__wbg_ptr);return 0===e?void 0:Wr.__wrap(e)}toString(){let e,t;try{const r=_.eventid_toString(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Rt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_identitykeys_free(e>>>0,1));class Kt{static __wrap(e){e>>>=0;const t=Object.create(Kt.prototype);return t.__wbg_ptr=e,Rt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Rt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_identitykeys_free(e,0)}get ed25519(){const e=_.__wbg_get_identitykeys_ed25519(this.__wbg_ptr);return ct.__wrap(e)}set ed25519(e){M(e,ct);var t=e.__destroy_into_raw();_.__wbg_set_identitykeys_ed25519(this.__wbg_ptr,t)}get curve25519(){const e=_.__wbg_get_identitykeys_curve25519(this.__wbg_ptr);return qe.__wrap(e)}set curve25519(e){M(e,qe);var t=e.__destroy_into_raw();_.__wbg_set_identitykeys_curve25519(this.__wbg_ptr,t)}}const It="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_inboundcreationresult_free(e>>>0,1));class Ct{static __wrap(e){e>>>=0;const t=Object.create(Ct.prototype);return t.__wbg_ptr=e,It.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,It.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_inboundcreationresult_free(e,0)}get channel(){const e=_.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return mt.__wrap(e)}set channel(e){M(e,mt);var t=e.__destroy_into_raw();_.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get message(){let e,t;try{const r=_.__wbg_get_inboundcreationresult_message(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set message(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}}const Ot="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_inboundgroupsession_free(e>>>0,1));class Et{static __wrap(e){e>>>=0;const t=Object.create(Et.prototype);return t.__wbg_ptr=e,Ot.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ot.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_inboundgroupsession_free(e,0)}get roomId(){const e=_.inboundgroupsession_roomId(this.__wbg_ptr);return Cr.__wrap(e)}get senderKey(){const e=_.inboundgroupsession_senderKey(this.__wbg_ptr);return qe.__wrap(e)}get sessionId(){let e,t;try{const r=_.inboundgroupsession_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}hasBeenImported(){return 0!==_.inboundgroupsession_hasBeenImported(this.__wbg_ptr)}}const Dt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_invalidtodeviceevent_free(e>>>0,1));class Mt{static __wrap(e){e>>>=0;const t=Object.create(Mt.prototype);return t.__wbg_ptr=e,Dt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Dt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_invalidtodeviceevent_free(e,0)}get rawEvent(){return _.__wbg_get_invalidtodeviceevent_rawEvent(this.__wbg_ptr)}get type(){return _.invalidtodeviceevent_type(this.__wbg_ptr)}}const At="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_keysbackuprequest_free(e>>>0,1));class qt{static __wrap(e){e>>>=0;const t=Object.create(qt.prototype);return t.__wbg_ptr=e,At.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,At.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_keysbackuprequest_free(e,0)}get id(){return _.__wbg_get_keysbackuprequest_id(this.__wbg_ptr)}get body(){return _.__wbg_get_keysbackuprequest_body(this.__wbg_ptr)}get version(){return _.__wbg_get_keysbackuprequest_version(this.__wbg_ptr)}constructor(e,t,r){const n=_.keysbackuprequest_new(e,t,r);return this.__wbg_ptr=n>>>0,At.register(this,this.__wbg_ptr,this),this}get type(){return _.keysbackuprequest_type(this.__wbg_ptr)}}const Bt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_keysclaimrequest_free(e>>>0,1));class Tt{static __wrap(e){e>>>=0;const t=Object.create(Tt.prototype);return t.__wbg_ptr=e,Bt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Bt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_keysclaimrequest_free(e,0)}get id(){return _.__wbg_get_keysclaimrequest_id(this.__wbg_ptr)}get body(){return _.__wbg_get_keysclaimrequest_body(this.__wbg_ptr)}constructor(e,t){const r=_.keysclaimrequest_new(e,t);return this.__wbg_ptr=r>>>0,Bt.register(this,this.__wbg_ptr,this),this}get type(){return _.keysclaimrequest_type(this.__wbg_ptr)}}const Ft="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_keysqueryrequest_free(e>>>0,1));class Ut{static __wrap(e){e>>>=0;const t=Object.create(Ut.prototype);return t.__wbg_ptr=e,Ft.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ft.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_keysqueryrequest_free(e,0)}get id(){return _.__wbg_get_keysqueryrequest_id(this.__wbg_ptr)}get body(){return _.__wbg_get_keysqueryrequest_body(this.__wbg_ptr)}constructor(e,t){const r=_.keysqueryrequest_new(e,t);return this.__wbg_ptr=r>>>0,Ft.register(this,this.__wbg_ptr,this),this}get type(){return _.keysqueryrequest_type(this.__wbg_ptr)}}const Vt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_keysuploadrequest_free(e>>>0,1));class Pt{static __wrap(e){e>>>=0;const t=Object.create(Pt.prototype);return t.__wbg_ptr=e,Vt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Vt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_keysuploadrequest_free(e,0)}get id(){return _.__wbg_get_keysuploadrequest_id(this.__wbg_ptr)}get body(){return _.__wbg_get_keysuploadrequest_body(this.__wbg_ptr)}constructor(e,t){const r=_.keysuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,Vt.register(this,this.__wbg_ptr,this),this}get type(){return _.keysuploadrequest_type(this.__wbg_ptr)}}const Nt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_maybesignature_free(e>>>0,1));class zt{static __wrap(e){e>>>=0;const t=Object.create(zt.prototype);return t.__wbg_ptr=e,Nt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Nt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_maybesignature_free(e,0)}isValid(){return 0!==_.maybesignature_isValid(this.__wbg_ptr)}isInvalid(){return 0!==_.maybesignature_isInvalid(this.__wbg_ptr)}get signature(){const e=_.maybesignature_signature(this.__wbg_ptr);return 0===e?void 0:Hr.__wrap(e)}get invalidSignatureSource(){const e=_.maybesignature_invalidSignatureSource(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}}const xt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_megolmdecryptionerror_free(e>>>0,1));class jt{static __wrap(e){e>>>=0;const t=Object.create(jt.prototype);return t.__wbg_ptr=e,xt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_megolmdecryptionerror_free(e,0)}get code(){return _.__wbg_get_megolmdecryptionerror_code(this.__wbg_ptr)}get description(){return _.__wbg_get_megolmdecryptionerror_description(this.__wbg_ptr)}get maybe_withheld(){return _.__wbg_get_megolmdecryptionerror_maybe_withheld(this.__wbg_ptr)}}const Lt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_megolmv1backupkey_free(e>>>0,1));class Wt{static __wrap(e){e>>>=0;const t=Object.create(Wt.prototype);return t.__wbg_ptr=e,Lt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Lt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_megolmv1backupkey_free(e,0)}get publicKeyBase64(){return _.megolmv1backupkey_publicKeyBase64(this.__wbg_ptr)}get algorithm(){return _.megolmv1backupkey_algorithm(this.__wbg_ptr)}}const Gt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_migration_free(e>>>0,1));class Qt{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Gt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_migration_free(e,0)}static migrateBaseData(e,t,r,n){return M(e,fe),M(r,nn),_.migration_migrateBaseData(e.__wbg_ptr,t,r.__wbg_ptr,S(n)?0:m(n))}static migrateOlmSessions(e,t,r,n){const i=A(e,_.__wbindgen_malloc),s=w;M(r,nn);const o=_.migration_migrateOlmSessions(i,s,t,r.__wbg_ptr,S(n)?0:m(n));if(o[2])throw D(o[1]);return D(o[0])}static migrateMegolmSessions(e,t,r,n){const i=A(e,_.__wbindgen_malloc),s=w;M(r,nn);const o=_.migration_migrateMegolmSessions(i,s,t,r.__wbg_ptr,S(n)?0:m(n));if(o[2])throw D(o[1]);return D(o[0])}}const Jt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_olmmachine_free(e>>>0,1));class Ht{static __wrap(e){e>>>=0;const t=Object.create(Ht.prototype);return t.__wbg_ptr=e,Jt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Jt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_olmmachine_free(e,0)}constructor(){const e=_.olmmachine_new();if(e[2])throw D(e[1]);return this.__wbg_ptr=e[0]>>>0,Jt.register(this,this.__wbg_ptr,this),this}static initialize(e,t,r,n,i){M(e,kn),M(t,Xe);var s=S(r)?0:h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),o=w,a=S(n)?0:h(n,_.__wbindgen_malloc,_.__wbindgen_realloc),c=w;return _.olmmachine_initialize(e.__wbg_ptr,t.__wbg_ptr,s,o,a,c,S(i)?0:m(i))}static initFromStore(e,t,r,n){return M(e,kn),M(t,Xe),M(r,nn),_.olmmachine_initFromStore(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr,S(n)?0:m(n))}get userId(){const e=_.olmmachine_userId(this.__wbg_ptr);return kn.__wrap(e)}get deviceId(){const e=_.olmmachine_deviceId(this.__wbg_ptr);return Xe.__wrap(e)}get deviceCreationTimeMs(){return _.olmmachine_deviceCreationTimeMs(this.__wbg_ptr)}get identityKeys(){const e=_.olmmachine_identityKeys(this.__wbg_ptr);return Kt.__wrap(e)}get displayName(){return _.olmmachine_displayName(this.__wbg_ptr)}get roomKeyRequestsEnabled(){return 0!==_.olmmachine_roomKeyRequestsEnabled(this.__wbg_ptr)}set roomKeyRequestsEnabled(e){_.olmmachine_set_roomKeyRequestsEnabled(this.__wbg_ptr,e)}get roomKeyForwardingEnabled(){return 0!==_.olmmachine_roomKeyForwardingEnabled(this.__wbg_ptr)}set roomKeyForwardingEnabled(e){_.olmmachine_set_roomKeyForwardingEnabled(this.__wbg_ptr,e)}trackedUsers(){const e=_.olmmachine_trackedUsers(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}updateTrackedUsers(e){const t=A(e,_.__wbindgen_malloc),r=w;return _.olmmachine_updateTrackedUsers(this.__wbg_ptr,t,r)}markAllTrackedUsersAsDirty(){return _.olmmachine_markAllTrackedUsersAsDirty(this.__wbg_ptr)}receiveSyncChanges(e,t,r,n,i){const s=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),o=w;M(t,st);let a=0;S(i)||(M(i,ze),a=i.__destroy_into_raw());const c=_.olmmachine_receiveSyncChanges(this.__wbg_ptr,s,o,t.__wbg_ptr,r,S(n)?0:m(n),a);if(c[2])throw D(c[1]);return D(c[0])}outgoingRequests(){return _.olmmachine_outgoingRequests(this.__wbg_ptr)}markRequestAsSent(e,t,r){const n=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w,s=h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),o=w,a=_.olmmachine_markRequestAsSent(this.__wbg_ptr,n,i,t,s,o);if(a[2])throw D(a[1]);return D(a[0])}encryptRoomEvent(e,t,r){M(e,Cr);const n=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w,s=h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),o=w,a=_.olmmachine_encryptRoomEvent(this.__wbg_ptr,e.__wbg_ptr,n,i,s,o);if(a[2])throw D(a[1]);return D(a[0])}encryptStateEvent(e,t,r,n){M(e,Cr);const i=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),s=w,o=h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),a=w,c=h(n,_.__wbindgen_malloc,_.__wbindgen_realloc),g=w,u=_.olmmachine_encryptStateEvent(this.__wbg_ptr,e.__wbg_ptr,i,s,o,a,c,g);if(u[2])throw D(u[1]);return D(u[0])}decryptRoomEvent(e,t,r){const n=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w;M(t,Cr),M(r,ze);const s=_.olmmachine_decryptRoomEvent(this.__wbg_ptr,n,i,t.__wbg_ptr,r.__wbg_ptr);if(s[2])throw D(s[1]);return D(s[0])}getRoomEventEncryptionInfo(e,t){const r=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w;M(t,Cr);const i=_.olmmachine_getRoomEventEncryptionInfo(this.__wbg_ptr,r,n,t.__wbg_ptr);if(i[2])throw D(i[1]);return D(i[0])}crossSigningStatus(){return _.olmmachine_crossSigningStatus(this.__wbg_ptr)}exportSecretsBundle(){return _.olmmachine_exportSecretsBundle(this.__wbg_ptr)}importSecretsBundle(e){M(e,jr);var t=e.__destroy_into_raw();return _.olmmachine_importSecretsBundle(this.__wbg_ptr,t)}exportCrossSigningKeys(){return _.olmmachine_exportCrossSigningKeys(this.__wbg_ptr)}importCrossSigningKeys(e,t,r){var n=S(e)?0:h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w,s=S(t)?0:h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),o=w,a=S(r)?0:h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),c=w;return _.olmmachine_importCrossSigningKeys(this.__wbg_ptr,n,i,s,o,a,c)}bootstrapCrossSigning(e){return _.olmmachine_bootstrapCrossSigning(this.__wbg_ptr,e)}getIdentity(e){return M(e,kn),_.olmmachine_getIdentity(this.__wbg_ptr,e.__wbg_ptr)}sign(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;return _.olmmachine_sign(this.__wbg_ptr,t,r)}invalidateGroupSession(e){return M(e,Cr),_.olmmachine_invalidateGroupSession(this.__wbg_ptr,e.__wbg_ptr)}shareRoomKey(e,t,r){M(e,Cr);const n=A(t,_.__wbindgen_malloc),i=w;return M(r,ft),_.olmmachine_shareRoomKey(this.__wbg_ptr,e.__wbg_ptr,n,i,r.__wbg_ptr)}queryKeysForUsers(e){const t=A(e,_.__wbindgen_malloc),r=w,n=_.olmmachine_queryKeysForUsers(this.__wbg_ptr,t,r);if(n[2])throw D(n[1]);return Ut.__wrap(n[0])}getMissingSessions(e){const t=A(e,_.__wbindgen_malloc),r=w;return _.olmmachine_getMissingSessions(this.__wbg_ptr,t,r)}getUserDevices(e,t){return M(e,kn),_.olmmachine_getUserDevices(this.__wbg_ptr,e.__wbg_ptr,!S(t),S(t)?0:t)}getDevice(e,t,r){return M(e,kn),M(t,Xe),_.olmmachine_getDevice(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,!S(r),S(r)?0:r)}getVerification(e,t){M(e,kn);const r=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w,i=_.olmmachine_getVerification(this.__wbg_ptr,e.__wbg_ptr,r,n);if(i[2])throw D(i[1]);return D(i[0])}getVerificationRequest(e,t){M(e,kn);const r=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w,i=_.olmmachine_getVerificationRequest(this.__wbg_ptr,e.__wbg_ptr,r,n);return 0===i?void 0:Rn.__wrap(i)}getVerificationRequests(e){return M(e,kn),_.olmmachine_getVerificationRequests(this.__wbg_ptr,e.__wbg_ptr)}receiveVerificationEvent(e,t){const r=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w;M(t,Cr);const i=_.olmmachine_receiveVerificationEvent(this.__wbg_ptr,r,n,t.__wbg_ptr);if(i[2])throw D(i[1]);return D(i[0])}exportRoomKeys(e){return _.olmmachine_exportRoomKeys(this.__wbg_ptr,e)}importRoomKeys(e,t){const r=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w,i=_.olmmachine_importRoomKeys(this.__wbg_ptr,r,n,t);if(i[2])throw D(i[1]);return D(i[0])}importExportedRoomKeys(e,t){const r=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w,i=_.olmmachine_importExportedRoomKeys(this.__wbg_ptr,r,n,t);if(i[2])throw D(i[1]);return D(i[0])}importBackedUpRoomKeys(e,t,r){const n=h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w,s=_.olmmachine_importBackedUpRoomKeys(this.__wbg_ptr,e,S(t)?0:m(t),n,i);if(s[2])throw D(s[1]);return D(s[0])}saveBackupDecryptionKey(e,t){M(e,ue);const r=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w;return _.olmmachine_saveBackupDecryptionKey(this.__wbg_ptr,e.__wbg_ptr,r,n)}getBackupKeys(){return _.olmmachine_getBackupKeys(this.__wbg_ptr)}verifyBackup(e){const t=_.olmmachine_verifyBackup(this.__wbg_ptr,e);if(t[2])throw D(t[1]);return D(t[0])}enableBackupV1(e,t){const r=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w,i=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),s=w,o=_.olmmachine_enableBackupV1(this.__wbg_ptr,r,n,i,s);if(o[2])throw D(o[1]);return D(o[0])}isBackupEnabled(){return _.olmmachine_isBackupEnabled(this.__wbg_ptr)}disableBackup(){return _.olmmachine_disableBackup(this.__wbg_ptr)}backupRoomKeys(){return _.olmmachine_backupRoomKeys(this.__wbg_ptr)}roomKeyCounts(){return _.olmmachine_roomKeyCounts(this.__wbg_ptr)}static encryptExportedRoomKeys(e,t,r){let n,i;try{const a=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),c=w,g=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),u=w,d=_.olmmachine_encryptExportedRoomKeys(a,c,g,u,r);var s=d[0],o=d[1];if(d[3])throw s=0,o=0,D(d[2]);return n=s,i=o,p(s,o)}finally{_.__wbindgen_free(n,i,1)}}static decryptExportedRoomKeys(e,t){let r,n;try{const o=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),a=w,c=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),g=w,u=_.olmmachine_decryptExportedRoomKeys(o,a,c,g);var i=u[0],s=u[1];if(u[3])throw i=0,s=0,D(u[2]);return r=i,n=s,p(i,s)}finally{_.__wbindgen_free(r,n,1)}}registerRoomKeyUpdatedCallback(e){_.olmmachine_registerRoomKeyUpdatedCallback(this.__wbg_ptr,e)}registerRoomKeysWithheldCallback(e){_.olmmachine_registerRoomKeysWithheldCallback(this.__wbg_ptr,e)}registerUserIdentityUpdatedCallback(e){_.olmmachine_registerUserIdentityUpdatedCallback(this.__wbg_ptr,e)}registerDevicesUpdatedCallback(e){_.olmmachine_registerDevicesUpdatedCallback(this.__wbg_ptr,e)}registerReceiveSecretCallback(e){_.olmmachine_registerReceiveSecretCallback(this.__wbg_ptr,e)}getSecretsFromInbox(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;return _.olmmachine_getSecretsFromInbox(this.__wbg_ptr,t,r)}deleteSecretsFromInbox(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;return _.olmmachine_deleteSecretsFromInbox(this.__wbg_ptr,t,r)}requestMissingSecretsIfNeeded(){return _.olmmachine_requestMissingSecretsIfNeeded(this.__wbg_ptr)}getRoomSettings(e){return M(e,Cr),_.olmmachine_getRoomSettings(this.__wbg_ptr,e.__wbg_ptr)}setRoomSettings(e,t){return M(e,Cr),M(t,Pr),_.olmmachine_setRoomSettings(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr)}dehydratedDevices(){const e=_.olmmachine_dehydratedDevices(this.__wbg_ptr);return Qe.__wrap(e)}buildRoomKeyBundle(e){return M(e,Cr),_.olmmachine_buildRoomKeyBundle(this.__wbg_ptr,e.__wbg_ptr)}shareRoomKeyBundleData(e,t,r,n,i){M(e,kn),M(t,Cr);const s=h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),o=w;var a=S(n)?0:h(n,_.__wbindgen_malloc,_.__wbindgen_realloc),c=w;M(i,Ke);var g=i.__destroy_into_raw();const u=_.olmmachine_shareRoomKeyBundleData(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,s,o,a,c,g);if(u[2])throw D(u[1]);return D(u[0])}getReceivedRoomKeyBundleData(e,t){return M(e,Cr),M(t,kn),_.olmmachine_getReceivedRoomKeyBundleData(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr)}receiveRoomKeyBundle(e,t){M(e,_n);var r=e.__destroy_into_raw();const n=E(t,_.__wbindgen_malloc),i=w,s=_.olmmachine_receiveRoomKeyBundle(this.__wbg_ptr,r,n,i);if(s[2])throw D(s[1]);return D(s[0])}close(){const e=this.__destroy_into_raw();_.olmmachine_close(e)}}const Yt="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_otheruseridentity_free(e>>>0,1));class Xt{static __wrap(e){e>>>=0;const t=Object.create(Xt.prototype);return t.__wbg_ptr=e,Yt.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Yt.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_otheruseridentity_free(e,0)}isVerified(){return 0!==_.otheruseridentity_isVerified(this.__wbg_ptr)}verify(){return _.otheruseridentity_verify(this.__wbg_ptr)}requestVerification(e,t,r){M(e,Cr),M(t,St);var n=S(r)?0:A(r,_.__wbindgen_malloc),i=w;const s=_.otheruseridentity_requestVerification(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,n,i);if(s[2])throw D(s[1]);return Rn.__wrap(s[0])}verificationRequestContent(e){let t,r;try{var n=S(e)?0:A(e,_.__wbindgen_malloc),i=w;const a=_.otheruseridentity_verificationRequestContent(this.__wbg_ptr,n,i);var s=a[0],o=a[1];if(a[3])throw s=0,o=0,D(a[2]);return t=s,r=o,p(s,o)}finally{_.__wbindgen_free(t,r,1)}}get masterKey(){let e,t;try{const i=_.otheruseridentity_masterKey(this.__wbg_ptr);var r=i[0],n=i[1];if(i[3])throw r=0,n=0,D(i[2]);return e=r,t=n,p(r,n)}finally{_.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const i=_.otheruseridentity_selfSigningKey(this.__wbg_ptr);var r=i[0],n=i[1];if(i[3])throw r=0,n=0,D(i[2]);return e=r,t=n,p(r,n)}finally{_.__wbindgen_free(e,t,1)}}pinCurrentMasterKey(){return _.otheruseridentity_pinCurrentMasterKey(this.__wbg_ptr)}identityNeedsUserApproval(){return 0!==_.otheruseridentity_identityNeedsUserApproval(this.__wbg_ptr)}wasPreviouslyVerified(){return 0!==_.otheruseridentity_wasPreviouslyVerified(this.__wbg_ptr)}withdrawVerification(){return _.otheruseridentity_withdrawVerification(this.__wbg_ptr)}hasVerificationViolation(){return 0!==_.otheruseridentity_hasVerificationViolation(this.__wbg_ptr)}}const $t="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_outboundcreationresult_free(e>>>0,1));class Zt{static __wrap(e){e>>>=0;const t=Object.create(Zt.prototype);return t.__wbg_ptr=e,$t.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$t.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_outboundcreationresult_free(e,0)}get channel(){const e=_.__wbg_get_inboundcreationresult_channel(this.__wbg_ptr);return mt.__wrap(e)}set channel(e){M(e,mt);var t=e.__destroy_into_raw();_.__wbg_set_inboundcreationresult_channel(this.__wbg_ptr,t)}get initial_message(){let e,t;try{const r=_.__wbg_get_outboundcreationresult_initial_message(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set initial_message(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}}const er="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_ownuseridentity_free(e>>>0,1));class tr{static __wrap(e){e>>>=0;const t=Object.create(tr.prototype);return t.__wbg_ptr=e,er.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,er.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_ownuseridentity_free(e,0)}isVerified(){return 0!==_.ownuseridentity_isVerified(this.__wbg_ptr)}verify(){return _.ownuseridentity_verify(this.__wbg_ptr)}requestVerification(e){var t=S(e)?0:A(e,_.__wbindgen_malloc),r=w;const n=_.ownuseridentity_requestVerification(this.__wbg_ptr,t,r);if(n[2])throw D(n[1]);return D(n[0])}trustsOurOwnDevice(){return _.ownuseridentity_trustsOurOwnDevice(this.__wbg_ptr)}get masterKey(){let e,t;try{const i=_.ownuseridentity_masterKey(this.__wbg_ptr);var r=i[0],n=i[1];if(i[3])throw r=0,n=0,D(i[2]);return e=r,t=n,p(r,n)}finally{_.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const i=_.ownuseridentity_selfSigningKey(this.__wbg_ptr);var r=i[0],n=i[1];if(i[3])throw r=0,n=0,D(i[2]);return e=r,t=n,p(r,n)}finally{_.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const i=_.ownuseridentity_userSigningKey(this.__wbg_ptr);var r=i[0],n=i[1];if(i[3])throw r=0,n=0,D(i[2]);return e=r,t=n,p(r,n)}finally{_.__wbindgen_free(e,t,1)}}wasPreviouslyVerified(){return 0!==_.ownuseridentity_wasPreviouslyVerified(this.__wbg_ptr)}withdrawVerification(){return _.ownuseridentity_withdrawVerification(this.__wbg_ptr)}hasVerificationViolation(){return 0!==_.ownuseridentity_hasVerificationViolation(this.__wbg_ptr)}}const rr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_pickledinboundgroupsession_free(e>>>0,1));class nr{static __unwrap(e){return e instanceof nr?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,rr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_pickledinboundgroupsession_free(e,0)}get pickle(){let e,t;try{const r=_.__wbg_get_pickledinboundgroupsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set pickle(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=_.__wbg_get_pickledinboundgroupsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set senderKey(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get senderSigningKey(){const e=_.__wbg_get_pickledinboundgroupsession_senderSigningKey(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}set senderSigningKey(e){var t=S(e)?0:h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_basemigrationdata_backupRecoveryKey(this.__wbg_ptr,t,r)}get roomId(){const e=_.__wbg_get_pickledinboundgroupsession_roomId(this.__wbg_ptr);return 0===e?void 0:Cr.__wrap(e)}set roomId(e){let t=0;S(e)||(M(e,Cr),t=e.__destroy_into_raw()),_.__wbg_set_pickledinboundgroupsession_roomId(this.__wbg_ptr,t)}get imported(){return 0!==_.__wbg_get_pickledinboundgroupsession_imported(this.__wbg_ptr)}set imported(e){_.__wbg_set_pickledinboundgroupsession_imported(this.__wbg_ptr,e)}get backedUp(){return 0!==_.__wbg_get_pickledinboundgroupsession_backedUp(this.__wbg_ptr)}set backedUp(e){_.__wbg_set_pickledinboundgroupsession_backedUp(this.__wbg_ptr,e)}constructor(){const e=_.pickledinboundgroupsession_new();return this.__wbg_ptr=e>>>0,rr.register(this,this.__wbg_ptr,this),this}}const ir="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_pickledsession_free(e>>>0,1));class sr{static __unwrap(e){return e instanceof sr?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ir.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_pickledsession_free(e,0)}get pickle(){let e,t;try{const r=_.__wbg_get_pickledsession_pickle(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set pickle(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get senderKey(){let e,t;try{const r=_.__wbg_get_pickledsession_senderKey(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set senderKey(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_backup_version(this.__wbg_ptr,t,r)}get createdUsingFallbackKey(){return 0!==_.__wbg_get_pickledsession_createdUsingFallbackKey(this.__wbg_ptr)}set createdUsingFallbackKey(e){_.__wbg_set_pickledsession_createdUsingFallbackKey(this.__wbg_ptr,e)}get creationTime(){return _.__wbg_get_pickledsession_creationTime(this.__wbg_ptr)}set creationTime(e){_.__wbg_set_pickledsession_creationTime(this.__wbg_ptr,e)}get lastUseTime(){return _.__wbg_get_pickledsession_lastUseTime(this.__wbg_ptr)}set lastUseTime(e){_.__wbg_set_pickledsession_lastUseTime(this.__wbg_ptr,e)}constructor(){const e=_.pickledsession_new();return this.__wbg_ptr=e>>>0,ir.register(this,this.__wbg_ptr,this),this}}const _r="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_pkdecryption_free(e>>>0,1));class or{static __wrap(e){e>>>=0;const t=Object.create(or.prototype);return t.__wbg_ptr=e,_r.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,_r.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_pkdecryption_free(e,0)}constructor(){const e=_.pkdecryption_new();return this.__wbg_ptr=e>>>0,_r.register(this,this.__wbg_ptr,this),this}static fromKey(e){M(e,Te);const t=_.pkdecryption_fromKey(e.__wbg_ptr);return or.__wrap(t)}secretKey(){const e=_.pkdecryption_secretKey(this.__wbg_ptr);return Te.__wrap(e)}publicKey(){const e=_.pkdecryption_publicKey(this.__wbg_ptr);return qe.__wrap(e)}decryptString(e){let t,r;try{M(e,ur);const s=_.pkdecryption_decryptString(this.__wbg_ptr,e.__wbg_ptr);var n=s[0],i=s[1];if(s[3])throw n=0,i=0,D(s[2]);return t=n,r=i,p(n,i)}finally{_.__wbindgen_free(t,r,1)}}decrypt(e){M(e,ur);const t=_.pkdecryption_decrypt(this.__wbg_ptr,e.__wbg_ptr);if(t[3])throw D(t[2]);var r=R(t[0],t[1]).slice();return _.__wbindgen_free(t[0],1*t[1],1),r}}const ar="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_pkencryption_free(e>>>0,1));class cr{static __wrap(e){e>>>=0;const t=Object.create(cr.prototype);return t.__wbg_ptr=e,ar.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ar.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_pkencryption_free(e,0)}static fromKey(e){M(e,qe);const t=_.pkencryption_fromKey(e.__wbg_ptr);return cr.__wrap(t)}encrypt(e){const t=E(e,_.__wbindgen_malloc),r=w,n=_.pkencryption_encrypt(this.__wbg_ptr,t,r);return ur.__wrap(n)}encryptString(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.pkencryption_encrypt(this.__wbg_ptr,t,r);return ur.__wrap(n)}}const gr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_pkmessage_free(e>>>0,1));class ur{static __wrap(e){e>>>=0;const t=Object.create(ur.prototype);return t.__wbg_ptr=e,gr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,gr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_pkmessage_free(e,0)}ciphertext(){const e=_.pkmessage_ciphertext(this.__wbg_ptr);var t=R(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}mac(){const e=_.pkmessage_mac(this.__wbg_ptr);var t=R(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}ephemeralKey(){const e=_.pkmessage_ephemeralKey(this.__wbg_ptr);return qe.__wrap(e)}static fromParts(e,t,r){const n=E(e,_.__wbindgen_malloc),i=w,s=E(t,_.__wbindgen_malloc),o=w;M(r,qe);const a=_.pkmessage_fromParts(n,i,s,o,r.__wbg_ptr);return ur.__wrap(a)}static fromBase64(e){M(e,be);const t=_.pkmessage_fromBase64(e.__wbg_ptr);if(t[2])throw D(t[1]);return ur.__wrap(t[0])}toBase64(){const e=_.pkmessage_toBase64(this.__wbg_ptr);return be.__wrap(e)}}const dr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_plaintexttodeviceevent_free(e>>>0,1));class lr{static __wrap(e){e>>>=0;const t=Object.create(lr.prototype);return t.__wbg_ptr=e,dr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,dr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_plaintexttodeviceevent_free(e,0)}get rawEvent(){return _.__wbg_get_plaintexttodeviceevent_rawEvent(this.__wbg_ptr)}get type(){return _.plaintexttodeviceevent_type(this.__wbg_ptr)}}const pr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_putdehydrateddevicerequest_free(e>>>0,1));class wr{static __wrap(e){e>>>=0;const t=Object.create(wr.prototype);return t.__wbg_ptr=e,pr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_putdehydrateddevicerequest_free(e,0)}get body(){return _.__wbg_get_putdehydrateddevicerequest_body(this.__wbg_ptr)}constructor(e){const t=_.putdehydrateddevicerequest_new(e);return this.__wbg_ptr=t>>>0,pr.register(this,this.__wbg_ptr,this),this}}const yr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_qr_free(e>>>0,1));class br{static __wrap(e){e>>>=0;const t=Object.create(br.prototype);return t.__wbg_ptr=e,yr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,yr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_qr_free(e,0)}state(){return _.qr_state(this.__wbg_ptr)}hasBeenScanned(){return 0!==_.qr_hasBeenScanned(this.__wbg_ptr)}hasBeenConfirmed(){return 0!==_.qr_hasBeenConfirmed(this.__wbg_ptr)}get userId(){const e=_.qr_userId(this.__wbg_ptr);return kn.__wrap(e)}get otherUserId(){const e=_.qr_otherUserId(this.__wbg_ptr);return kn.__wrap(e)}get otherDeviceId(){const e=_.qr_otherDeviceId(this.__wbg_ptr);return Xe.__wrap(e)}weStarted(){return 0!==_.qr_weStarted(this.__wbg_ptr)}cancelInfo(){const e=_.qr_cancelInfo(this.__wbg_ptr);return 0===e?void 0:me.__wrap(e)}isDone(){return 0!==_.qr_isDone(this.__wbg_ptr)}isCancelled(){return 0!==_.qr_isCancelled(this.__wbg_ptr)}isSelfVerification(){return 0!==_.qr_isSelfVerification(this.__wbg_ptr)}reciprocated(){return 0!==_.qr_reciprocated(this.__wbg_ptr)}get flowId(){let e,t;try{const r=_.qr_flowId(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get roomId(){const e=_.qr_roomId(this.__wbg_ptr);return 0===e?void 0:Cr.__wrap(e)}toQrCode(){const e=_.qr_toQrCode(this.__wbg_ptr);if(e[2])throw D(e[1]);return fr.__wrap(e[0])}toBytes(){const e=_.qr_toBytes(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}reciprocate(){const e=_.qr_reciprocate(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}confirmScanning(){const e=_.qr_confirmScanning(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}cancel(){const e=_.qr_cancel(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}cancelWithCode(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.qr_cancelWithCode(this.__wbg_ptr,t,r);if(n[2])throw D(n[1]);return D(n[0])}registerChangesCallback(e){_.qr_registerChangesCallback(this.__wbg_ptr,e)}}const hr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_qrcode_free(e>>>0,1));class fr{static __wrap(e){e>>>=0;const t=Object.create(fr.prototype);return t.__wbg_ptr=e,hr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,hr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_qrcode_free(e,0)}renderIntoBuffer(){const e=_.qrcode_renderIntoBuffer(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}}const vr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_qrcodedata_free(e>>>0,1));class mr{static __wrap(e){e>>>=0;const t=Object.create(mr.prototype);return t.__wbg_ptr=e,vr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,vr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_qrcodedata_free(e,0)}constructor(e,t,r){M(e,qe);var n=e.__destroy_into_raw();const i=h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),s=w;var o=S(r)?0:h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),a=w;const c=_.qrcodedata_new(n,i,s,o,a);if(c[2])throw D(c[1]);return this.__wbg_ptr=c[0]>>>0,vr.register(this,this.__wbg_ptr,this),this}static fromBytes(e){const t=E(e,_.__wbindgen_malloc),r=w,n=_.qrcodedata_fromBytes(t,r);if(n[2])throw D(n[1]);return mr.__wrap(n[0])}toBytes(){const e=_.qrcodedata_toBytes(this.__wbg_ptr);var t=R(e[0],e[1]).slice();return _.__wbindgen_free(e[0],1*e[1],1),t}static fromBase64(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.qrcodedata_fromBase64(t,r);if(n[2])throw D(n[1]);return mr.__wrap(n[0])}toBase64(){let e,t;try{const r=_.qrcodedata_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get publicKey(){const e=_.qrcodedata_publicKey(this.__wbg_ptr);return qe.__wrap(e)}get rendezvousUrl(){let e,t;try{const r=_.qrcodedata_rendezvousUrl(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get serverName(){const e=_.qrcodedata_serverName(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}get mode(){return _.qrcodedata_mode(this.__wbg_ptr)}}const kr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_qrcodescan_free(e>>>0,1));class Sr{static __wrap(e){e>>>=0;const t=Object.create(Sr.prototype);return t.__wbg_ptr=e,kr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,kr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_qrcodescan_free(e,0)}static fromBytes(e){const t=_.qrcodescan_fromBytes(e);if(t[2])throw D(t[1]);return Sr.__wrap(t[0])}}const Rr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_rehydrateddevice_free(e>>>0,1));class Kr{static __wrap(e){e>>>=0;const t=Object.create(Kr.prototype);return t.__wbg_ptr=e,Rr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Rr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_rehydrateddevice_free(e,0)}receiveEvents(e,t){const r=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w;let i=0;return S(t)||(M(t,ze),i=t.__destroy_into_raw()),_.rehydrateddevice_receiveEvents(this.__wbg_ptr,r,n,i)}}const Ir="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_roomid_free(e>>>0,1));class Cr{static __wrap(e){e>>>=0;const t=Object.create(Cr.prototype);return t.__wbg_ptr=e,Ir.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof Cr?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ir.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomid_free(e,0)}constructor(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.roomid_new(t,r);if(n[2])throw D(n[1]);return this.__wbg_ptr=n[0]>>>0,Ir.register(this,this.__wbg_ptr,this),this}toString(){let e,t;try{const r=_.roomid_toString(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Or="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_roomkeycounts_free(e>>>0,1));class Er{static __wrap(e){e>>>=0;const t=Object.create(Er.prototype);return t.__wbg_ptr=e,Or.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Or.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomkeycounts_free(e,0)}get total(){return _.__wbg_get_roomkeycounts_total(this.__wbg_ptr)}set total(e){_.__wbg_set_roomkeycounts_total(this.__wbg_ptr,e)}get backedUp(){return _.__wbg_get_roomkeycounts_backedUp(this.__wbg_ptr)}set backedUp(e){_.__wbg_set_roomkeycounts_backedUp(this.__wbg_ptr,e)}}const Dr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_roomkeyimportresult_free(e>>>0,1));class Mr{static __wrap(e){e>>>=0;const t=Object.create(Mr.prototype);return t.__wbg_ptr=e,Dr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Dr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomkeyimportresult_free(e,0)}get importedCount(){return _.__wbg_get_roomkeyimportresult_importedCount(this.__wbg_ptr)>>>0}get totalCount(){return _.__wbg_get_roomkeyimportresult_totalCount(this.__wbg_ptr)>>>0}keys(){return _.roomkeyimportresult_keys(this.__wbg_ptr)}}const Ar="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_roomkeyinfo_free(e>>>0,1));class qr{static __wrap(e){e>>>=0;const t=Object.create(qr.prototype);return t.__wbg_ptr=e,Ar.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Ar.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomkeyinfo_free(e,0)}get algorithm(){return _.roomkeyinfo_algorithm(this.__wbg_ptr)}get roomId(){const e=_.roomkeyinfo_roomId(this.__wbg_ptr);return Cr.__wrap(e)}get senderKey(){const e=_.roomkeyinfo_senderKey(this.__wbg_ptr);return qe.__wrap(e)}get sessionId(){let e,t;try{const r=_.roomkeyinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Br="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_roomkeywithheldinfo_free(e>>>0,1));class Tr{static __wrap(e){e>>>=0;const t=Object.create(Tr.prototype);return t.__wbg_ptr=e,Br.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Br.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomkeywithheldinfo_free(e,0)}get sender(){const e=_.roomkeywithheldinfo_sender(this.__wbg_ptr);return kn.__wrap(e)}get algorithm(){return _.roomkeywithheldinfo_algorithm(this.__wbg_ptr)}get withheldCode(){let e,t;try{const r=_.roomkeywithheldinfo_withheldCode(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get roomId(){const e=_.roomkeywithheldinfo_roomId(this.__wbg_ptr);return Cr.__wrap(e)}get sessionId(){let e,t;try{const r=_.roomkeywithheldinfo_sessionId(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Fr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_roommessagerequest_free(e>>>0,1));class Ur{static __wrap(e){e>>>=0;const t=Object.create(Ur.prototype);return t.__wbg_ptr=e,Fr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Fr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roommessagerequest_free(e,0)}get id(){return _.__wbg_get_roommessagerequest_id(this.__wbg_ptr)}get room_id(){return _.__wbg_get_roommessagerequest_room_id(this.__wbg_ptr)}get txn_id(){return _.__wbg_get_roommessagerequest_txn_id(this.__wbg_ptr)}get event_type(){return _.__wbg_get_roommessagerequest_event_type(this.__wbg_ptr)}get body(){return _.__wbg_get_roommessagerequest_body(this.__wbg_ptr)}constructor(e,t,r,n,i){const s=_.roommessagerequest_new(e,t,r,n,i);return this.__wbg_ptr=s>>>0,Fr.register(this,this.__wbg_ptr,this),this}get type(){return _.roommessagerequest_type(this.__wbg_ptr)}}const Vr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_roomsettings_free(e>>>0,1));class Pr{static __wrap(e){e>>>=0;const t=Object.create(Pr.prototype);return t.__wbg_ptr=e,Vr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Vr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_roomsettings_free(e,0)}get algorithm(){return _.__wbg_get_roomsettings_algorithm(this.__wbg_ptr)}set algorithm(e){_.__wbg_set_roomsettings_algorithm(this.__wbg_ptr,e)}get encryptStateEvents(){return 0!==_.__wbg_get_roomsettings_encryptStateEvents(this.__wbg_ptr)}set encryptStateEvents(e){_.__wbg_set_roomsettings_encryptStateEvents(this.__wbg_ptr,e)}get onlyAllowTrustedDevices(){return 0!==_.__wbg_get_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr)}set onlyAllowTrustedDevices(e){_.__wbg_set_roomsettings_onlyAllowTrustedDevices(this.__wbg_ptr,e)}get sessionRotationPeriodMs(){const e=_.__wbg_get_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}set sessionRotationPeriodMs(e){_.__wbg_set_roomsettings_sessionRotationPeriodMs(this.__wbg_ptr,!S(e),S(e)?0:e)}get sessionRotationPeriodMessages(){const e=_.__wbg_get_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}set sessionRotationPeriodMessages(e){_.__wbg_set_roomsettings_sessionRotationPeriodMessages(this.__wbg_ptr,!S(e),S(e)?0:e)}constructor(){const e=_.roomsettings_new();return this.__wbg_ptr=e>>>0,Vr.register(this,this.__wbg_ptr,this),this}}const Nr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_sas_free(e>>>0,1));class zr{static __wrap(e){e>>>=0;const t=Object.create(zr.prototype);return t.__wbg_ptr=e,Nr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Nr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_sas_free(e,0)}get userId(){const e=_.sas_userId(this.__wbg_ptr);return kn.__wrap(e)}get deviceId(){const e=_.sas_deviceId(this.__wbg_ptr);return Xe.__wrap(e)}get otherUserId(){const e=_.sas_otherUserId(this.__wbg_ptr);return kn.__wrap(e)}get otherDeviceId(){const e=_.sas_otherDeviceId(this.__wbg_ptr);return Xe.__wrap(e)}get flowId(){let e,t;try{const r=_.sas_flowId(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get roomId(){const e=_.sas_roomId(this.__wbg_ptr);return 0===e?void 0:Cr.__wrap(e)}supportsEmoji(){return 0!==_.sas_supportsEmoji(this.__wbg_ptr)}startedFromRequest(){return 0!==_.sas_startedFromRequest(this.__wbg_ptr)}isSelfVerification(){return 0!==_.sas_isSelfVerification(this.__wbg_ptr)}haveWeConfirmed(){return 0!==_.sas_haveWeConfirmed(this.__wbg_ptr)}hasBeenAccepted(){return 0!==_.sas_hasBeenAccepted(this.__wbg_ptr)}cancelInfo(){const e=_.sas_cancelInfo(this.__wbg_ptr);return 0===e?void 0:me.__wrap(e)}weStarted(){return 0!==_.sas_weStarted(this.__wbg_ptr)}accept(){const e=_.sas_accept(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}confirm(){return _.sas_confirm(this.__wbg_ptr)}cancel(){const e=_.sas_cancel(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}cancelWithCode(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.sas_cancelWithCode(this.__wbg_ptr,t,r);if(n[2])throw D(n[1]);return D(n[0])}timedOut(){return 0!==_.sas_timedOut(this.__wbg_ptr)}canBePresented(){return 0!==_.sas_canBePresented(this.__wbg_ptr)}isDone(){return 0!==_.sas_isDone(this.__wbg_ptr)}isCancelled(){return 0!==_.sas_isCancelled(this.__wbg_ptr)}emoji(){const e=_.sas_emoji(this.__wbg_ptr);let t;return 0!==e[0]&&(t=q(e[0],e[1]).slice(),_.__wbindgen_free(e[0],4*e[1],4)),t}emojiIndex(){const e=_.sas_emojiIndex(this.__wbg_ptr);let t;return 0!==e[0]&&(t=R(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}decimals(){const e=_.sas_decimals(this.__wbg_ptr);let t;return 0!==e[0]&&(t=(r=e[0],n=e[1],r>>>=0,(null!==B&&0!==B.byteLength||(B=new Uint16Array(_.memory.buffer)),B).subarray(r/2,r/2+n)).slice(),_.__wbindgen_free(e[0],2*e[1],2)),t;var r,n}registerChangesCallback(e){_.sas_registerChangesCallback(this.__wbg_ptr,e)}}const xr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_secretsbundle_free(e>>>0,1));class jr{static __wrap(e){e>>>=0;const t=Object.create(jr.prototype);return t.__wbg_ptr=e,xr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,xr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_secretsbundle_free(e,0)}get masterKey(){let e,t;try{const r=_.secretsbundle_masterKey(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get selfSigningKey(){let e,t;try{const r=_.secretsbundle_selfSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get userSigningKey(){let e,t;try{const r=_.secretsbundle_userSigningKey(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get backupBundle(){const e=_.secretsbundle_backupBundle(this.__wbg_ptr);return 0===e?void 0:we.__wrap(e)}to_json(){const e=_.secretsbundle_to_json(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}static from_json(e){const t=_.secretsbundle_from_json(e);if(t[2])throw D(t[1]);return jr.__wrap(t[0])}}const Lr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_servername_free(e>>>0,1));class Wr{static __wrap(e){e>>>=0;const t=Object.create(Wr.prototype);return t.__wbg_ptr=e,Lr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Lr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_servername_free(e,0)}constructor(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.servername_new(t,r);if(n[2])throw D(n[1]);return this.__wbg_ptr=n[0]>>>0,Lr.register(this,this.__wbg_ptr,this),this}get host(){let e,t;try{const r=_.servername_host(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get port(){const e=_.servername_port(this.__wbg_ptr);return 16777215===e?void 0:e}isIpLiteral(){return 0!==_.servername_isIpLiteral(this.__wbg_ptr)}}const Gr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_shieldstate_free(e>>>0,1));class Qr{static __wrap(e){e>>>=0;const t=Object.create(Qr.prototype);return t.__wbg_ptr=e,Gr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Gr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_shieldstate_free(e,0)}get color(){return _.__wbg_get_shieldstate_color(this.__wbg_ptr)}set color(e){_.__wbg_set_shieldstate_color(this.__wbg_ptr,e)}get code(){const e=_.__wbg_get_shieldstate_code(this.__wbg_ptr);return 7===e?void 0:e}set code(e){_.__wbg_set_shieldstate_code(this.__wbg_ptr,S(e)?7:e)}get message(){const e=_.shieldstate_message(this.__wbg_ptr);let t;return 0!==e[0]&&(t=p(e[0],e[1]).slice(),_.__wbindgen_free(e[0],1*e[1],1)),t}}const Jr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_signature_free(e>>>0,1));class Hr{static __wrap(e){e>>>=0;const t=Object.create(Hr.prototype);return t.__wbg_ptr=e,Jr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Jr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_signature_free(e,0)}get ed25519(){const e=_.signature_ed25519(this.__wbg_ptr);return 0===e?void 0:ut.__wrap(e)}toBase64(){let e,t;try{const r=_.signature_toBase64(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const Yr="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_signatureuploadrequest_free(e>>>0,1));class Xr{static __wrap(e){e>>>=0;const t=Object.create(Xr.prototype);return t.__wbg_ptr=e,Yr.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Yr.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_signatureuploadrequest_free(e,0)}get id(){return _.__wbg_get_signatureuploadrequest_id(this.__wbg_ptr)}get body(){return _.__wbg_get_signatureuploadrequest_body(this.__wbg_ptr)}constructor(e,t){const r=_.signatureuploadrequest_new(e,t);return this.__wbg_ptr=r>>>0,Yr.register(this,this.__wbg_ptr,this),this}get type(){return _.signatureuploadrequest_type(this.__wbg_ptr)}}const $r="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_signatureverification_free(e>>>0,1));class Zr{static __wrap(e){e>>>=0;const t=Object.create(Zr.prototype);return t.__wbg_ptr=e,$r.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,$r.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_signatureverification_free(e,0)}get deviceState(){return _.signatureverification_deviceState(this.__wbg_ptr)}get userState(){return _.signatureverification_userState(this.__wbg_ptr)}trusted(){return 0!==_.signatureverification_trusted(this.__wbg_ptr)}}const en="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_signatures_free(e>>>0,1));class tn{static __wrap(e){e>>>=0;const t=Object.create(tn.prototype);return t.__wbg_ptr=e,en.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,en.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_signatures_free(e,0)}constructor(){const e=_.signatures_new();return this.__wbg_ptr=e>>>0,en.register(this,this.__wbg_ptr,this),this}addSignature(e,t,r){M(e,kn),M(t,nt),M(r,ut);const n=_.signatures_addSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr);return 0===n?void 0:zt.__wrap(n)}getSignature(e,t){M(e,kn),M(t,nt);const r=_.signatures_getSignature(this.__wbg_ptr,e.__wbg_ptr,t.__wbg_ptr);return 0===r?void 0:ut.__wrap(r)}get(e){return M(e,kn),_.signatures_get(this.__wbg_ptr,e.__wbg_ptr)}clear(){_.signatures_clear(this.__wbg_ptr)}isEmpty(){return 0!==_.signatures_isEmpty(this.__wbg_ptr)}get count(){return _.signatures_count(this.__wbg_ptr)>>>0}asJSON(){const e=_.signatures_asJSON(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}}const rn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_storehandle_free(e>>>0,1));class nn{static __wrap(e){e>>>=0;const t=Object.create(nn.prototype);return t.__wbg_ptr=e,rn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,rn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_storehandle_free(e,0)}static open(e,t,r){var n=S(e)?0:h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w,s=S(t)?0:h(t,_.__wbindgen_malloc,_.__wbindgen_realloc),o=w;return _.storehandle_open(n,i,s,o,S(r)?0:m(r))}static openWithKey(e,t,r){const n=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w,s=E(t,_.__wbindgen_malloc),o=w;return _.storehandle_openWithKey(n,i,s,o,S(r)?0:m(r))}}const sn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_storedroomkeybundledata_free(e>>>0,1));class _n{static __wrap(e){e>>>=0;const t=Object.create(_n.prototype);return t.__wbg_ptr=e,sn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,sn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_storedroomkeybundledata_free(e,0)}get senderUser(){const e=_.storedroomkeybundledata_senderUser(this.__wbg_ptr);return kn.__wrap(e)}get roomId(){const e=_.storedroomkeybundledata_roomId(this.__wbg_ptr);return Cr.__wrap(e)}get url(){let e,t;try{const r=_.storedroomkeybundledata_url(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get encryptionInfo(){let e,t;try{const r=_.storedroomkeybundledata_encryptionInfo(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}}const on="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_todeviceencryptioninfo_free(e>>>0,1));class an{static __wrap(e){e>>>=0;const t=Object.create(an.prototype);return t.__wbg_ptr=e,on.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,on.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_todeviceencryptioninfo_free(e,0)}get senderCurve25519Key(){let e,t;try{const r=_.__wbg_get_todeviceencryptioninfo_senderCurve25519Key(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}set senderCurve25519Key(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w;_.__wbg_set_backupsecretsbundle_key(this.__wbg_ptr,t,r)}get sender(){const e=_.__wbg_get_todeviceencryptioninfo_sender(this.__wbg_ptr);return kn.__wrap(e)}set sender(e){M(e,kn);var t=e.__destroy_into_raw();_.__wbg_set_todeviceencryptioninfo_sender(this.__wbg_ptr,t)}get senderDevice(){const e=_.__wbg_get_todeviceencryptioninfo_senderDevice(this.__wbg_ptr);return 0===e?void 0:Xe.__wrap(e)}set senderDevice(e){let t=0;S(e)||(M(e,Xe),t=e.__destroy_into_raw()),_.__wbg_set_todeviceencryptioninfo_senderDevice(this.__wbg_ptr,t)}isSenderVerified(){return 0!==_.todeviceencryptioninfo_isSenderVerified(this.__wbg_ptr)}}const cn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_todevicerequest_free(e>>>0,1));class gn{static __wrap(e){e>>>=0;const t=Object.create(gn.prototype);return t.__wbg_ptr=e,cn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,cn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_todevicerequest_free(e,0)}get id(){return _.__wbg_get_todevicerequest_id(this.__wbg_ptr)}get event_type(){return _.__wbg_get_todevicerequest_event_type(this.__wbg_ptr)}get txn_id(){return _.__wbg_get_todevicerequest_txn_id(this.__wbg_ptr)}get body(){return _.__wbg_get_todevicerequest_body(this.__wbg_ptr)}constructor(e,t,r,n){const i=_.todevicerequest_new(e,t,r,n);return this.__wbg_ptr=i>>>0,cn.register(this,this.__wbg_ptr,this),this}get type(){return _.todevicerequest_type(this.__wbg_ptr)}}const un="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_todeviceunabletodecryptinfo_free(e>>>0,1));class dn{static __wrap(e){e>>>=0;const t=Object.create(dn.prototype);return t.__wbg_ptr=e,un.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,un.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_todeviceunabletodecryptinfo_free(e,0)}get reason(){return _.__wbg_get_todeviceunabletodecryptinfo_reason(this.__wbg_ptr)}set reason(e){_.__wbg_set_todeviceunabletodecryptinfo_reason(this.__wbg_ptr,e)}}const ln="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_tracing_free(e>>>0,1));class pn{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ln.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_tracing_free(e,0)}static isAvailable(){return 0!==_.tracing_isAvailable()}constructor(e){const t=_.tracing_new(e);if(t[2])throw D(t[1]);return this.__wbg_ptr=t[0]>>>0,ln.register(this,this.__wbg_ptr,this),this}set minLevel(e){const t=_.tracing_set_minLevel(this.__wbg_ptr,e);if(t[1])throw D(t[0])}turnOn(){const e=_.tracing_turnOn(this.__wbg_ptr);if(e[1])throw D(e[0])}turnOff(){const e=_.tracing_turnOff(this.__wbg_ptr);if(e[1])throw D(e[0])}}const wn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_utdtodeviceevent_free(e>>>0,1));class yn{static __wrap(e){e>>>=0;const t=Object.create(yn.prototype);return t.__wbg_ptr=e,wn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,wn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_utdtodeviceevent_free(e,0)}get rawEvent(){return _.__wbg_get_utdtodeviceevent_rawEvent(this.__wbg_ptr)}get utdInfo(){const e=_.__wbg_get_utdtodeviceevent_utdInfo(this.__wbg_ptr);return dn.__wrap(e)}get type(){return _.utdtodeviceevent_type(this.__wbg_ptr)}}const bn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_uploadsigningkeysrequest_free(e>>>0,1));class hn{static __wrap(e){e>>>=0;const t=Object.create(hn.prototype);return t.__wbg_ptr=e,bn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,bn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_uploadsigningkeysrequest_free(e,0)}get body(){return _.__wbg_get_uploadsigningkeysrequest_body(this.__wbg_ptr)}constructor(e){const t=_.uploadsigningkeysrequest_new(e);return this.__wbg_ptr=t>>>0,bn.register(this,this.__wbg_ptr,this),this}}const fn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_userdevices_free(e>>>0,1));class vn{static __wrap(e){e>>>=0;const t=Object.create(vn.prototype);return t.__wbg_ptr=e,fn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,fn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_userdevices_free(e,0)}get(e){M(e,Xe);const t=_.userdevices_get(this.__wbg_ptr,e.__wbg_ptr);return 0===t?void 0:He.__wrap(t)}isAnyVerified(){return 0!==_.userdevices_isAnyVerified(this.__wbg_ptr)}keys(){return _.userdevices_keys(this.__wbg_ptr)}devices(){return _.userdevices_devices(this.__wbg_ptr)}}const mn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_userid_free(e>>>0,1));class kn{static __wrap(e){e>>>=0;const t=Object.create(kn.prototype);return t.__wbg_ptr=e,mn.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof kn?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,mn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_userid_free(e,0)}constructor(e){const t=h(e,_.__wbindgen_malloc,_.__wbindgen_realloc),r=w,n=_.userid_new(t,r);if(n[2])throw D(n[1]);return this.__wbg_ptr=n[0]>>>0,mn.register(this,this.__wbg_ptr,this),this}get localpart(){let e,t;try{const r=_.userid_localpart(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}get serverName(){const e=_.userid_serverName(this.__wbg_ptr);return Wr.__wrap(e)}isHistorical(){return 0!==_.userid_isHistorical(this.__wbg_ptr)}toString(){let e,t;try{const r=_.userid_toString(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}clone(){const e=_.userid_clone(this.__wbg_ptr);return kn.__wrap(e)}}const Sn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_verificationrequest_free(e>>>0,1));class Rn{static __wrap(e){e>>>=0;const t=Object.create(Rn.prototype);return t.__wbg_ptr=e,Sn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Sn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_verificationrequest_free(e,0)}static request(e,t,r,n){let i,s;try{M(e,kn),M(t,Xe),M(r,kn);var o=S(n)?0:A(n,_.__wbindgen_malloc),a=w;const u=_.verificationrequest_request(e.__wbg_ptr,t.__wbg_ptr,r.__wbg_ptr,o,a);var c=u[0],g=u[1];if(u[3])throw c=0,g=0,D(u[2]);return i=c,s=g,p(c,g)}finally{_.__wbindgen_free(i,s,1)}}get ownUserId(){const e=_.verificationrequest_ownUserId(this.__wbg_ptr);return kn.__wrap(e)}get otherUserId(){const e=_.verificationrequest_otherUserId(this.__wbg_ptr);return kn.__wrap(e)}get otherDeviceId(){const e=_.verificationrequest_otherDeviceId(this.__wbg_ptr);return 0===e?void 0:Xe.__wrap(e)}get roomId(){const e=_.verificationrequest_roomId(this.__wbg_ptr);return 0===e?void 0:Cr.__wrap(e)}get cancelInfo(){const e=_.verificationrequest_cancelInfo(this.__wbg_ptr);return 0===e?void 0:me.__wrap(e)}isPassive(){return 0!==_.verificationrequest_isPassive(this.__wbg_ptr)}isReady(){return 0!==_.verificationrequest_isReady(this.__wbg_ptr)}timedOut(){return 0!==_.verificationrequest_timedOut(this.__wbg_ptr)}timeRemainingMillis(){return _.verificationrequest_timeRemainingMillis(this.__wbg_ptr)}get theirSupportedMethods(){const e=_.verificationrequest_theirSupportedMethods(this.__wbg_ptr);if(e[3])throw D(e[2]);let t;return 0!==e[0]&&(t=q(e[0],e[1]).slice(),_.__wbindgen_free(e[0],4*e[1],4)),t}get ourSupportedMethods(){const e=_.verificationrequest_ourSupportedMethods(this.__wbg_ptr);if(e[3])throw D(e[2]);let t;return 0!==e[0]&&(t=q(e[0],e[1]).slice(),_.__wbindgen_free(e[0],4*e[1],4)),t}get flowId(){let e,t;try{const r=_.verificationrequest_flowId(this.__wbg_ptr);return e=r[0],t=r[1],p(r[0],r[1])}finally{_.__wbindgen_free(e,t,1)}}isSelfVerification(){return 0!==_.verificationrequest_isSelfVerification(this.__wbg_ptr)}weStarted(){return 0!==_.verificationrequest_weStarted(this.__wbg_ptr)}isDone(){return 0!==_.verificationrequest_isDone(this.__wbg_ptr)}phase(){return _.verificationrequest_phase(this.__wbg_ptr)}getVerification(){return _.verificationrequest_getVerification(this.__wbg_ptr)}registerChangesCallback(e){_.verificationrequest_registerChangesCallback(this.__wbg_ptr,e)}isCancelled(){return 0!==_.verificationrequest_isCancelled(this.__wbg_ptr)}acceptWithMethods(e){const t=A(e,_.__wbindgen_malloc),r=w,n=_.verificationrequest_acceptWithMethods(this.__wbg_ptr,t,r);if(n[2])throw D(n[1]);return D(n[0])}accept(){const e=_.verificationrequest_accept(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}cancel(){const e=_.verificationrequest_cancel(this.__wbg_ptr);if(e[2])throw D(e[1]);return D(e[0])}startSas(){return _.verificationrequest_startSas(this.__wbg_ptr)}generateQrCode(){return _.verificationrequest_generateQrCode(this.__wbg_ptr)}scanQrCode(e){return M(e,Sr),_.verificationrequest_scanQrCode(this.__wbg_ptr,e.__wbg_ptr)}}const Kn="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>_.__wbg_versions_free(e>>>0,1));class In{static __wrap(e){e>>>=0;const t=Object.create(In.prototype);return t.__wbg_ptr=e,Kn.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Kn.unregister(this),e}free(){const e=this.__destroy_into_raw();_.__wbg_versions_free(e,0)}get vodozemac(){return _.__wbg_get_versions_vodozemac(this.__wbg_ptr)}get matrix_sdk_crypto(){return _.__wbg_get_versions_matrix_sdk_crypto(this.__wbg_ptr)}get git_sha(){return _.__wbg_get_versions_git_sha(this.__wbg_ptr)}get git_description(){return _.__wbg_get_versions_git_description(this.__wbg_ptr)}}function Cn(e,t){return Error(p(e,t))}function On(e,t){const r=h(String(t),_.__wbindgen_malloc,_.__wbindgen_realloc),n=w;v().setInt32(e+4,n,!0),v().setInt32(e+0,r,!0)}function En(e){return e.Window}function Dn(e){return e.WorkerGlobalScope}function Mn(){return k(function(e,t,r){return e.add(t,r)},arguments)}function An(e,t){return e.add(t)}function qn(e,t){return e.at(t)}function Bn(e){return le.__wrap(e)}function Tn(){return k(function(e,t){return IDBKeyRange.bound(e,t)},arguments)}function Fn(){return k(function(e,t,r,n){return IDBKeyRange.bound(e,t,0!==r,0!==n)},arguments)}function Un(e){return e.buffer}function Vn(){return k(function(e,t,r,n){return e.call(t,r,n)},arguments)}function Pn(){return k(function(e,t,r,n,i){return e.call(t,r,n,i)},arguments)}function Nn(){return k(function(e,t,r){return e.call(t,r)},arguments)}function zn(){return k(function(e,t){return e.call(t)},arguments)}function xn(e){return clearTimeout(e)}function jn(){return k(function(e){return e.clear()},arguments)}function Ln(e){e.close()}function Wn(e){return e.code}function Gn(){return k(function(e){e.continue()},arguments)}function Qn(){return k(function(e){return e.count()},arguments)}function Jn(){return k(function(e){return e.count()},arguments)}function Hn(){return k(function(e,t,r,n){return e.createIndex(p(t,r),n)},arguments)}function Yn(){return k(function(e,t,r,n,i){return e.createIndex(p(t,r),n,i)},arguments)}function Xn(){return k(function(e,t,r){return e.createObjectStore(p(t,r))},arguments)}function $n(e){return Ce.__wrap(e)}function Zn(e){return Ee.__wrap(e)}function ei(e){return Me.__wrap(e)}function ti(e){return e.crypto}function ri(e){console.debug(e)}function ni(e,t){e.debug(t)}function ii(e){return Ue.__wrap(e)}function si(e){return Pe.__wrap(e)}function _i(e){return je.__wrap(e)}function oi(e){return We.__wrap(e)}function ai(){return k(function(e,t,r){e.deleteObjectStore(p(t,r))},arguments)}function ci(){return k(function(e){return e.delete()},arguments)}function gi(){return k(function(e,t){return e.delete(t)},arguments)}function ui(e){return He.__wrap(e)}function di(e){return Xe.__wrap(e)}function li(e){return Ze.__wrap(e)}function pi(e){return nt.__wrap(e)}function wi(e){return e.done}function yi(e){return lt.__wrap(e)}function bi(e){return wt.__wrap(e)}function hi(e){return bt.__wrap(e)}function fi(e){return Object.entries(e)}function vi(e){return e.entries()}function mi(e,t){e.error(t)}function ki(){return k(function(e){const t=e.error;return S(t)?0:m(t)},arguments)}function Si(e){console.error(e)}function Ri(e,t){let r,n;try{r=e,n=t,console.error(p(e,t))}finally{_.__wbindgen_free(r,n,1)}}function Ki(e){return Array.from(e)}function Ii(){return k(function(e){return e.getAllKeys()},arguments)}function Ci(){return k(function(e){return e.getAll()},arguments)}function Oi(){return k(function(e,t,r){return e.getAll(t,r>>>0)},arguments)}function Ei(){return k(function(e,t){return e.getAll(t)},arguments)}function Di(){return k(function(e,t){globalThis.crypto.getRandomValues(R(e,t))},arguments)}function Mi(){return k(function(e,t){e.getRandomValues(t)},arguments)}function Ai(e){return e.getTime()}function qi(){return k(function(e,t){return Reflect.get(e,t)},arguments)}function Bi(e,t){return e[t>>>0]}function Ti(){return k(function(e,t){return e.get(t)},arguments)}function Fi(){return k(function(e,t){return e.get(t)},arguments)}function Ui(e,t){return e[t]}function Vi(e){return e.global}function Pi(e){return Et.__wrap(e)}function Ni(){return k(function(e,t,r){return e.index(p(t,r))},arguments)}function zi(){return k(function(e){const t=e.indexedDB;return S(t)?0:m(t)},arguments)}function xi(){return k(function(e){const t=e.indexedDB;return S(t)?0:m(t)},arguments)}function ji(){return k(function(e){const t=e.indexedDB;return S(t)?0:m(t)},arguments)}function Li(e){console.info(e)}function Wi(e,t){e.info(t)}function Gi(e){let t;try{t=e instanceof ArrayBuffer}catch(e){t=!1}return t}function Qi(e){let t;try{t=e instanceof Map}catch(e){t=!1}return t}function Ji(e){let t;try{t=e instanceof Promise}catch(e){t=!1}return t}function Hi(e){let t;try{t=e instanceof Uint8Array}catch(e){t=!1}return t}function Yi(e){return Mt.__wrap(e)}function Xi(e){return Array.isArray(e)}function $i(e){return Array.isArray(e)}function Zi(e){return Number.isSafeInteger(e)}function es(e,t,r){const n=t.item(r>>>0);var i=S(n)?0:h(n,_.__wbindgen_malloc,_.__wbindgen_realloc),s=w;v().setInt32(e+4,s,!0),v().setInt32(e+0,i,!0)}function ts(){return Symbol.iterator}function rs(){return k(function(e){return e.key},arguments)}function ns(e){return qt.__wrap(e)}function is(e){return Tt.__wrap(e)}function ss(e){return Ut.__wrap(e)}function _s(e){return Pt.__wrap(e)}function os(e){return e.length}function as(e){return e.length}function cs(e){return e.length}function gs(){return k(function(e,t){return IDBKeyRange.lowerBound(e,0!==t)},arguments)}function us(e){return zt.__wrap(e)}function ds(e){return jt.__wrap(e)}function ls(e,t){const r=h(t.message,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w;v().setInt32(e+4,n,!0),v().setInt32(e+0,r,!0)}function ps(e){return e.msCrypto}function ws(e,t){const r=h(t.name,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w;v().setInt32(e+4,n,!0),v().setInt32(e+0,r,!0)}function ys(){return new Object}function bs(){return new Array}function hs(){return new Error}function fs(e){return new Date(e)}function vs(){return new Map}function ms(e){return new Uint8ClampedArray(e)}function ks(e){return new Set(e)}function Ss(e,t){try{var r={a:e,b:t};const n=new Promise((e,t)=>{const n=r.a;r.a=0;try{return function(e,t,r,n){_.closure451_externref_shim(e,t,r,n)}(n,r.b,e,t)}finally{r.a=n}});return n}finally{r.a=r.b=0}}function Rs(e){return new Uint8Array(e)}function Ks(e,t){return new Function(p(e,t))}function Is(e,t,r){return new Uint8ClampedArray(e,t>>>0,r>>>0)}function Cs(e,t,r){return new Uint8Array(e,t>>>0,r>>>0)}function Os(e){return new Uint8Array(e>>>0)}function Es(e){return new Uint8ClampedArray(e>>>0)}function Ds(){return k(function(e,t){return new DOMException(p(e,t))},arguments)}function Ms(e){return e.next}function As(){return k(function(e){return e.next()},arguments)}function qs(e){return e.node}function Bs(e){return e.now()}function Ts(){return Date.now()}function Fs(e){return e.objectStoreNames}function Us(){return k(function(e,t,r){return e.objectStore(p(t,r))},arguments)}function Vs(e){return e.oldVersion}function Ps(e){return Ht.__wrap(e)}function Ns(){return k(function(e){return e.openCursor()},arguments)}function zs(){return k(function(e,t){return e.openCursor(t)},arguments)}function xs(){return k(function(e){return e.openCursor()},arguments)}function js(){return k(function(e,t,r,n){return e.open(p(t,r),n>>>0)},arguments)}function Ls(){return k(function(e,t,r){return e.open(p(t,r))},arguments)}function Ws(e){return Xt.__wrap(e)}function Gs(e){return tr.__wrap(e)}function Qs(){return k(function(e,t){return JSON.parse(p(e,t))},arguments)}function Js(e){return e.performance}function Hs(e){return nr.__unwrap(e)}function Ys(e){return sr.__unwrap(e)}function Xs(e){return lr.__wrap(e)}function $s(e){return e.process}function Zs(e,t){return e.push(t)}function e_(){return k(function(e,t,r){return e.put(t,r)},arguments)}function t_(e){return wr.__wrap(e)}function r_(e){return br.__wrap(e)}function n_(e){queueMicrotask(e)}function i_(e){return e.queueMicrotask}function s_(){return k(function(e,t){e.randomFillSync(t)},arguments)}function __(e){const t=e.readyState;return(_e.indexOf(t)+1||3)-1}function o_(e){return Kr.__wrap(e)}function a_(){return k(function(){return module.require},arguments)}function c_(e){return Promise.resolve(e)}function g_(){return k(function(e){return e.result},arguments)}function u_(e){return Cr.__unwrap(e)}function d_(e){return Er.__wrap(e)}function l_(e){return Mr.__wrap(e)}function p_(e){return qr.__wrap(e)}function w_(e){return Tr.__wrap(e)}function y_(e){return Ur.__wrap(e)}function b_(e){return Pr.__wrap(e)}function h_(e){return zr.__wrap(e)}function f_(e){return jr.__wrap(e)}function v_(){return k(function(e,t){return setTimeout(e,t)},arguments)}function m_(e,t,r){e[t]=r}function k_(e,t,r){e[t>>>0]=r}function S_(e,t,r){return e.set(t,r)}function R_(e,t,r){e.set(t,r>>>0)}function K_(e,t,r){e.set(t,r>>>0)}function I_(e,t){e.onabort=t}function C_(e,t){e.onblocked=t}function O_(e,t){e.oncomplete=t}function E_(e,t){e.onerror=t}function D_(e,t){e.onerror=t}function M_(e,t){e.onsuccess=t}function A_(e,t){e.onupgradeneeded=t}function q_(e,t){e.onversionchange=t}function B_(e,t){e.unique=0!==t}function T_(e){return tn.__wrap(e)}function F_(e){return Xr.__wrap(e)}function U_(e){return Zr.__wrap(e)}function V_(e,t){const r=h(t.stack,_.__wbindgen_malloc,_.__wbindgen_realloc),n=w;v().setInt32(e+4,n,!0),v().setInt32(e+0,r,!0)}function P_(){const e=void 0===r.g?null:r.g;return S(e)?0:m(e)}function N_(){const e="undefined"==typeof globalThis?null:globalThis;return S(e)?0:m(e)}function z_(){const e="undefined"==typeof self?null:self;return S(e)?0:m(e)}function x_(){const e="undefined"==typeof window?null:window;return S(e)?0:m(e)}function j_(e){return _n.__wrap(e)}function L_(e){return nn.__wrap(e)}function W_(){return k(function(e){return JSON.stringify(e)},arguments)}function G_(e,t,r){return e.subarray(t>>>0,r>>>0)}function Q_(e){const t=e.target;return S(t)?0:m(t)}function J_(e,t,r){return e.then(t,r)}function H_(e,t){return e.then(t)}function Y_(e){return gn.__wrap(e)}function X_(e){const t=e.transaction;return S(t)?0:m(t)}function $_(){return k(function(e,t,r,n){return e.transaction(p(t,r),oe[n])},arguments)}function Z_(){return k(function(e,t,r){return e.transaction(t,oe[r])},arguments)}function eo(){return k(function(e,t){return e.update(t)},arguments)}function to(e){return vn.__wrap(e)}function ro(e){return kn.__wrap(e)}function no(e){return kn.__unwrap(e)}function io(e){return yn.__wrap(e)}function so(e){return e.value}function _o(){return k(function(e){return e.value},arguments)}function oo(e){return e.values()}function ao(e){return Rn.__wrap(e)}function co(e){return e.version}function go(e){return e.versions}function uo(e,t){e.warn(t)}function lo(e){console.warn(e)}function po(){return[]}function wo(e,t){e.push(t)}function yo(e){return+e}function bo(e){return e}function ho(e){return BigInt.asUintN(64,e)}function fo(e,t){const r="bigint"==typeof t?t:void 0;v().setBigInt64(e+8,S(r)?BigInt(0):r,!0),v().setInt32(e+0,!S(r),!0)}function vo(e){return"boolean"==typeof e?e?1:0:2}function mo(e){const t=e.original;return 1==t.cnt--&&(t.a=0,!0)}function ko(e,t,r){return I(e,t,40,U)}function So(e,t,r){return I(e,t,432,V)}function Ro(e,t,r){return I(e,t,432,P)}function Ko(e,t,r){return C(e,t,437,N)}function Io(e,t,r){return C(e,t,437,z)}function Co(e,t){const r=h(O(t),_.__wbindgen_malloc,_.__wbindgen_realloc),n=w;v().setInt32(e+4,n,!0),v().setInt32(e+0,r,!0)}function Oo(e,t){return e in t}function Eo(){const e=_.__wbindgen_export_4,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)}function Do(e){return"bigint"==typeof e}function Mo(e){return"function"==typeof e}function Ao(e){return null===e}function qo(e){return"object"==typeof e&&null!==e}function Bo(e){return"string"==typeof e}function To(e){return void 0===e}function Fo(e,t){return e===t}function Uo(e,t){return e==t}function Vo(){return _.memory}function Po(e,t){const r="number"==typeof t?t:void 0;v().setFloat64(e+8,S(r)?0:r,!0),v().setInt32(e+0,!S(r),!0)}function No(e){return e}function zo(e,t){const r="string"==typeof t?t:void 0;var n=S(r)?0:h(r,_.__wbindgen_malloc,_.__wbindgen_realloc),i=w;v().setInt32(e+4,i,!0),v().setInt32(e+0,n,!0)}function xo(e,t){return p(e,t)}function jo(e,t){throw new Error(p(e,t))}function Lo(e){let t;try{t=+e}catch(e){t=e}return t}const Wo=new URL(r(9627),r.b);o(new Proxy({},{get(){throw new Error("@matrix-org/matrix-sdk-crypto-wasm was used before it was initialized. Call `initAsync` first.")}}));let Go=null;async function Qo(e=Wo){Go||(Go=async function(e){const{instance:t}=await WebAssembly.instantiateStreaming(fetch(e),{"./matrix_sdk_crypto_wasm_bg.js":n});o(t.exports),t.exports.__wbindgen_start()}(e)),await Go}var Jo=r(4069),Ho=r(6560),Yo=r(9561),Xo=r(6215),$o=r(3840),Zo=r(1815),ea=r(2986),ta=r(2114),ra=r(3883),na=r(8417);class ia{constructor(e,t,r,n,s,_){this.prefixedLogger=e,this.olmMachine=t,this.keyClaimManager=r,this.outgoingRequestManager=n,this.room=s,this.encryptionSettings=_,(0,i.A)(this,"lazyLoadedMembersResolved",!1),(0,i.A)(this,"currentEncryptionPromise",Promise.resolve());var o=s.getJoinedMembers();this.olmMachine.updateTrackedUsers(o.map(e=>new kn(e.userId))).catch(e=>this.prefixedLogger.error("Error initializing tracked users",e))}onCryptoEvent(e){if(JSON.stringify(this.encryptionSettings)!=JSON.stringify(e))throw new Error("Cannot reconfigure an active RoomEncryptor")}onRoomMembership(e){(e.membership==Ho.O.Join||e.membership==Ho.O.Invite&&this.room.shouldEncryptForInvitedMembers())&&this.olmMachine.updateTrackedUsers([new kn(e.userId)]).catch(e=>{this.prefixedLogger.error("Unable to update tracked users",e)})}prepareForEncryption(e,t){var r=this;return(0,s.A)(function*(){yield r.encryptEvent(null,e,t)})()}encryptEvent(e,t,r){var n,i=this,_=new $o.Tl(this.prefixedLogger,e?null!==(n=e.getTxnId())&&void 0!==n?n:"":"prepareForEncryption"),o=this.currentEncryptionPromise.catch(()=>{}).then((0,s.A)(function*(){yield(0,ra.NQ)(_,"ensureEncryptionSession",(0,s.A)(function*(){yield i.ensureEncryptionSession(_,t,r)})),e&&(yield(0,ra.NQ)(_,"encryptEventInner",(0,s.A)(function*(){yield i.encryptEventInner(_,e)})))}));return this.currentEncryptionPromise=o,o}ensureEncryptionSession(e,t,r){var n=this;return(0,s.A)(function*(){if("m.megolm.v1.aes-sha2"!==n.encryptionSettings.algorithm)throw new Error("Cannot encrypt in ".concat(n.room.roomId," for unsupported algorithm '").concat(n.encryptionSettings.algorithm,"'"));e.debug("Starting encryption");var i=yield n.room.getEncryptionTargetMembers();n.lazyLoadedMembersResolved?(e.debug("Processing outgoing requests in background"),n.outgoingRequestManager.doProcessOutgoingRequests()):(yield(0,ra.NQ)(e,"loadMembersIfNeeded: updateTrackedUsers",(0,s.A)(function*(){yield n.olmMachine.updateTrackedUsers(i.map(e=>new kn(e.userId)))})),e.debug("Updated tracked users"),n.lazyLoadedMembersResolved=!0,e.debug("Processing outgoing requests"),yield(0,ra.NQ)(e,"doProcessOutgoingRequests",(0,s.A)(function*(){yield n.outgoingRequestManager.doProcessOutgoingRequests()}))),e.debug("Encrypting for users (shouldEncryptForInvitedMembers: ".concat(n.room.shouldEncryptForInvitedMembers(),"):"),i.map(e=>"".concat(e.userId," (").concat(e.membership,")")));var _=i.map(e=>new kn(e.userId));yield(0,ra.NQ)(e,"ensureSessionsForUsers",(0,s.A)(function*(){yield n.keyClaimManager.ensureSessionsForUsers(e,_)}));var o=new ft;switch(o.historyVisibility=function(e){switch(e){case ta.Jv.Invited:return G.Invited;case ta.Jv.Joined:return G.Joined;case ta.Jv.Shared:return G.Shared;case ta.Jv.WorldReadable:return G.WorldReadable}}(n.room.getHistoryVisibility()),o.algorithm=W.MegolmV1AesSha2,"number"==typeof n.encryptionSettings.rotation_period_ms&&(o.rotationPeriod=BigInt(1e3*n.encryptionSettings.rotation_period_ms)),"number"==typeof n.encryptionSettings.rotation_period_msgs&&(o.rotationPeriodMessages=BigInt(n.encryptionSettings.rotation_period_msgs)),r.kind){case na.YH.AllDevicesIsolationMode:var a,c=null!==(a=n.room.getBlacklistUnverifiedDevices())&&void 0!==a?a:t;o.sharingStrategy=Ke.deviceBasedStrategy(c,r.errorOnVerifiedUserProblems);break;case na.YH.OnlySignedDevicesIsolationMode:o.sharingStrategy=Ke.identityBasedStrategy()}yield(0,ra.NQ)(e,"shareRoomKey",(0,s.A)(function*(){var e=yield n.olmMachine.shareRoomKey(new Cr(n.room.roomId),_,o);if(e)for(var t of e)yield n.outgoingRequestManager.outgoingRequestProcessor.makeOutgoingRequest(t)}))})()}forceDiscardSession(){var e=this;return(0,s.A)(function*(){(yield e.olmMachine.invalidateGroupSession(new Cr(e.room.roomId)))&&e.prefixedLogger.info("Discarded existing group session")})()}encryptEventInner(e,t){var r=this;return(0,s.A)(function*(){e.debug("Encrypting actual message content");var n,i=new Cr(r.room.roomId),s=t.getType(),_=JSON.stringify(t.getContent());n=t.isState()?yield r.olmMachine.encryptStateEvent(i,s,t.getStateKey(),_):yield r.olmMachine.encryptRoomEvent(i,s,_),t.makeEncrypted(ea.Bx.RoomMessageEncrypted,JSON.parse(n),r.olmMachine.identityKeys.curve25519.toBase64(),r.olmMachine.identityKeys.ed25519.toBase64()),e.debug("Encrypted event successfully")})()}}var sa=r(7723),_a=r(6387),oa="/_matrix/client/unstable/org.matrix.msc3814.v1",aa="org.matrix.msc3814";class ca extends _a.X{constructor(e,t,r,n,s){super(),this.logger=e,this.olmMachine=t,this.http=r,this.outgoingRequestProcessor=n,this.secretStorage=s,(0,i.A)(this,"intervalId",void 0)}cacheKey(e){var t=this;return(0,s.A)(function*(){yield t.olmMachine.dehydratedDevices().saveDehydratedDeviceKey(e),t.emit(na.cr.DehydrationKeyCached)})()}isSupported(){var e=this;return(0,s.A)(function*(){try{yield e.http.authedRequest(Zo.IT.Get,"/dehydrated_device",void 0,void 0,{prefix:oa})}catch(e){var t=e;if("M_UNRECOGNIZED"===t.errcode)return!1;if("M_NOT_FOUND"===t.errcode)return!0;throw e}return!0})()}start(){var e=arguments,t=this;return(0,s.A)(function*(){var r=e.length>0&&void 0!==e[0]?e[0]:{};if("boolean"==typeof r&&(r={createNewKey:r}),!r.onlyIfKeyCached||(yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey())){if(t.stop(),!1!==r.rehydrate)try{yield t.rehydrateDeviceIfAvailable()}catch(e){t.logger.info("dehydration: Error rehydrating device:",e),t.emit(na.cr.RehydrationError,e.message)}r.createNewKey&&(yield t.resetKey()),yield t.scheduleDeviceDehydration()}})()}isKeyStored(){var e=this;return(0,s.A)(function*(){return Boolean(yield e.secretStorage.isStored(aa))})()}resetKey(){var e=this;return(0,s.A)(function*(){var t=We.createRandomKey();return yield e.secretStorage.store(aa,t.toBase64()),yield e.cacheKey(t),t})()}getKey(e){var t=this;return(0,s.A)(function*(){var r=yield t.olmMachine.dehydratedDevices().getDehydratedDeviceKey();if(r)return r;var n=yield t.secretStorage.get(aa);if(void 0===n)return e?yield t.resetKey():null;var i=(0,sa.y4)(n);try{var s=We.createKeyFromArray(i);return yield t.cacheKey(s),s}finally{i.fill(0)}})()}rehydrateDeviceIfAvailable(){var e=this;return(0,s.A)(function*(){var t,r=yield e.getKey(!1);if(!r)return!1;try{t=yield e.http.authedRequest(Zo.IT.Get,"/dehydrated_device",void 0,void 0,{prefix:oa})}catch(t){var n=t;if("M_NOT_FOUND"===n.errcode||"M_UNRECOGNIZED"===n.errcode)return e.logger.info("dehydration: No dehydrated device"),!1;throw n}e.logger.info("dehydration: dehydrated device found"),e.emit(na.cr.RehydrationStarted);var i=yield e.olmMachine.dehydratedDevices().rehydrate(r,new Xe(t.device_id),JSON.stringify(t.device_data));e.logger.info("dehydration: device rehydrated");for(var s=void 0,_=0,o=0,a=(0,ra.RR)("/dehydrated_device/$device_id/events",{$device_id:t.device_id});;){var c=yield e.http.authedRequest(Zo.IT.Post,a,void 0,s?{next_batch:s}:{},{prefix:oa});if(0===c.events.length)break;_+=c.events.length,s=c.next_batch,o+=(yield i.receiveEvents(JSON.stringify(c.events))).length,e.emit(na.cr.RehydrationProgress,o,_)}return e.logger.info("dehydration: received ".concat(o," room keys from ").concat(_," to-device events")),e.emit(na.cr.RehydrationCompleted),!0})()}createAndUploadDehydratedDevice(){var e=this;return(0,s.A)(function*(){var t=yield e.getKey(!0),r=yield e.olmMachine.dehydratedDevices().create();e.emit(na.cr.DehydratedDeviceCreated);var n=yield r.keysForUpload("Dehydrated device",t);yield e.outgoingRequestProcessor.makeOutgoingRequest(n),e.emit(na.cr.DehydratedDeviceUploaded),e.logger.info("dehydration: uploaded device")})()}scheduleDeviceDehydration(){var e=this;return(0,s.A)(function*(){e.stop(),yield e.createAndUploadDehydratedDevice(),e.intervalId=setInterval(()=>{e.createAndUploadDehydratedDevice().catch(t=>{e.emit(na.cr.DehydratedDeviceRotationError,t.message),e.logger.error("Error creating dehydrated device:",t)})},6048e5)})()}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}delete(){var e=this;return(0,s.A)(function*(){e.stop();try{yield e.http.authedRequest(Zo.IT.Delete,"/dehydrated_device",void 0,{},{prefix:oa})}catch(e){var t=e;if("M_UNRECOGNIZED"===t.errcode)return;if("M_NOT_FOUND"===t.errcode)return;throw e}})()}}function ga(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}class ua{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.http=r}makeOutgoingRequest(e,t){var r=this;return(0,s.A)(function*(){var n;if(e instanceof Pt)n=yield r.requestWithRetry(Zo.IT.Post,"/_matrix/client/v3/keys/upload",{},e.body);else if(e instanceof Ut)n=yield r.requestWithRetry(Zo.IT.Post,"/_matrix/client/v3/keys/query",{},e.body);else if(e instanceof Tt)n=yield r.requestWithRetry(Zo.IT.Post,"/_matrix/client/v3/keys/claim",{},e.body);else if(e instanceof Xr)n=yield r.requestWithRetry(Zo.IT.Post,"/_matrix/client/v3/keys/signatures/upload",{},e.body);else if(e instanceof qt)n=yield r.requestWithRetry(Zo.IT.Put,"/_matrix/client/v3/room_keys/keys",{version:e.version},e.body);else if(e instanceof gn)n=yield r.sendToDeviceRequest(e);else if(e instanceof Ur){var i="/_matrix/client/v3/rooms/".concat(encodeURIComponent(e.room_id),"/send/")+"".concat(encodeURIComponent(e.event_type),"/").concat(encodeURIComponent(e.txn_id));n=yield r.requestWithRetry(Zo.IT.Put,i,{},e.body)}else{if(e instanceof hn)return void(yield r.makeRequestWithUIA(Zo.IT.Post,"/_matrix/client/v3/keys/device_signing/upload",{},e.body,t));if(e instanceof wr){var _=oa+"/dehydrated_device";return void(yield r.rawJsonRequest(Zo.IT.Put,_,{},e.body))}r.logger.warn("Unsupported outgoing message",Object.getPrototypeOf(e)),n=""}if(e.id)try{yield(0,ra.NQ)(r.logger,"Mark Request as sent ".concat(e.type),(0,s.A)(function*(){yield r.olmMachine.markRequestAsSent(e.id,e.type,n)}))}catch(e){if(!(e instanceof Error)||"Attempt to use a moved value"!==e.message&&"null pointer passed to rust"!==e.message)throw e;r.logger.debug("Ignoring error '".concat(e.message,"': client is likely shutting down"))}else r.logger.trace("Outgoing request type:".concat(e.type," does not have an ID"))})()}sendToDeviceRequest(e){var t=this;return(0,s.A)(function*(){var r=JSON.parse(e.body),n=[];for(var[i,s]of Object.entries(r.messages))for(var[_,o]of Object.entries(s))n.push("".concat(i,"/").concat(_," (msgid ").concat(o[ea.wt],")"));t.logger.info("Sending batch of to-device messages. type=".concat(e.event_type," txnid=").concat(e.txn_id),n);var a="/_matrix/client/v3/sendToDevice/".concat(encodeURIComponent(e.event_type),"/")+encodeURIComponent(e.txn_id);return yield t.requestWithRetry(Zo.IT.Put,a,{},e.body)})()}makeRequestWithUIA(e,t,r,n,_){var o=this;return(0,s.A)(function*(){if(!_)return yield o.requestWithRetry(e,t,r,n);var a=JSON.parse(n),c=function(){var n=(0,s.A)(function*(n){var s=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ga(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ga(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},a);null!==n&&(s.auth=n);var _=yield o.requestWithRetry(e,t,r,JSON.stringify(s));return JSON.parse(_)});return function(e){return n.apply(this,arguments)}}(),g=yield _(c);return JSON.stringify(g)})()}requestWithRetry(e,t,r,n){var i=this;return(0,s.A)(function*(){for(var s=0;;)try{return yield i.rawJsonRequest(e,t,r,n)}catch(e){s++;var _=(0,Zo.fZ)(e,s,!0);if(_<0)throw e;yield(0,ra.yy)(_)}})()}rawJsonRequest(e,t,r,n){var i=this;return(0,s.A)(function*(){return yield i.http.authedRequest(e,t,r,n,{json:!1,headers:{"Content-Type":"application/json",Accept:"application/json"},prefix:"",localTimeoutMs:6e4})})()}}class da{constructor(e,t){this.olmMachine=e,this.outgoingRequestProcessor=t,(0,i.A)(this,"currentClaimPromise",void 0),(0,i.A)(this,"stopped",!1),this.currentClaimPromise=Promise.resolve()}stop(){this.stopped=!0}ensureSessionsForUsers(e,t){var r=this.currentClaimPromise.catch(()=>{}).then(()=>this.ensureSessionsForUsersInner(e,t));return this.currentClaimPromise=r,r}ensureSessionsForUsersInner(e,t){var r=this;return(0,s.A)(function*(){if(r.stopped)throw new Error("Cannot ensure Olm sessions: shutting down");e.info("Checking for missing Olm sessions");var n=yield r.olmMachine.getMissingSessions(t.map(e=>e.clone()));n&&(e.info("Making /keys/claim request"),yield r.outgoingRequestProcessor.makeOutgoingRequest(n)),e.info("Olm sessions prepared")})()}}var la=r(7131);function pa(e,t){var r=new Map;for(var[n,i]of e.keys.entries())r.set(n.toString(),i.toBase64());var s=la.u.Unverified;e.isBlacklisted()?s=la.u.Blocked:e.isVerified()&&(s=la.u.Verified);var _=new Map,o=e.signatures.get(t);if(o){var a=new Map;for(var[c,g]of o.entries())g.isValid()&&g.signature&&a.set(c,g.signature.toBase64());_.set(t.toString(),a)}var u=e.algorithms,d=new Set;return u.forEach(e=>{switch(e){case W.MegolmV1AesSha2:d.add("m.megolm.v1.aes-sha2");break;case W.OlmV1Curve25519AesSha2:default:d.add("m.olm.v1.curve25519-aes-sha2")}}),new la.p({deviceId:e.deviceId.toString(),userId:t.toString(),keys:r,algorithms:Array.from(d),verified:s,signatures:_,displayName:e.displayName,dehydrated:e.isDehydrated})}function wa(e){var t,r=new Map(Object.entries(e.keys)),n=null===(t=e.unsigned)||void 0===t?void 0:t.device_display_name,i=new Map;if(e.signatures)for(var s in e.signatures)i.set(s,new Map(Object.entries(e.signatures[s])));return new la.p({deviceId:e.device_id,userId:e.user_id,keys:r,algorithms:e.algorithms,verified:la.u.Unverified,signatures:i,displayName:n})}var ya=r(7570);class ba{constructor(e,t,r,n){this.logger=e,this.olmMachine=t,this.outgoingRequestProcessor=r,this.secretStorage=n}bootstrapCrossSigning(e){var t=this;return(0,s.A)(function*(){if(e.setupNewCrossSigning)yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);else{var r=yield t.olmMachine.crossSigningStatus(),n=yield t.secretStorage.get("m.cross_signing.master"),i=yield t.secretStorage.get("m.cross_signing.self_signing"),s=yield t.secretStorage.get("m.cross_signing.user_signing"),_=Boolean(n&&i&&s),o=r.hasMaster&&r.hasUserSigning&&r.hasSelfSigning;if(t.logger.debug("bootstrapCrossSigning: starting",{setupNewCrossSigning:e.setupNewCrossSigning,olmDeviceHasMaster:r.hasMaster,olmDeviceHasUserSigning:r.hasUserSigning,olmDeviceHasSelfSigning:r.hasSelfSigning,privateKeysInSecretStorage:_}),o)(yield t.secretStorage.hasKey())?_?t.logger.debug("bootstrapCrossSigning: Olm device has private keys and they are saved in secret storage; doing nothing"):(t.logger.debug("bootstrapCrossSigning: Olm device has private keys: exporting to secret storage"),yield t.exportCrossSigningKeysToStorage()):t.logger.warn("bootstrapCrossSigning: Olm device has private keys, but secret storage is not yet set up; doing nothing for now.");else if(_){t.logger.debug("bootstrapCrossSigning: Cross-signing private keys not found locally, but they are available in secret storage, reading storage and caching locally");var a=yield t.olmMachine.importCrossSigningKeys(n,i,s);if(!a.hasMaster||!a.hasSelfSigning||!a.hasUserSigning)throw new Error("importCrossSigningKeys failed to import the keys");var c=yield t.olmMachine.getDevice(t.olmMachine.userId,t.olmMachine.deviceId);try{var g=yield c.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(g)}finally{c.free()}}else t.logger.debug("bootstrapCrossSigning: Cross-signing private keys not found locally or in secret storage, creating new keys"),yield t.resetCrossSigning(e.authUploadDeviceSigningKeys);t.logger.debug("bootstrapCrossSigning: complete")}})()}resetCrossSigning(e){var t=this;return(0,s.A)(function*(){var r=yield t.olmMachine.bootstrapCrossSigning(!0);for(var n of((yield t.secretStorage.hasKey())?(t.logger.debug("resetCrossSigning: exporting private keys to secret storage"),yield t.exportCrossSigningKeysToStorage()):t.logger.warn("resetCrossSigning: Secret storage is not yet set up; not exporting keys to secret storage yet."),t.logger.debug("resetCrossSigning: publishing public keys to server"),[r.uploadKeysRequest,r.uploadSigningKeysRequest,r.uploadSignaturesRequest]))n&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(n,e))})()}exportCrossSigningKeysToStorage(){var e=this;return(0,s.A)(function*(){var t=yield e.olmMachine.exportCrossSigningKeys();null!=t&&t.masterKey?yield e.secretStorage.store("m.cross_signing.master",t.masterKey):e.logger.error("Cannot export MSK to secret storage, private key unknown"),null!=t&&t.self_signing_key?yield e.secretStorage.store("m.cross_signing.self_signing",t.self_signing_key):e.logger.error("Cannot export SSK to secret storage, private key unknown"),null!=t&&t.userSigningKey?yield e.secretStorage.store("m.cross_signing.user_signing",t.userSigningKey):e.logger.error("Cannot export USK to secret storage, private key unknown")})()}}function ha(e){return fa.apply(this,arguments)}function fa(){return(fa=(0,s.A)(function*(e){return va(e,["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"])})).apply(this,arguments)}function va(e,t){return ma.apply(this,arguments)}function ma(){return(ma=(0,s.A)(function*(e,t){var r=yield e.getDefaultKeyId();if(!r)return!1;for(var n of t)if(!(r in((yield e.isStored(n))||{})))return!1;return!0})).apply(this,arguments)}var ka=r(4400),Sa=r(4831),Ra=function(e){return e.Sas="m.sas.v1",e.ShowQrCode="m.qr_code.show.v1",e.ScanQrCode="m.qr_code.scan.v1",e.Reciprocate="m.reciprocate.v1",e}({});class Ka extends _a.X{constructor(e,t,r,n,_){super(),this.logger=e,this.olmMachine=t,this.inner=r,this.outgoingRequestProcessor=n,this.supportedVerificationMethods=_,(0,i.A)(this,"reEmitter",void 0),(0,i.A)(this,"_accepting",!1),(0,i.A)(this,"_cancelling",!1),(0,i.A)(this,"_verifier",void 0),this.reEmitter=new Sa.Q(this);var o=new WeakRef(this);r.registerChangesCallback((0,s.A)(function*(){var e;return null===(e=o.deref())||void 0===e?void 0:e.onChange()}))}onChange(){var e=this.inner.getVerification();e instanceof zr?void 0===this._verifier||this._verifier instanceof Ca?this.setVerifier(new Oa(e,this,this.outgoingRequestProcessor)):this._verifier instanceof Oa&&this._verifier.replaceInner(e):e instanceof br&&void 0===this._verifier&&this.setVerifier(new Ca(e,this.outgoingRequestProcessor)),this.emit(ka.FM.Change)}setVerifier(e){this._verifier&&this.reEmitter.stopReEmitting(this._verifier,[ka.FM.Change]),this._verifier=e,this.reEmitter.reEmit(this._verifier,[ka.FM.Change])}get transactionId(){return this.inner.flowId}get roomId(){var e;return null===(e=this.inner.roomId)||void 0===e?void 0:e.toString()}get initiatedByMe(){return this.inner.weStarted()}get otherUserId(){return this.inner.otherUserId.toString()}get otherDeviceId(){var e;return null===(e=this.inner.otherDeviceId)||void 0===e?void 0:e.toString()}getOtherDevice(){var e=this;return(0,s.A)(function*(){var t=e.inner.otherDeviceId;if(t)return yield e.olmMachine.getDevice(e.inner.otherUserId,t,5)})()}get isSelfVerification(){return this.inner.isSelfVerification()}get phase(){var e=this.inner.phase();switch(e){case se.Created:case se.Requested:return ka.X9.Requested;case se.Ready:return this._accepting?ka.X9.Requested:ka.X9.Ready;case se.Transitioned:if(!this._verifier)throw new Error("VerificationRequest: inner phase == Transitioned but no verifier!");return this._verifier.verificationPhase;case se.Done:return ka.X9.Done;case se.Cancelled:return ka.X9.Cancelled}throw new Error("Unknown verification phase ".concat(e))}get pending(){if(this.inner.isPassive())return!1;var e=this.phase;return e!==ka.X9.Done&&e!==ka.X9.Cancelled}get accepting(){return this._accepting}get declining(){return this._cancelling}get timeout(){return this.inner.timeRemainingMillis()}get methods(){throw new Error("not implemented")}get chosenMethod(){if(this.phase!==ka.X9.Started)return null;var e=this.inner.getVerification();return e instanceof zr?Ra.Sas:e instanceof br?Ra.Reciprocate:null}otherPartySupportsMethod(e){var t=this.inner.theirSupportedMethods;if(void 0===t)return!1;var r=Ea[e];return t.some(e=>e===r)}accept(){var e=this;return(0,s.A)(function*(){if(e.inner.phase()!==se.Requested||e._accepting)throw new Error("Cannot accept a verification request in phase ".concat(e.phase));e._accepting=!0;try{var t=e.inner.acceptWithMethods(e.supportedVerificationMethods.map(Da));t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))}finally{e._accepting=!1}e.emit(ka.FM.Change)})()}cancel(e){var t=this;return(0,s.A)(function*(){if(!t._cancelling){t.logger.info("Cancelling verification request with params:",e),t._cancelling=!0;try{var r=t.inner.cancel();r&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(r))}finally{t._cancelling=!1}}})()}beginKeyVerification(e,t){throw new Error("not implemented")}startVerification(e){var t=this;return(0,s.A)(function*(){if(e!==Ra.Sas)throw new Error("Unsupported verification method ".concat(e));if(!(yield t.getOtherDevice()))throw new Error("startVerification(): other device is unknown");var r=yield t.inner.startSas();if(r){var[,n]=r;yield t.outgoingRequestProcessor.makeOutgoingRequest(n)}if(!t._verifier)throw new Error("Still no verifier after startSas() call");return t._verifier})()}scanQRCode(e){var t=this;return(0,s.A)(function*(){var r=Sr.fromBytes(e),n=yield t.inner.scanQrCode(r);if(!t._verifier)throw new Error("Still no verifier after scanQrCode() call");var i=n.reciprocate();return i&&(yield t.outgoingRequestProcessor.makeOutgoingRequest(i)),t._verifier})()}get verifier(){return this.phase===ka.X9.Started?this._verifier:void 0}getQRCodeBytes(){throw new Error("getQRCodeBytes() unsupported in Rust Crypto; use generateQRCode() instead.")}generateQRCode(){var e=this;return(0,s.A)(function*(){if(!(yield e.getOtherDevice()))throw new Error("generateQRCode(): other device is unknown");var t=yield e.inner.generateQrCode();if(t)return t.toBytes()})()}get cancellationCode(){var e,t;return null!==(e=null===(t=this.inner.cancelInfo)||void 0===t?void 0:t.cancelCode())&&void 0!==e?e:null}get cancellingUserId(){var e=this.inner.cancelInfo;return e?e.cancelledbyUs()?this.olmMachine.userId.toString():this.inner.otherUserId.toString():void 0}}class Ia extends _a.X{constructor(e,t){super(),this.inner=e,this.outgoingRequestProcessor=t,(0,i.A)(this,"completionDeferred",void 0),this.completionDeferred=Promise.withResolvers();var r=new WeakRef(this);e.registerChangesCallback((0,s.A)(function*(){var e;return null===(e=r.deref())||void 0===e?void 0:e.onChange()})),this.completionDeferred.promise.catch(()=>null)}onChange(){if(this.inner.isDone())this.completionDeferred.resolve(void 0);else if(this.inner.isCancelled()){var e=this.inner.cancelInfo();this.completionDeferred.reject(new Error("Verification cancelled by ".concat(e.cancelledbyUs()?"us":"them"," with code ").concat(e.cancelCode(),": ").concat(e.reason())))}this.emit(ka.FM.Change)}get hasBeenCancelled(){return this.inner.isCancelled()}get userId(){return this.inner.otherUserId.toString()}cancel(e){var t=this.inner.cancel();t&&this.outgoingRequestProcessor.makeOutgoingRequest(t)}getShowSasCallbacks(){return null}getReciprocateQrCodeCallbacks(){return null}}class Ca extends Ia{constructor(e,t){super(e,t),(0,i.A)(this,"callbacks",null)}onChange(){null===this.callbacks&&this.inner.hasBeenScanned()&&(this.callbacks={confirm:()=>{this.confirmScanning()},cancel:()=>this.cancel()}),super.onChange()}verify(){var e=this;return(0,s.A)(function*(){null!==e.callbacks&&e.emit(ka.Ji.ShowReciprocateQr,e.callbacks),yield e.completionDeferred.promise})()}get verificationPhase(){switch(this.inner.state()){case X.Created:return ka.X9.Ready;case X.Scanned:case X.Confirmed:case X.Reciprocated:return ka.X9.Started;case X.Done:return ka.X9.Done;case X.Cancelled:return ka.X9.Cancelled;default:throw new Error("Unknown qr code state ".concat(this.inner.state()))}}getReciprocateQrCodeCallbacks(){return this.callbacks}confirmScanning(){var e=this;return(0,s.A)(function*(){var t=e.inner.confirmScanning();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))})()}}class Oa extends Ia{constructor(e,t,r){super(e,r),(0,i.A)(this,"callbacks",null)}verify(){var e=this;return(0,s.A)(function*(){yield e.sendAccept(),yield e.completionDeferred.promise})()}sendAccept(){var e=this;return(0,s.A)(function*(){var t=e.inner.accept();t&&(yield e.outgoingRequestProcessor.makeOutgoingRequest(t))})()}onChange(){var e,t=this;if(super.onChange(),null===this.callbacks){var r=this.inner.emoji(),n=this.inner.decimals();if(void 0===r&&void 0===n)return;var i={};r&&(i.emoji=r.map(e=>[e.symbol,e.description])),n&&(i.decimal=[n[0],n[1],n[2]]),this.callbacks={sas:i,confirm:(e=(0,s.A)(function*(){var e=yield t.inner.confirm();for(var r of e)yield t.outgoingRequestProcessor.makeOutgoingRequest(r)}),function(){return e.apply(this,arguments)}),mismatch:()=>{var e=this.inner.cancelWithCode("m.mismatched_sas");e&&this.outgoingRequestProcessor.makeOutgoingRequest(e)},cancel:()=>{var e=this.inner.cancelWithCode("m.user");e&&this.outgoingRequestProcessor.makeOutgoingRequest(e)}},this.emit(ka.Ji.ShowSas,this.callbacks)}}get verificationPhase(){return ka.X9.Started}getShowSasCallbacks(){return this.callbacks}replaceInner(e){if(this.inner!=e){this.inner=e;var t=new WeakRef(this);e.registerChangesCallback((0,s.A)(function*(){var e;return null===(e=t.deref())||void 0===e?void 0:e.onChange()})),this.sendAccept(),this.onChange()}}}var Ea={[Ra.Sas]:ie.SasV1,[Ra.ScanQrCode]:ie.QrCodeScanV1,[Ra.ShowQrCode]:ie.QrCodeShowV1,[Ra.Reciprocate]:ie.ReciprocateV1};function Da(e){var t=Ea[e];if(void 0===t)throw new Error("Unknown verification method ".concat(e));return t}class Ma extends _a.X{constructor(e,t,r,n){super(),this.logger=e,this.olmMachine=t,this.http=r,this.outgoingRequestProcessor=n,(0,i.A)(this,"checkedForBackup",!1),(0,i.A)(this,"serverBackupInfo",void 0),(0,i.A)(this,"activeBackupVersion",null),(0,i.A)(this,"stopped",!1),(0,i.A)(this,"backupKeysLoopRunning",!1),(0,i.A)(this,"keyBackupCheckInProgress",null)}stop(){this.stopped=!0}getActiveBackupVersion(){var e=this;return(0,s.A)(function*(){return(yield e.olmMachine.isBackupEnabled())?e.activeBackupVersion:null})()}getServerBackupInfo(){var e=this;return(0,s.A)(function*(){return yield e.checkKeyBackupAndEnable(!1),e.serverBackupInfo})()}isKeyBackupTrusted(e){var t=this;return(0,s.A)(function*(){var r=yield t.olmMachine.verifyBackup(e),n=yield t.olmMachine.getBackupKeys(),i=null==n?void 0:n.decryptionKey;return{matchesDecryptionKey:!!i&&t.backupInfoMatchesBackupDecryptionKey(e,i),trusted:r.trusted()}})()}checkKeyBackupAndEnable(e){return!e&&this.checkedForBackup?Promise.resolve(null):(this.keyBackupCheckInProgress||(this.keyBackupCheckInProgress=this.doCheckKeyBackup().finally(()=>{this.keyBackupCheckInProgress=null})),this.keyBackupCheckInProgress)}handleBackupSecretReceived(e){var t=this;return(0,s.A)(function*(){var r,n;try{n=yield t.requestKeyBackupVersion()}catch(e){return t.logger.warn("handleBackupSecretReceived: Error checking for latest key backup",e),!1}if(null===(r=n)||void 0===r||!r.version)return t.logger.warn("handleBackupSecretReceived: Received a backup decryption key, but there is no trusted server-side key backup"),!1;try{var i=ue.fromBase64(e);return t.backupInfoMatchesBackupDecryptionKey(n,i)?(t.logger.info("handleBackupSecretReceived: A valid backup decryption key has been received and stored in cache."),yield t.saveBackupDecryptionKey(i,n.version),!0):(t.logger.warn("handleBackupSecretReceived: Private decryption key does not match the public key of the current remote backup."),!1)}catch(e){t.logger.warn("handleBackupSecretReceived: Invalid backup decryption key",e)}return!1})()}saveBackupDecryptionKey(e,t){var r=this;return(0,s.A)(function*(){yield r.olmMachine.saveBackupDecryptionKey(e,t),r.emit(na.cr.KeyBackupDecryptionKeyCached,t)})()}importRoomKeys(e,t){var r=this;return(0,s.A)(function*(){yield r.importRoomKeysAsJson(JSON.stringify(e),t)})()}importRoomKeysAsJson(e,t){var r=this;return(0,s.A)(function*(){yield r.olmMachine.importExportedRoomKeys(e,(e,r)=>{var n,i={total:Number(r),successes:Number(e),stage:na.wF.LoadKeys,failures:0};null==t||null===(n=t.progressCallback)||void 0===n||n.call(t,i)})})()}importBackedUpRoomKeys(e,t,r){var n=this;return(0,s.A)(function*(){var i=new Map;for(var s of e){var _=new Cr(s.room_id);i.has(_)||i.set(_,new Map),i.get(_).set(s.session_id,s)}yield n.olmMachine.importBackedUpRoomKeys(i,(e,t,n)=>{var i,s={total:Number(t),successes:Number(e),stage:na.wF.LoadKeys,failures:Number(n)};null==r||null===(i=r.progressCallback)||void 0===i||i.call(r,s)},t)})()}doCheckKeyBackup(){var e=this;return(0,s.A)(function*(){var t;e.logger.debug("Checking key backup status...");try{t=yield e.requestKeyBackupVersion()}catch(t){return e.logger.warn("Error checking for active key backup",t),e.serverBackupInfo=void 0,null}e.checkedForBackup=!0,t&&!t.version&&(e.logger.warn("active backup lacks a useful 'version'; ignoring it"),t=void 0),e.serverBackupInfo=t;var r=yield e.getActiveBackupVersion();if(!t)return null!==r?(e.logger.debug("No key backup present on server: disabling key backup"),yield e.disableKeyBackup()):e.logger.debug("No key backup present on server: not enabling key backup"),null;var n=yield e.isKeyBackupTrusted(t);return n.matchesDecryptionKey||n.trusted?null===r?(e.logger.debug("Found usable key backup v".concat(t.version,": enabling key backups")),yield e.enableKeyBackup(t)):r!==t.version?(e.logger.debug("On backup version ".concat(r," but found version ").concat(t.version,": switching.")),yield e.disableKeyBackup(),yield e.enableKeyBackup(t)):e.logger.debug("Backup version ".concat(t.version," still current")):null!==r?(e.logger.debug("Key backup present on server but not trusted: disabling key backup"),yield e.disableKeyBackup()):e.logger.debug("Key backup present on server but not trusted: not enabling key backup"),{backupInfo:t,trustInfo:n}})()}enableKeyBackup(e){var t=this;return(0,s.A)(function*(){yield t.olmMachine.enableBackupV1(e.auth_data.public_key,e.version),t.activeBackupVersion=e.version,t.emit(na.cr.KeyBackupStatus,!0),t.backupKeysLoop()})()}maybeUploadKey(){var e=this;return(0,s.A)(function*(){null!=e.activeBackupVersion&&e.backupKeysLoop()})()}disableKeyBackup(){var e=this;return(0,s.A)(function*(){yield e.olmMachine.disableBackup(),e.activeBackupVersion=null,e.emit(na.cr.KeyBackupStatus,!1)})()}backupKeysLoop(){var e=arguments,t=this;return(0,s.A)(function*(){var r=e.length>0&&void 0!==e[0]?e[0]:1e4;if(t.backupKeysLoopRunning)t.logger.debug("Backup loop already running");else{t.backupKeysLoopRunning=!0,t.logger.debug("Backup: Starting keys upload loop for backup version:".concat(t.activeBackupVersion,"."));var n=Math.random()*r;yield(0,ra.yy)(n);try{for(var i=0,_=null,o=!0;!t.stopped;){var a=void 0;try{a=yield(0,ra.NQ)(t.logger,"BackupRoomKeys: Get keys to backup from rust crypto-sdk",(0,s.A)(function*(){return yield t.olmMachine.backupRoomKeys()}))}catch(e){t.logger.error("Backup: Failed to get keys to backup from rust crypto-sdk",e)}if(!a||t.stopped||!t.activeBackupVersion)return t.logger.debug("Backup: Ending loop for version ".concat(t.activeBackupVersion,".")),void(a||t.emit(na.cr.KeyBackupSessionsRemaining,0));try{if(yield t.outgoingRequestProcessor.makeOutgoingRequest(a),i=0,t.stopped)break;if(!o&&null===_)try{var c=yield t.olmMachine.roomKeyCounts();_=c.total-c.backedUp}catch(e){t.logger.error("Backup: Failed to get key counts from rust crypto-sdk",e)}if(null!==_){t.emit(na.cr.KeyBackupSessionsRemaining,_);var g=t.keysCountInBatch(a);_=Math.max(_-g,0)}}catch(e){if(i++,t.logger.error("Backup: Error processing backup request for rust crypto-sdk",e),e instanceof Zo.up){var u=e.data.errcode;if("M_NOT_FOUND"==u||"M_WRONG_ROOM_KEYS_VERSION"==u){t.logger.debug("Backup: Failed to upload keys to current vesion: ".concat(u,"."));try{yield t.disableKeyBackup()}catch(e){t.logger.error("Backup: An error occurred while disabling key backup:",e)}return t.emit(na.cr.KeyBackupFailed,e.data.errcode),t.backupKeysLoopRunning=!1,void t.checkKeyBackupAndEnable(!0)}if(e.isRateLimitError())try{var d=e.getRetryAfterMs();if(d&&d>0){yield(0,ra.yy)(d);continue}}catch(e){t.logger.warn("Backup: An error occurred while retrieving a rate-limit retry delay",e)}}yield(0,ra.yy)(1e3*Math.pow(2,Math.min(i-1,4)))}o=!1}}finally{t.backupKeysLoopRunning=!1}}})()}keysCountInBatch(e){return Fa(JSON.parse(e.body))}requestKeyBackupVersion(e){var t=this;return(0,s.A)(function*(){return yield qa(t.http,e)})()}setupKeyBackup(e){var t=this;return(0,s.A)(function*(){yield t.deleteAllKeyBackupVersions();var r=ue.createRandomKey(),n=r.megolmV1PublicKey,i={public_key:n.publicKeyBase64};yield e(i);var s=yield t.http.authedRequest(Zo.IT.Post,"/room_keys/version",void 0,{algorithm:n.algorithm,auth_data:i},{prefix:Zo.iD.V3});return yield t.saveBackupDecryptionKey(r,s.version),{version:s.version,algorithm:n.algorithm,authData:i,decryptionKey:r}})()}deleteAllKeyBackupVersions(){var e=this;return(0,s.A)(function*(){for(var t,r,n=null!==(t=null===(r=yield e.requestKeyBackupVersion())||void 0===r?void 0:r.version)&&void 0!==t?t:null;null!=n;){var i,s;yield e.deleteKeyBackupVersion(n),n=null!==(i=null===(s=yield e.requestKeyBackupVersion())||void 0===s?void 0:s.version)&&void 0!==i?i:null}})()}deleteKeyBackupVersion(e){var t=this;return(0,s.A)(function*(){t.logger.debug("deleteKeyBackupVersion v:".concat(e));var r=(0,ra.RR)("/room_keys/version/$version",{$version:e});yield t.http.authedRequest(Zo.IT.Delete,r,void 0,void 0,{prefix:Zo.iD.V3}),t.activeBackupVersion===e&&(t.serverBackupInfo=null,yield t.disableKeyBackup())})()}createBackupDecryptor(e){return new Aa(this.logger,e)}restoreKeyBackup(e,t,r){var n=this;return(0,s.A)(function*(){var i=yield n.downloadKeyBackup(e);return n.importKeyBackup(i,e,t,r)})()}downloadKeyBackup(e){return this.http.authedRequest(Zo.IT.Get,"/room_keys/keys",{version:e},void 0,{prefix:Zo.iD.V3})}importKeyBackup(e,t,r,n){var i=this;return(0,s.A)(function*(){var _,o=Fa(e),a=0,c=0;null==n||null===(_=n.progressCallback)||void 0===_||_.call(n,{total:o,successes:a,stage:na.wF.LoadKeys,failures:c});var g=function(){var e=(0,s.A)(function*(e){var s,_=[],g=function*(t){(yield r.decryptSessions(e.get(t))).forEach(e=>{e.room_id=t,_.push(e)})};for(var u of e.keys())yield*g(u);try{yield i.importBackedUpRoomKeys(_,t),a+=_.length}catch(e){c+=_.length,i.logger.error("Error importing keys from backup",e)}null==n||null===(s=n.progressCallback)||void 0===s||s.call(n,{total:o,successes:a,stage:na.wF.LoadKeys,failures:c})});return function(t){return e.apply(this,arguments)}}(),u=0,d=new Map;for(var[l,p]of Object.entries(e.rooms))if(p.sessions)for(var[w,y]of(d.set(l,{}),Object.entries(p.sessions)))d.get(l)[w]=y,(u+=1)>=200&&(yield g(d),(d=new Map).set(l,{}),u=0);return u>0&&(yield g(d)),{total:o,imported:a}})()}backupInfoMatchesBackupDecryptionKey(e,t){var r;return"m.megolm_backup.v1.curve25519-aes-sha2"!==e.algorithm?(this.logger.warn("backupMatchesPrivateKey: Unsupported backup algorithm",e.algorithm),!1):(null===(r=e.auth_data)||void 0===r?void 0:r.public_key)===t.megolmV1PublicKey.publicKeyBase64}}class Aa{constructor(e,t){this.logger=e,(0,i.A)(this,"decryptionKey",void 0),(0,i.A)(this,"sourceTrusted",void 0),this.decryptionKey=t,this.sourceTrusted=!1}decryptSessions(e){var t=this;return(0,s.A)(function*(){var r=[];for(var[n,i]of Object.entries(e))try{var s=JSON.parse(t.decryptionKey.decryptV1(i.session_data.ephemeral,i.session_data.mac,i.session_data.ciphertext));s.session_id=n,r.push(s)}catch(e){t.logger.debug("Failed to decrypt megolm session from backup",e,i)}return r})()}free(){this.decryptionKey.free()}}function qa(e,t){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,s.A)(function*(e,t){try{var r=t?(0,ra.RR)("/room_keys/version/$version",{$version:t}):"/room_keys/version";return yield e.authedRequest(Zo.IT.Get,r,void 0,void 0,{prefix:Zo.iD.V3})}catch(e){if("M_NOT_FOUND"===e.errcode)return null;throw e}})).apply(this,arguments)}function Ta(e,t){return t.auth_data.public_key===e.megolmV1PublicKey.publicKeyBase64}function Fa(e){var t=0;for(var{sessions:r}of Object.values(e.rooms))t+=Object.keys(r).length;return t}var Ua=r(5942),Va=r(4575);class Pa{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.outgoingRequestProcessor=r,(0,i.A)(this,"stopped",!1),(0,i.A)(this,"outgoingRequestLoopRunning",!1),(0,i.A)(this,"nextLoopDeferred",void 0)}stop(){this.stopped=!0}doProcessOutgoingRequests(){this.nextLoopDeferred||(this.nextLoopDeferred=Promise.withResolvers());var e=this.nextLoopDeferred.promise;return this.outgoingRequestLoopRunning||this.outgoingRequestLoop().catch(e=>{this.logger.error("Uncaught error in outgoing request loop",e)}),e}outgoingRequestLoop(){var e=this;return(0,s.A)(function*(){if(e.outgoingRequestLoopRunning)throw new Error("Cannot run two outgoing request loops");e.outgoingRequestLoopRunning=!0;try{for(;!e.stopped&&e.nextLoopDeferred;){var t=e.nextLoopDeferred;e.nextLoopDeferred=void 0,yield e.processOutgoingRequests().then(t.resolve,t.reject)}}finally{e.outgoingRequestLoopRunning=!1}e.nextLoopDeferred&&e.nextLoopDeferred.reject(new Error("OutgoingRequestsManager was stopped"))})()}processOutgoingRequests(){var e=this;return(0,s.A)(function*(){if(!e.stopped){var t,r=yield e.olmMachine.outgoingRequests(),n=function*(t){if(e.stopped)return{v:void 0};try{yield(0,ra.NQ)(e.logger,"Make outgoing request ".concat(t.type),(0,s.A)(function*(){yield e.outgoingRequestProcessor.makeOutgoingRequest(t)}))}catch(r){e.logger.error("Failed to process outgoing request ".concat(t.type,": ").concat(r))}};for(var i of r)if(t=yield*n(i))return t.v}})()}}var Na=5e3,za=function(e){return e.MISSING_DECRYPTION_KEY="MISSING_DECRYPTION_KEY",e.NETWORK_ERROR="NETWORK_ERROR",e.STOPPED="STOPPED",e}(za||{});class xa extends Error{constructor(e){super("Failed to get key from backup: ".concat(e)),this.code=e,this.name="KeyDownloadError"}}class ja extends Error{constructor(e){super("Failed to get key from backup: rate limited"),this.retryMillis=e,this.name="KeyDownloadRateLimitError"}}class La{constructor(e,t,r,n){this.olmMachine=t,this.http=r,this.backupManager=n,(0,i.A)(this,"stopped",!1),(0,i.A)(this,"configuration",null),(0,i.A)(this,"sessionLastCheckAttemptedTime",new Map),(0,i.A)(this,"logger",void 0),(0,i.A)(this,"downloadLoopRunning",!1),(0,i.A)(this,"queuedRequests",[]),(0,i.A)(this,"hasConfigurationProblem",!1),(0,i.A)(this,"currentBackupVersionCheck",null),(0,i.A)(this,"onBackupStatusChanged",()=>{this.hasConfigurationProblem=!1,this.configuration=null,this.getOrCreateBackupConfiguration().then(e=>{e&&this.downloadKeysLoop()})}),this.logger=e.getChild("[PerSessionKeyBackupDownloader]"),n.on(na.cr.KeyBackupStatus,this.onBackupStatusChanged),n.on(na.cr.KeyBackupFailed,this.onBackupStatusChanged),n.on(na.cr.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isKeyBackupDownloadConfigured(){return null!==this.configuration}getServerBackupInfo(){var e=this;return(0,s.A)(function*(){return yield e.backupManager.getServerBackupInfo()})()}onDecryptionKeyMissingError(e,t){this.isAlreadyInQueue(e,t)?this.logger.trace("Not checking key backup for session ".concat(t," as it is already queued")):this.wasRequestedRecently(t)?this.logger.trace("Not checking key backup for session ".concat(t," as it was already requested recently")):(this.queuedRequests.push({roomId:e,megolmSessionId:t}),this.downloadKeysLoop())}stop(){this.stopped=!0,this.backupManager.off(na.cr.KeyBackupStatus,this.onBackupStatusChanged),this.backupManager.off(na.cr.KeyBackupFailed,this.onBackupStatusChanged),this.backupManager.off(na.cr.KeyBackupDecryptionKeyCached,this.onBackupStatusChanged)}isAlreadyInQueue(e,t){return this.queuedRequests.some(r=>r.roomId==e&&r.megolmSessionId==t)}markAsNotFoundInBackup(e){var t=Date.now();this.sessionLastCheckAttemptedTime.set(e,t),this.sessionLastCheckAttemptedTime.size>100&&(this.sessionLastCheckAttemptedTime=new Map(Array.from(this.sessionLastCheckAttemptedTime).filter((e,r)=>Math.max(t-r,0)<Na)))}wasRequestedRecently(e){var t=this.sessionLastCheckAttemptedTime.get(e);return!!t&&Math.max(Date.now()-t,0)<Na}getBackupDecryptionKey(){var e=this;return(0,s.A)(function*(){try{return yield e.olmMachine.getBackupKeys()}catch(e){return null}})()}requestRoomKeyFromBackup(e,t,r){var n=this;return(0,s.A)(function*(){var i=(0,ra.RR)("/room_keys/keys/$roomId/$sessionId",{$roomId:t,$sessionId:r});return yield n.http.authedRequest(Zo.IT.Get,i,{version:e},void 0,{prefix:Zo.iD.V3})})()}downloadKeysLoop(){var e=this;return(0,s.A)(function*(){if(!e.downloadLoopRunning&&!e.hasConfigurationProblem){e.downloadLoopRunning=!0;try{for(;e.queuedRequests.length>0;){var t=e.queuedRequests[0];try{var r=yield e.getOrCreateBackupConfiguration();if(!r)return void(e.downloadLoopRunning=!1);var n=yield e.queryKeyBackup(t.roomId,t.megolmSessionId,r);if(e.stopped)return;try{yield e.decryptAndImport(t,n,r)}catch(r){e.logger.error("Error while decrypting and importing key backup for session ".concat(t.megolmSessionId),r)}e.queuedRequests.shift()}catch(r){if(r instanceof xa)switch(r.code){case za.MISSING_DECRYPTION_KEY:e.markAsNotFoundInBackup(t.megolmSessionId),e.queuedRequests.shift();break;case za.NETWORK_ERROR:yield(0,ra.yy)(Na);break;case za.STOPPED:return void(e.downloadLoopRunning=!1)}else r instanceof ja&&(yield(0,ra.yy)(r.retryMillis))}}}finally{e.downloadLoopRunning=!1}}})()}queryKeyBackup(e,t,r){var n=this;return(0,s.A)(function*(){if(n.logger.debug("Checking key backup for session ".concat(t)),n.stopped)throw new xa(za.STOPPED);try{var i=yield n.requestRoomKeyFromBackup(r.backupVersion,e,t);return n.logger.debug("Got key from backup for sessionId:".concat(t)),i}catch(e){if(n.stopped)throw new xa(za.STOPPED);if(n.logger.info("No luck requesting key backup for session ".concat(t,": ").concat(e)),e instanceof Zo.up){if("M_NOT_FOUND"==e.data.errcode)throw new xa(za.MISSING_DECRYPTION_KEY);if(e.isRateLimitError()){var s;try{var _;s=null!==(_=e.getRetryAfterMs())&&void 0!==_?_:void 0}catch(e){n.logger.warn("Error while retrieving a rate-limit retry delay",e)}throw s&&s>0&&n.logger.info("Rate limited by server, waiting ".concat(s,"ms")),new ja(null!=s?s:Na)}}throw new xa(za.NETWORK_ERROR)}})()}decryptAndImport(e,t,r){var n=this;return(0,s.A)(function*(){var i={[e.megolmSessionId]:t},s=yield r.decryptor.decryptSessions(i);for(var _ of s)_.room_id=e.roomId;yield n.backupManager.importBackedUpRoomKeys(s,r.backupVersion)})()}getOrCreateBackupConfiguration(){var e=this;return(0,s.A)(function*(){if(e.configuration)return e.configuration;if(e.hasConfigurationProblem)return null;if(null!=e.currentBackupVersionCheck)return e.logger.debug("Already checking server version, use current promise"),yield e.currentBackupVersionCheck;e.currentBackupVersionCheck=e.internalCheckFromServer();try{return yield e.currentBackupVersionCheck}finally{e.currentBackupVersionCheck=null}})()}internalCheckFromServer(){var e=this;return(0,s.A)(function*(){var t,r,n,i,s=null;try{s=yield e.backupManager.getServerBackupInfo()}catch(t){return e.logger.debug("Backup: error while checking server version: ".concat(t)),e.hasConfigurationProblem=!0,null}if(e.logger.debug("Got current backup version from server: ".concat(null===(t=s)||void 0===t?void 0:t.version)),"m.megolm_backup.v1.curve25519-aes-sha2"!=(null===(r=s)||void 0===r?void 0:r.algorithm))return e.logger.info("Unsupported algorithm ".concat(null===(i=s)||void 0===i?void 0:i.algorithm)),e.hasConfigurationProblem=!0,null;if(null===(n=s)||void 0===n||!n.version)return e.logger.info("No current key backup"),e.hasConfigurationProblem=!0,null;var _=yield e.backupManager.getActiveBackupVersion();if(null==_||s.version!=_)return e.logger.info("The current backup version on the server (".concat(s.version,") is not trusted. Version we are currently backing up to: ").concat(_)),e.hasConfigurationProblem=!0,null;var o=yield e.getBackupDecryptionKey();if(null==o||!o.decryptionKey)return e.logger.debug("Not checking key backup for session (no decryption key)"),e.hasConfigurationProblem=!0,null;if(_!=o.backupVersion)return e.logger.debug("Version for which we have a decryption key (".concat(o.backupVersion,") doesn't match the version we are backing up to (").concat(_,")")),e.hasConfigurationProblem=!0,null;if(s.auth_data.public_key!=o.decryptionKey.megolmV1PublicKey.publicKeyBase64)return e.logger.debug("Key backup on server does not match our decryption key"),e.hasConfigurationProblem=!0,null;var a=e.backupManager.createBackupDecryptor(o.decryptionKey);return e.hasConfigurationProblem=!1,e.configuration={decryptor:a,backupVersion:_},e.configuration})()}}var Wa=r(6344);function Ga(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Qa(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ga(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ga(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var Ja=[Ra.Sas,Ra.ScanQrCode,Ra.ShowQrCode,Ra.Reciprocate];class Ha extends _a.X{constructor(e,t,r,n,s,_,o){var a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];super(),this.logger=e,this.olmMachine=t,this.http=r,this.userId=n,this.secretStorage=_,this.cryptoCallbacks=o,this.enableEncryptedStateEvents=a,(0,i.A)(this,"RECOVERY_KEY_DERIVATION_ITERATIONS",5e5),(0,i.A)(this,"_trustCrossSignedDevices",!0),(0,i.A)(this,"deviceIsolationMode",new na.ux(!1)),(0,i.A)(this,"stopped",!1),(0,i.A)(this,"roomEncryptors",{}),(0,i.A)(this,"eventDecryptor",void 0),(0,i.A)(this,"keyClaimManager",void 0),(0,i.A)(this,"outgoingRequestProcessor",void 0),(0,i.A)(this,"crossSigningIdentity",void 0),(0,i.A)(this,"backupManager",void 0),(0,i.A)(this,"outgoingRequestsManager",void 0),(0,i.A)(this,"perSessionBackupDownloader",void 0),(0,i.A)(this,"dehydratedDeviceManager",void 0),(0,i.A)(this,"reemitter",new Sa.Q(this)),(0,i.A)(this,"globalBlacklistUnverifiedDevices",!1),(0,i.A)(this,"_supportedVerificationMethods",Ja),this.outgoingRequestProcessor=new ua(e,t,r),this.outgoingRequestsManager=new Pa(this.logger,t,this.outgoingRequestProcessor),this.keyClaimManager=new da(t,this.outgoingRequestProcessor),this.backupManager=new Ma(e,t,r,this.outgoingRequestProcessor),this.perSessionBackupDownloader=new La(this.logger,this.olmMachine,this.http,this.backupManager),this.dehydratedDeviceManager=new ca(this.logger,t,r,this.outgoingRequestProcessor,_),this.eventDecryptor=new Ya(this.logger,t,this.perSessionBackupDownloader),this.reemitter.reEmit(this.backupManager,[na.cr.KeyBackupStatus,na.cr.KeyBackupSessionsRemaining,na.cr.KeyBackupFailed,na.cr.KeyBackupDecryptionKeyCached]),this.reemitter.reEmit(this.dehydratedDeviceManager,[na.cr.DehydratedDeviceCreated,na.cr.DehydratedDeviceUploaded,na.cr.RehydrationStarted,na.cr.RehydrationProgress,na.cr.RehydrationCompleted,na.cr.RehydrationError,na.cr.DehydrationKeyCached,na.cr.DehydratedDeviceRotationError]),this.crossSigningIdentity=new ba(e,t,this.outgoingRequestProcessor,_),this.checkKeyBackupAndEnable()}getOlmMachineOrThrow(){if(this.stopped)throw new Va.LA;return this.olmMachine}set globalErrorOnUnknownDevices(e){}get globalErrorOnUnknownDevices(){return!1}stop(){this.stopped||(this.stopped=!0,this.keyClaimManager.stop(),this.backupManager.stop(),this.outgoingRequestsManager.stop(),this.perSessionBackupDownloader.stop(),this.dehydratedDeviceManager.stop(),this.olmMachine.close())}encryptEvent(e,t){var r=this;return(0,s.A)(function*(){var t=e.getRoomId(),n=r.roomEncryptors[t];if(!n)throw new Error("Cannot encrypt event in unconfigured room ".concat(t));yield n.encryptEvent(e,r.globalBlacklistUnverifiedDevices,r.deviceIsolationMode)})()}decryptEvent(e){var t=this;return(0,s.A)(function*(){if(!e.getRoomId())throw new Error("to-device event was not decrypted in preprocessToDeviceMessages");return yield t.eventDecryptor.attemptEventDecryption(e,t.deviceIsolationMode)})()}getBackupDecryptor(e,t){var r=this;return(0,s.A)(function*(){if(!(t instanceof Uint8Array))throw new Error("getBackupDecryptor: expects Uint8Array");if("m.megolm_backup.v1.curve25519-aes-sha2"!=e.algorithm)throw new Error("getBackupDecryptor: Unsupported algorithm ".concat(e.algorithm));var n=ue.fromBase64((0,sa.WG)(t));if(!Ta(n,e))throw new Error("getBackupDecryptor: key backup on server does not match the decryption key");return r.backupManager.createBackupDecryptor(n)})()}importBackedUpRoomKeys(e,t,r){var n=this;return(0,s.A)(function*(){return yield n.backupManager.importBackedUpRoomKeys(e,t,r)})()}maybeAcceptKeyBundle(e,t){var r=this;return(0,s.A)(function*(){var n=new $o.Tl(r.logger,"maybeAcceptKeyBundle(".concat(e,", ").concat(t,")"));n.info("Checking inviter cross-signing keys");var i=r.olmMachine.queryKeysForUsers([new kn(t)]);yield r.outgoingRequestProcessor.makeOutgoingRequest(i);var s=yield r.olmMachine.getReceivedRoomKeyBundleData(new Cr(e),new kn(t));if(s){n.info("Fetching key bundle ".concat(s.url));var _,o=(0,Wa.y)(r.http.opts.baseUrl,s.url,void 0,void 0,void 0,!1,!0,!0);try{var a=new URL(o);_=yield r.http.authedRequest(Zo.IT.Get,a.pathname+a.search,{},void 0,{rawResponseBody:!0,prefix:""})}catch(e){throw n.warn("Error downloading encrypted bundle from ".concat(o,":"),e),e}n.info("Received blob of length ".concat(_.size));try{yield r.olmMachine.receiveRoomKeyBundle(s,new Uint8Array(yield _.arrayBuffer()))}catch(e){throw n.warn("Error receiving encrypted bundle:",e),e}}else n.info("No key bundle found for user")})()}getVersion(){var e=T();return"Rust SDK ".concat(e.matrix_sdk_crypto," (").concat(e.git_sha,"), Vodozemac ").concat(e.vodozemac)}setDeviceIsolationMode(e){this.deviceIsolationMode=e}isEncryptionEnabledInRoom(e){var t=this;return(0,s.A)(function*(){var r=yield t.olmMachine.getRoomSettings(new Cr(e));return Boolean(null==r?void 0:r.algorithm)})()}isStateEncryptionEnabledInRoom(e){var t=this;return(0,s.A)(function*(){var r=yield t.olmMachine.getRoomSettings(new Cr(e));return Boolean(null==r?void 0:r.encryptStateEvents)})()}getOwnDeviceKeys(){var e=this;return(0,s.A)(function*(){var t=e.olmMachine.identityKeys;return{ed25519:t.ed25519.toBase64(),curve25519:t.curve25519.toBase64()}})()}prepareToEncrypt(e){var t=this.roomEncryptors[e.roomId];t&&t.prepareForEncryption(this.globalBlacklistUnverifiedDevices,this.deviceIsolationMode)}forceDiscardSession(e){var t;return null===(t=this.roomEncryptors[e])||void 0===t?void 0:t.forceDiscardSession()}exportRoomKeys(){var e=this;return(0,s.A)(function*(){var t=yield e.olmMachine.exportRoomKeys(()=>!0);return JSON.parse(t)})()}exportRoomKeysAsJson(){var e=this;return(0,s.A)(function*(){return yield e.olmMachine.exportRoomKeys(()=>!0)})()}importRoomKeys(e,t){var r=this;return(0,s.A)(function*(){return yield r.backupManager.importRoomKeys(e,t)})()}importRoomKeysAsJson(e,t){var r=this;return(0,s.A)(function*(){return yield r.backupManager.importRoomKeysAsJson(e,t)})()}userHasCrossSigningKeys(){var e=arguments,t=this;return(0,s.A)(function*(){var r,n=e.length>0&&void 0!==e[0]?e[0]:t.userId,i=e.length>1&&void 0!==e[1]&&e[1],s=yield t.olmMachine.trackedUsers();for(var _ of s)if(n===_.toString()){r=_;break}if(void 0!==r){if(n===t.userId){var o=t.olmMachine.queryKeysForUsers([r.clone()]);yield t.outgoingRequestProcessor.makeOutgoingRequest(o)}var a=yield t.olmMachine.getIdentity(r);return null==a||a.free(),void 0!==a}if(i){var c,g=null===(c=(yield t.downloadDeviceList(new Set([n]))).master_keys)||void 0===c?void 0:c[n];return!!g&&Boolean(Object.values(g.keys)[0])}return!1})()}getUserDeviceInfo(e){var t=arguments,r=this;return(0,s.A)(function*(){var n=t.length>1&&void 0!==t[1]&&t[1],i=new Map,s=yield r.getOlmMachineOrThrow().trackedUsers(),_=new Set;s.forEach(e=>_.add(e.toString()));var o=new Set;for(var a of e)_.has(a)?i.set(a,yield r.getUserDevices(a)):o.add(a);if(n&&o.size>=1){var c=yield r.downloadDeviceList(o);Object.entries(c.device_keys).forEach(e=>{var[t,r]=e;return i.set(t,function(e){return new Map(Object.entries(e).map(e=>{var[t,r]=e;return[t,wa(r)]}))}(r))})}return i})()}getUserDevices(e){var t=this;return(0,s.A)(function*(){var r=new kn(e),n=yield t.olmMachine.getUserDevices(r,1);try{var i=n.devices();try{return new Map(i.map(e=>[e.deviceId.toString(),pa(e,r)]))}finally{i.forEach(e=>e.free())}}finally{n.free()}})()}downloadDeviceList(e){var t=this;return(0,s.A)(function*(){var r={device_keys:{}};return e.forEach(e=>r.device_keys[e]=[]),yield t.http.authedRequest(Zo.IT.Post,"/_matrix/client/v3/keys/query",void 0,r,{prefix:""})})()}getTrustCrossSignedDevices(){return this._trustCrossSignedDevices}setTrustCrossSignedDevices(e){this._trustCrossSignedDevices=e}setDeviceVerified(e,t){var r=arguments,n=this;return(0,s.A)(function*(){var i=!(r.length>2&&void 0!==r[2])||r[2],s=yield n.olmMachine.getDevice(new kn(e),new Xe(t));if(!s)throw new Error("Unknown device ".concat(e,"|").concat(t));try{yield s.setLocalTrust(i?Q.Verified:Q.Unset)}finally{s.free()}})()}crossSignDevice(e){var t=this;return(0,s.A)(function*(){var r=yield t.olmMachine.getDevice(new kn(t.userId),new Xe(e));if(!r)throw new Error("Unknown device ".concat(e));try{var n=yield r.verify();yield t.outgoingRequestProcessor.makeOutgoingRequest(n)}finally{r.free()}})()}getDeviceVerificationStatus(e,t){var r=this;return(0,s.A)(function*(){var n=yield r.olmMachine.getDevice(new kn(e),new Xe(t));if(!n)return null;try{return new na.wc({signedByOwner:n.isCrossSignedByOwner(),crossSigningVerified:n.isCrossSigningTrusted(),localVerified:n.isLocallyTrusted(),trustCrossSignedDevices:r._trustCrossSignedDevices})}finally{n.free()}})()}getUserVerificationStatus(e){var t=this;return(0,s.A)(function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new kn(e));if(void 0===r)return new na.L0(!1,!1,!1);var n=r.isVerified(),i=r.wasPreviouslyVerified(),s=r instanceof Xt&&r.identityNeedsUserApproval();return r.free(),new na.L0(n,i,!1,s)})()}pinCurrentUserIdentity(e){var t=this;return(0,s.A)(function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new kn(e));if(void 0===r)throw new Error("Cannot pin identity of unknown user");if(r instanceof tr)throw new Error("Cannot pin identity of own user");yield r.pinCurrentMasterKey()})()}withdrawVerificationRequirement(e){var t=this;return(0,s.A)(function*(){var r=yield t.getOlmMachineOrThrow().getIdentity(new kn(e));if(void 0===r)throw new Error("Cannot withdraw verification of unknown user");yield r.withdrawVerification()})()}isCrossSigningReady(){var e=this;return(0,s.A)(function*(){var{privateKeysInSecretStorage:t,privateKeysCachedLocally:r}=yield e.getCrossSigningStatus(),n=Boolean(r.masterKey)&&Boolean(r.selfSigningKey)&&Boolean(r.userSigningKey),i=yield e.getOwnIdentity();return!(null==i||!i.isVerified())&&(n||t)})()}getCrossSigningKeyId(){var e=arguments,t=this;return(0,s.A)(function*(){var r=e.length>0&&void 0!==e[0]?e[0]:na.nX.Master,n=yield t.olmMachine.getIdentity(new kn(t.userId));if(!n)return null;try{var i,s=yield t.olmMachine.crossSigningStatus();if(!(s.hasMaster&&s.hasUserSigning&&s.hasSelfSigning))return null;if(!n.isVerified())return null;switch(r){case na.nX.Master:i=n.masterKey;break;case na.nX.SelfSigning:i=n.selfSigningKey;break;case na.nX.UserSigning:i=n.userSigningKey;break;default:return null}var _=JSON.parse(i);return Object.values(_.keys)[0]}finally{n.free()}})()}bootstrapCrossSigning(e){var t=this;return(0,s.A)(function*(){yield t.crossSigningIdentity.bootstrapCrossSigning(e)})()}isSecretStorageReady(){var e=this;return(0,s.A)(function*(){var t=["m.cross_signing.master","m.cross_signing.user_signing","m.cross_signing.self_signing"];return null!=(yield e.backupManager.getActiveBackupVersion())&&t.push("m.megolm_backup.v1"),va(e.secretStorage,t)})()}bootstrapSecretStorage(){var e=arguments,t=this;return(0,s.A)(function*(){var{createSecretStorageKey:r,setupNewSecretStorage:n,setupNewKeyBackup:i}=e.length>0&&void 0!==e[0]?e[0]:{},s=n||!(yield t.secretStorageHasAESKey());if(s){if(!r)throw new Error("unable to create a new secret storage key, createSecretStorageKey is not set");t.logger.info("bootstrapSecretStorage: creating new secret storage key");var _=yield r();if(!_)throw new Error("createSecretStorageKey() callback did not return a secret storage key");yield t.addSecretStorageKeyToSecretStorage(_)}var o=yield t.olmMachine.exportCrossSigningKeys();!(o&&void 0!==o.masterKey&&void 0!==o.self_signing_key&&void 0!==o.userSigningKey)||!s&&(yield ha(t.secretStorage))||(t.logger.info("bootstrapSecretStorage: cross-signing keys not yet exported; doing so now."),yield t.secretStorage.store("m.cross_signing.master",o.masterKey),yield t.secretStorage.store("m.cross_signing.user_signing",o.userSigningKey),yield t.secretStorage.store("m.cross_signing.self_signing",o.self_signing_key)),i?yield t.resetKeyBackup():yield t.saveBackupKeyToStorage()})()}saveBackupKeyToStorage(){var e=this;return(0,s.A)(function*(){var t=yield e.backupManager.getServerBackupInfo();if(t&&t.version){var r=yield e.olmMachine.getBackupKeys();if(r.decryptionKey)if(Ta(r.decryptionKey,t)){var n=r.decryptionKey.toBase64();yield e.secretStorage.store("m.megolm_backup.v1",n)}else e.logger.info("Not saving backup key to secret storage: decryption key does not match backup info");else e.logger.info("Not saving backup key to secret storage: no backup key")}else e.logger.info("Not saving backup key to secret storage: no backup info")})()}addSecretStorageKeyToSecretStorage(e){var t=this;return(0,s.A)(function*(){var r,n,i,s,_=yield t.secretStorage.addKey(ya.SECRET_STORAGE_ALGORITHM_V1_AES,{passphrase:null===(r=e.keyInfo)||void 0===r?void 0:r.passphrase,name:null===(n=e.keyInfo)||void 0===n?void 0:n.name,key:e.privateKey});yield t.secretStorage.setDefaultKeyId(_.keyId),null===(i=(s=t.cryptoCallbacks).cacheSecretStorageKey)||void 0===i||i.call(s,_.keyId,_.keyInfo,e.privateKey)})()}secretStorageHasAESKey(){var e=this;return(0,s.A)(function*(){var t=yield e.secretStorage.getKey();if(!t)return!1;var[,r]=t;return r.algorithm===ya.SECRET_STORAGE_ALGORITHM_V1_AES})()}getCrossSigningStatus(){var e=this;return(0,s.A)(function*(){var t=yield e.getOlmMachineOrThrow().getIdentity(new kn(e.userId)),r=Boolean(null==t?void 0:t.masterKey)&&Boolean(null==t?void 0:t.selfSigningKey)&&Boolean(null==t?void 0:t.userSigningKey);null==t||t.free();var n=yield ha(e.secretStorage),i=yield e.getOlmMachineOrThrow().crossSigningStatus();return{publicKeysOnDevice:r,privateKeysInSecretStorage:n,privateKeysCachedLocally:{masterKey:Boolean(null==i?void 0:i.hasMaster),userSigningKey:Boolean(null==i?void 0:i.hasUserSigning),selfSigningKey:Boolean(null==i?void 0:i.hasSelfSigning)}}})()}createRecoveryKeyFromPassphrase(e){var t=this;return(0,s.A)(function*(){if(e){var r=(0,Ua.US)(32),n=yield(0,na.wn)(e,r,t.RECOVERY_KEY_DERIVATION_ITERATIONS);return{keyInfo:{passphrase:{algorithm:"m.pbkdf2",iterations:t.RECOVERY_KEY_DERIVATION_ITERATIONS,salt:r}},privateKey:n,encodedPrivateKey:(0,na.jS)(n)}}var i=new Uint8Array(32);return globalThis.crypto.getRandomValues(i),{privateKey:i,encodedPrivateKey:(0,na.jS)(i)}})()}getEncryptionInfoForEvent(e){var t=this;return(0,s.A)(function*(){return t.eventDecryptor.getEncryptionInfoForEvent(e)})()}getVerificationRequestsToDeviceInProgress(e){return this.olmMachine.getVerificationRequests(new kn(e)).filter(e=>void 0===e.roomId&&!e.isCancelled()).map(e=>this.makeVerificationRequest(e))}findVerificationRequestDMInProgress(e,t){if(!t)throw new Error("missing userId");var r=this.olmMachine.getVerificationRequests(new kn(t)).find(t=>{var r;return(null===(r=t.roomId)||void 0===r?void 0:r.toString())===e&&!t.isCancelled()});if(r)return this.makeVerificationRequest(r)}requestVerificationDM(e,t){var r=this;return(0,s.A)(function*(){var n=yield r.olmMachine.getIdentity(new kn(e));if(!n)throw new Error("unknown userId ".concat(e));try{var i=r._supportedVerificationMethods.map(e=>Da(e)),s=yield n.verificationRequestContent(i),_=JSON.parse(s);_.msgtype="m.key.verification.request";var o=JSON.stringify(_),a=yield r.sendVerificationRequestContent(t,o),c=yield n.requestVerification(new Cr(t),new St(a),i);return r.makeVerificationRequest(c)}finally{n.free()}})()}sendVerificationRequestContent(e,t){var r=this;return(0,s.A)(function*(){var n=(0,Ua.US)(32),{event_id:i}=yield r.http.authedRequest(Zo.IT.Put,"/_matrix/client/v3/rooms/".concat(encodeURIComponent(e),"/send/m.room.message/").concat(encodeURIComponent(n)),void 0,t,{prefix:""});return i})()}setSupportedVerificationMethods(e){this._supportedVerificationMethods=null!=e?e:Ja}requestOwnUserVerification(){var e=this;return(0,s.A)(function*(){var t=yield e.olmMachine.getIdentity(new kn(e.userId));if(void 0===t)throw new Error("cannot request verification for this device when there is no existing cross-signing key");try{var[r,n]=yield t.requestVerification(e._supportedVerificationMethods.map(Da));return yield e.outgoingRequestProcessor.makeOutgoingRequest(n),e.makeVerificationRequest(r)}finally{t.free()}})()}requestDeviceVerification(e,t){var r=this;return(0,s.A)(function*(){var n=yield r.olmMachine.getDevice(new kn(e),new Xe(t));if(!n)throw new Error("Not a known device");try{var[i,s]=n.requestVerification(r._supportedVerificationMethods.map(Da));return yield r.outgoingRequestProcessor.makeOutgoingRequest(s),r.makeVerificationRequest(i)}finally{n.free()}})()}getSessionBackupPrivateKey(){var e=this;return(0,s.A)(function*(){var t=yield e.olmMachine.getBackupKeys();return t.decryptionKey?(0,sa.y4)(t.decryptionKey.toBase64()):null})()}storeSessionBackupPrivateKey(e,t){var r=this;return(0,s.A)(function*(){var n=(0,sa.WG)(e);if(!t)throw new Error("storeSessionBackupPrivateKey: version is required");yield r.backupManager.saveBackupDecryptionKey(ue.fromBase64(n),t)})()}loadSessionBackupPrivateKeyFromSecretStorage(){var e=this;return(0,s.A)(function*(){var t=yield e.secretStorage.get("m.megolm_backup.v1");if(!t)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: missing decryption key in secret storage");var r=yield e.backupManager.getServerBackupInfo();if(!r||!r.version)throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: unable to get backup version");var n=ue.fromBase64(t);if(!Ta(n,r))throw new Error("loadSessionBackupPrivateKeyFromSecretStorage: decryption key does not match backup info");yield e.backupManager.saveBackupDecryptionKey(n,r.version)})()}getActiveSessionBackupVersion(){var e=this;return(0,s.A)(function*(){return yield e.backupManager.getActiveBackupVersion()})()}getKeyBackupInfo(){var e=this;return(0,s.A)(function*(){return(yield e.backupManager.getServerBackupInfo())||null})()}isKeyBackupTrusted(e){var t=this;return(0,s.A)(function*(){return yield t.backupManager.isKeyBackupTrusted(e)})()}checkKeyBackupAndEnable(){var e=this;return(0,s.A)(function*(){return yield e.backupManager.checkKeyBackupAndEnable(!0)})()}deleteKeyBackupVersion(e){var t=this;return(0,s.A)(function*(){yield t.backupManager.deleteKeyBackupVersion(e)})()}resetKeyBackup(){var e=this;return(0,s.A)(function*(){var t=yield e.backupManager.setupKeyBackup(t=>e.signObject(t));(yield e.secretStorageHasAESKey())&&(yield e.secretStorage.store("m.megolm_backup.v1",t.decryptionKey.toBase64())),e.checkKeyBackupAndEnable()})()}disableKeyStorage(){var e=this;return(0,s.A)(function*(){var t=yield e.getKeyBackupInfo();null!=t&&t.version?yield e.deleteKeyBackupVersion(t.version):e.logger.error("Can't delete key backup version: no version available"),yield e.deleteSecretStorage(),yield e.dehydratedDeviceManager.delete()})()}signObject(e){var t=this;return(0,s.A)(function*(){var r=new Map(Object.entries(e.signatures||{})),n=e.unsigned;delete e.signatures,delete e.unsigned;var i=r.get(t.userId)||{},s=Jo.stringify(e),_=yield t.olmMachine.sign(s),o=JSON.parse(_.asJSON());r.set(t.userId,Qa(Qa({},i),o[t.userId])),void 0!==n&&(e.unsigned=n),e.signatures=Object.fromEntries(r.entries())})()}restoreKeyBackupWithPassphrase(e,t){var r=this;return(0,s.A)(function*(){var n=yield r.backupManager.getServerBackupInfo();if(null==n||!n.version)throw new Error("No backup info available");var i=yield function(e,t){if(!e.private_key_salt||!e.private_key_iterations)throw new Error("Salt and/or iterations not found: this backup cannot be restored with a passphrase");return(0,na.wn)(t,e.private_key_salt,e.private_key_iterations,e.private_key_bits)}(n.auth_data,e);return yield r.storeSessionBackupPrivateKey(i,n.version),r.restoreKeyBackup(t)})()}restoreKeyBackup(e){var t=this;return(0,s.A)(function*(){var r=yield t.olmMachine.getBackupKeys(),{decryptionKey:n,backupVersion:i}=r;if(!n||!i)throw new Error("No decryption key found in crypto store");var s=(0,sa.y4)(n.toBase64()),_=yield t.backupManager.requestKeyBackupVersion(i);if(!_)throw new Error("Backup version to restore ".concat(i," not found on server"));var o=yield t.getBackupDecryptor(_,s);try{var a;return null==e||null===(a=e.progressCallback)||void 0===a||a.call(e,{stage:na.wF.Fetch}),yield t.backupManager.restoreKeyBackup(i,o,e)}finally{o.free()}})()}isDehydrationSupported(){var e=this;return(0,s.A)(function*(){return yield e.dehydratedDeviceManager.isSupported()})()}startDehydration(){var e=arguments,t=this;return(0,s.A)(function*(){var r=e.length>0&&void 0!==e[0]?e[0]:{};if(!(yield t.isCrossSigningReady())||!(yield t.isSecretStorageReady()))throw new Error("Device dehydration requires cross-signing and secret storage to be set up");return yield t.dehydratedDeviceManager.start(r||{})})()}importSecretsBundle(e){var t=this;return(0,s.A)(function*(){var r=jr.from_json(e);yield t.getOlmMachineOrThrow().importSecretsBundle(r)})()}exportSecretsBundle(){var e=this;return(0,s.A)(function*(){var t=yield e.getOlmMachineOrThrow().exportSecretsBundle(),r=t.to_json();return t.free(),r})()}encryptToDeviceMessages(e,t,r){var n=this;return(0,s.A)(function*(){var i=new $o.Tl(n.logger,"encryptToDeviceMessages"),_=new Set(t.map(e=>{var{userId:t}=e;return t}));yield n.keyClaimManager.ensureSessionsForUsers(i,Array.from(_).map(e=>new kn(e)));var o={batch:[],eventType:ea.Bx.RoomMessageEncrypted};return yield Promise.all(t.map(function(){var t=(0,s.A)(function*(t){var{userId:i,deviceId:s}=t,_=yield n.olmMachine.getDevice(new kn(i),new Xe(s));if(_){var a=JSON.parse(yield _.encryptToDeviceEvent(e,r));o.batch.push({deviceId:s,userId:i,payload:a})}else n.logger.warn("encryptToDeviceMessages: unknown device ".concat(i,":").concat(s))});return function(e){return t.apply(this,arguments)}}())),o})()}resetEncryption(e){var t=this;return(0,s.A)(function*(){t.logger.debug("resetEncryption: resetting encryption"),t.dehydratedDeviceManager.delete(),yield t.backupManager.deleteAllKeyBackupVersions(),yield t.deleteSecretStorage(),yield t.crossSigningIdentity.bootstrapCrossSigning({setupNewCrossSigning:!0,authUploadDeviceSigningKeys:e}),yield t.resetKeyBackup(),t.logger.debug("resetEncryption: ended")})()}deleteSecretStorage(){var e=this;return(0,s.A)(function*(){yield e.secretStorage.store("m.cross_signing.master",null),yield e.secretStorage.store("m.cross_signing.self_signing",null),yield e.secretStorage.store("m.cross_signing.user_signing",null),yield e.secretStorage.store("m.megolm_backup.v1",null);var t=yield e.secretStorage.getDefaultKeyId();t&&(yield e.secretStorage.store("m.secret_storage.key.".concat(t),null)),yield e.secretStorage.setDefaultKeyId(null)})()}shareRoomHistoryWithUser(e,t){var r=this;return(0,s.A)(function*(){var n=new $o.Tl(r.logger,"shareRoomHistoryWithUser(".concat(e,", ").concat(t,")")),i=yield r.getOwnIdentity();if(null!=i&&i.isVerified()){n.info("Sharing message history");var s=yield r.getOlmMachineOrThrow().buildRoomKeyBundle(new Cr(e));if(s){var _=yield r.http.uploadContent(s.encryptedData);n.info("Uploaded encrypted key blob: ".concat(JSON.stringify(_)));var o=r.getOlmMachineOrThrow().queryKeysForUsers([new kn(t)]);yield r.outgoingRequestProcessor.makeOutgoingRequest(o),yield r.keyClaimManager.ensureSessionsForUsers(n,[new kn(t)]);var a=yield r.getOlmMachineOrThrow().shareRoomKeyBundleData(new kn(t),new Cr(e),_.content_uri,s.mediaEncryptionInfo,Ke.identityBasedStrategy());for(var c of a)yield r.outgoingRequestProcessor.makeOutgoingRequest(c)}else n.info("No keys to share")}else n.warn("Not sharing message history as the current device is not verified by our cross-signing identity")})()}receiveSyncChanges(e){var t=this;return(0,s.A)(function*(){var{events:r,oneTimeKeysCounts:n=new Map,unusedFallbackKeys:i,devices:s=new st}=e;return yield t.olmMachine.receiveSyncChanges(r?JSON.stringify(r):"[]",s,n,i)})()}preprocessToDeviceMessages(e){var t=this;return(0,s.A)(function*(){var r=yield t.receiveSyncChanges({events:e}),n=[];for(var i of r){var s=JSON.parse(i.rawEvent);if(s.type===ea.Bx.KeyVerificationRequest){var _=s.sender,o=s.content.transaction_id;o&&_&&t.onIncomingKeyVerificationRequest(_,o)}switch(i.type){case H.Decrypted:var a,c=i.encryptionInfo;n.push({message:s,encryptionInfo:{sender:c.sender.toString(),senderDevice:null===(a=c.senderDevice)||void 0===a?void 0:a.toString(),senderCurve25519KeyBase64:c.senderCurve25519Key,senderVerified:c.isSenderVerified()}});break;case H.PlainText:n.push({message:s,encryptionInfo:null});case H.UnableToDecrypt:case H.Invalid:}}return n})()}processKeyCounts(e,t){var r=this;return(0,s.A)(function*(){var n=e&&new Map(Object.entries(e)),i=t&&new Set(t);void 0===n&&void 0===i||(yield r.receiveSyncChanges({oneTimeKeysCounts:n,unusedFallbackKeys:i}))})()}processDeviceLists(e){var t=this;return(0,s.A)(function*(){var r,n,i=new st(null===(r=e.changed)||void 0===r?void 0:r.map(e=>new kn(e)),null===(n=e.left)||void 0===n?void 0:n.map(e=>new kn(e)));yield t.receiveSyncChanges({devices:i})})()}onCryptoEvent(e,t){var r=this;return(0,s.A)(function*(){var n=t.getContent(),i=new Pr;if("m.megolm.v1.aes-sha2"===n.algorithm){i.algorithm=W.MegolmV1AesSha2,n["io.element.msc3414.encrypt_state_events"]&&r.enableEncryptedStateEvents&&(r.logger.info("crypto Enabling state event encryption..."),i.encryptStateEvents=!0);try{i.sessionRotationPeriodMs=n.rotation_period_ms,i.sessionRotationPeriodMessages=n.rotation_period_msgs,yield r.olmMachine.setRoomSettings(new Cr(e.roomId),i)}catch(t){return void r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event which caused error: ").concat(t))}var s=r.roomEncryptors[e.roomId];s?s.onCryptoEvent(n):r.roomEncryptors[e.roomId]=new ia(r.logger.getChild("[".concat(e.roomId," encryption]")),r.olmMachine,r.keyClaimManager,r.outgoingRequestsManager,e,n)}else r.logger.warn("Room ".concat(e.roomId,": ignoring crypto event with invalid algorithm ").concat(n.algorithm))})()}onSyncCompleted(e){this.outgoingRequestsManager.doProcessOutgoingRequests().catch(e=>{this.logger.warn("onSyncCompleted: Error processing outgoing requests",e)})}markAllTrackedUsersAsDirty(){var e=this;return(0,s.A)(function*(){yield e.olmMachine.markAllTrackedUsersAsDirty()})()}onIncomingKeyVerificationRequest(e,t){var r=this.olmMachine.getVerificationRequest(new kn(e),t);r?this.emit(na.cr.VerificationRequestReceived,this.makeVerificationRequest(r)):this.logger.info("Ignoring just-received verification request ".concat(t," which did not start a rust-side verification"))}makeVerificationRequest(e){return new Ka(this.logger,this.olmMachine,e,this.outgoingRequestProcessor,this._supportedVerificationMethods)}onRoomMembership(e,t,r){var n=this.roomEncryptors[e.getRoomId()];n&&n.onRoomMembership(t)}onRoomKeysUpdated(e){var t=this;return(0,s.A)(function*(){for(var r of e)t.onRoomKeyUpdated(r);t.backupManager.maybeUploadKey()})()}onRoomKeyUpdated(e){var t=this;if(!this.stopped){this.logger.debug("Got update for session ".concat(e.sessionId," from sender ").concat(e.senderKey.toBase64()," in ").concat(e.roomId.toString()));var r=this.eventDecryptor.getEventsPendingRoomKey(e.roomId.toString(),e.sessionId);if(0!==r.length){this.logger.debug("Retrying decryption on events:",r.map(e=>"".concat(e.getId())));var n=function(e){e.attemptDecryption(t,{isRetry:!0}).catch(r=>{t.logger.info("Still unable to decrypt event ".concat(e.getId()," after receiving key"))})};for(var i of r)n(i)}}}onRoomKeysWithheld(e){var t=this;return(0,s.A)(function*(){for(var r of e){t.logger.debug("Got withheld message for session ".concat(r.sessionId," in ").concat(r.roomId.toString()));var n=t.eventDecryptor.getEventsPendingRoomKey(r.roomId.toString(),r.sessionId);if(0===n.length)return;for(var i of(t.logger.debug("Retrying decryption on events:",n.map(e=>"".concat(e.getId()))),n))i.attemptDecryption(t,{isRetry:!0}).catch(e=>{})}})()}onUserIdentityUpdated(e){var t=this;return(0,s.A)(function*(){var r=yield t.getUserVerificationStatus(e.toString());t.emit(na.cr.UserTrustStatusChanged,e.toString(),r),e.toString()===t.userId&&(t.emit(na.cr.KeysChanged,{}),yield t.checkKeyBackupAndEnable())})()}onDevicesUpdated(e){var t=this;return(0,s.A)(function*(){t.emit(na.cr.WillUpdateDevices,e,!1),t.emit(na.cr.DevicesUpdated,e,!1)})()}handleSecretReceived(e,t){var r=this;return(0,s.A)(function*(){return r.logger.debug("onReceiveSecret: Received secret ".concat(e)),"m.megolm_backup.v1"===e&&(yield r.backupManager.handleBackupSecretReceived(t))})()}checkSecrets(e){var t=this;return(0,s.A)(function*(){var r=yield t.olmMachine.getSecretsFromInbox(e);for(var n of r)if(yield t.handleSecretReceived(e,n))break;yield t.olmMachine.deleteSecretsFromInbox(e)})()}onLiveEventFromSync(e){var t=this;return(0,s.A)(function*(){if(!e.isState()&&!e.getUnsigned().transaction_id){var r=function(){var r=(0,s.A)(function*(r){(function(e){switch(e.getType()){case ea.Bx.KeyVerificationCancel:case ea.Bx.KeyVerificationDone:case ea.Bx.KeyVerificationMac:case ea.Bx.KeyVerificationStart:case ea.Bx.KeyVerificationKey:case ea.Bx.KeyVerificationReady:case ea.Bx.KeyVerificationAccept:return!0;case ea.Bx.RoomMessage:return e.getContent().msgtype===ea.Wr.KeyVerificationRequest;default:return!1}})(e)&&(yield t.onKeyVerificationEvent(r))});return function(e){return r.apply(this,arguments)}}();if(e.isDecryptionFailure()||e.isEncrypted()){var n=setTimeout(()=>e.off(Yo.OQ.Decrypted,i),3e5),i=(t,s)=>{s||(clearTimeout(n),e.off(Yo.OQ.Decrypted,i),r(t))};e.on(Yo.OQ.Decrypted,i)}else yield r(e)}})()}onKeyVerificationEvent(e){var t=this;return(0,s.A)(function*(){var r=e.getRoomId();if(!r)throw new Error("missing roomId in the event");t.logger.debug("Incoming verification event ".concat(e.getId()," type ").concat(e.getType()," from ").concat(e.getSender())),yield t.olmMachine.receiveVerificationEvent(JSON.stringify({event_id:e.getId(),type:e.getType(),sender:e.getSender(),state_key:e.getStateKey(),content:e.getContent(),origin_server_ts:e.getTs()}),new Cr(r)),e.getType()===ea.Bx.RoomMessage&&e.getContent().msgtype===ea.Wr.KeyVerificationRequest&&t.onIncomingKeyVerificationRequest(e.getSender(),e.getId()),t.outgoingRequestsManager.doProcessOutgoingRequests().catch(e=>{t.logger.warn("onKeyVerificationRequest: Error processing outgoing requests",e)})})()}getOwnIdentity(){var e=this;return(0,s.A)(function*(){return yield e.olmMachine.getIdentity(new kn(e.userId))})()}}class Ya{constructor(e,t,r){this.logger=e,this.olmMachine=t,this.perSessionBackupDownloader=r,(0,i.A)(this,"eventsPendingKey",new ra.kG(()=>new ra.kG(()=>new Set)))}attemptEventDecryption(e,t){var r=this;return(0,s.A)(function*(){var n;switch(r.addEventToPendingList(e),t.kind){case na.YH.AllDevicesIsolationMode:n=ne.Untrusted;break;case na.YH.OnlySignedDevicesIsolationMode:n=ne.CrossSignedOrLegacy}try{var i=yield r.olmMachine.decryptRoomEvent(Xa(e),new Cr(e.getRoomId()),new ze(n));return r.removeEventFromPendingList(e),{clearEvent:JSON.parse(i.event),claimedEd25519Key:i.senderClaimedEd25519Key,senderCurve25519Key:i.senderCurve25519Key,forwardingCurve25519KeyChain:i.forwardingCurve25519KeyChain}}catch(t){if(!(t instanceof jt))throw new Xo.O(na.RT.UNKNOWN_ERROR,"Unknown error");r.onMegolmDecryptionError(e,t,yield r.perSessionBackupDownloader.getServerBackupInfo())}})()}onMegolmDecryptionError(e,t,r){var n=e.getWireContent(),i={sender_key:n.sender_key,session_id:n.session_id};if(t.code===x.MissingRoomKey||t.code===x.UnknownMessageIndex){this.perSessionBackupDownloader.onDecryptionKeyMissingError(e.getRoomId(),n.session_id);var s=e.getMembershipAtEvent();if(s&&s!==Ho.O.Join&&s!==Ho.O.Invite)throw new Xo.O(na.RT.HISTORICAL_MESSAGE_USER_NOT_JOINED,"This message was sent when we were not a member of the room.",i);if(e.getTs()<=this.olmMachine.deviceCreationTimeMs)throw null===r?new Xo.O(na.RT.HISTORICAL_MESSAGE_NO_KEY_BACKUP,"This message was sent before this device logged in, and there is no key backup on the server.",i):this.perSessionBackupDownloader.isKeyBackupDownloadConfigured()?new Xo.O(na.RT.HISTORICAL_MESSAGE_WORKING_BACKUP,"This message was sent before this device logged in. Key backup is working, but we still do not (yet) have the key.",i):new Xo.O(na.RT.HISTORICAL_MESSAGE_BACKUP_UNCONFIGURED,"This message was sent before this device logged in, and key backup is not working.",i)}if(t.maybe_withheld){var _="The sender has disabled encrypting to unverified devices."===t.maybe_withheld?na.RT.MEGOLM_KEY_WITHHELD_FOR_UNVERIFIED_DEVICE:na.RT.MEGOLM_KEY_WITHHELD;throw new Xo.O(_,t.maybe_withheld,i)}switch(t.code){case x.MissingRoomKey:throw new Xo.O(na.RT.MEGOLM_UNKNOWN_INBOUND_SESSION_ID,"The sender's device has not sent us the keys for this message.",i);case x.UnknownMessageIndex:throw new Xo.O(na.RT.OLM_UNKNOWN_MESSAGE_INDEX,"The sender's device has not sent us the keys for this message at this index.",i);case x.SenderIdentityVerificationViolation:throw this.removeEventFromPendingList(e),new Xo.O(na.RT.SENDER_IDENTITY_PREVIOUSLY_VERIFIED,"The sender identity is unverified, but was previously verified.");case x.UnknownSenderDevice:throw this.removeEventFromPendingList(e),new Xo.O(na.RT.UNKNOWN_SENDER_DEVICE,"The sender device is not known.");case x.UnsignedSenderDevice:throw this.removeEventFromPendingList(e),new Xo.O(na.RT.UNSIGNED_SENDER_DEVICE,"The sender identity is not cross-signed.");default:throw new Xo.O(na.RT.UNKNOWN_ERROR,t.description,i)}}getEncryptionInfoForEvent(e){var t=this;return(0,s.A)(function*(){if(!e.getClearContent()||e.isDecryptionFailure())return null;if(null!==e.status)return{shieldColour:na.so.NONE,shieldReason:null};var r=yield t.olmMachine.getRoomEventEncryptionInfo(Xa(e),new Cr(e.getRoomId()));return function(e,t){if(void 0===t)return null;var r,n,i=t.shieldState(!1);switch(i.color){case Z.Grey:r=na.so.GREY;break;case Z.None:r=na.so.NONE;break;default:r=na.so.RED}switch(i.code){case void 0:case null:n=null;break;case ee.AuthenticityNotGuaranteed:n=na.uV.AUTHENTICITY_NOT_GUARANTEED;break;case ee.UnknownDevice:n=na.uV.UNKNOWN_DEVICE;break;case ee.UnsignedDevice:n=na.uV.UNSIGNED_DEVICE;break;case ee.UnverifiedIdentity:n=na.uV.UNVERIFIED_IDENTITY;break;case ee.SentInClear:n=na.uV.SENT_IN_CLEAR;break;case ee.VerificationViolation:n=na.uV.VERIFICATION_VIOLATION;break;case ee.MismatchedSender:n=na.uV.MISMATCHED_SENDER;break;default:n=na.uV.UNKNOWN}return{shieldColour:r,shieldReason:n}}(t.logger,r)})()}getEventsPendingRoomKey(e,t){var r=this.eventsPendingKey.get(e);if(!r)return[];var n=r.get(t);return n?[...n]:[]}addEventToPendingList(e){var t=e.getRoomId();t&&this.eventsPendingKey.getOrCreate(t).getOrCreate(e.getWireContent().session_id).add(e)}removeEventFromPendingList(e){var t=e.getRoomId();if(t){var r=this.eventsPendingKey.getOrCreate(t);if(r){var n=r.get(e.getWireContent().session_id);n&&(n.delete(e),0===n.size&&(r.delete(e.getWireContent().session_id),0===r.size&&this.eventsPendingKey.delete(t)))}}}}function Xa(e){return JSON.stringify({event_id:e.getId(),type:e.getWireType(),sender:e.getSender(),state_key:e.getStateKey(),content:e.getWireContent(),origin_server_ts:e.getTs()})}var $a=r(4303),Za=r(5530),ec=r(5542);function tc(){return tc=(0,s.A)(function*(e){var t,{logger:r,legacyStore:n}=e;if(yield Qo(),yield n.containsData()){yield n.startup();var i=null;if(yield n.doTxn("readonly",[Za.y.STORE_ACCOUNT],e=>{n.getAccount(e,e=>{i=e})}),i){var s=yield n.getMigrationState();if(!(s>=$a.Il.MEGOLM_SESSIONS_MIGRATED)){var _=yield function(e,t){return nc.apply(this,arguments)}(r,n),o=yield function(e,t){return ic.apply(this,arguments)}(r,n),a=1+_+o;r.info("Migrating data from legacy crypto store. ".concat(_," olm sessions and ").concat(o," megolm sessions to migrate."));var c=0;u(0);var g=(new TextEncoder).encode(e.legacyPickleKey);s===$a.Il.NOT_STARTED&&(r.info("Migrating data from legacy crypto store. Step 1: base data"),yield function(e,t,r,n,i,s,_){return rc.apply(this,arguments)}(e.http,e.userId,e.deviceId,n,g,e.storeHandle,r),s=$a.Il.INITIAL_DATA_MIGRATED,yield n.setMigrationState(s)),u(1),s===$a.Il.INITIAL_DATA_MIGRATED&&(r.info("Migrating data from legacy crypto store. Step 2: olm sessions (".concat(_," sessions to migrate).")),yield function(e,t,r,n,i){return sc.apply(this,arguments)}(r,n,g,e.storeHandle,u),s=$a.Il.OLM_SESSIONS_MIGRATED,yield n.setMigrationState(s)),s===$a.Il.OLM_SESSIONS_MIGRATED&&(r.info("Migrating data from legacy crypto store. Step 3: megolm sessions (".concat(o," sessions to migrate).")),yield function(e,t,r,n,i){return _c.apply(this,arguments)}(r,n,g,e.storeHandle,u),s=$a.Il.MEGOLM_SESSIONS_MIGRATED,yield n.setMigrationState(s)),null===(t=e.legacyMigrationProgressListener)||void 0===t||t.call(e,-1,-1),r.info("Migration from legacy crypto store complete")}}else r.debug("Legacy crypto store is not set up (no account found). Not migrating.")}function u(t){var r;c+=t,null===(r=e.legacyMigrationProgressListener)||void 0===r||r.call(e,c,a)}}),tc.apply(this,arguments)}function rc(){return(rc=(0,s.A)(function*(e,t,r,n,i,s,_){var o=new fe;o.userId=new kn(t),o.deviceId=new Xe(r),yield n.doTxn("readonly",[Za.y.STORE_ACCOUNT],e=>n.getAccount(e,e=>{o.pickledAccount=null!=e?e:""}));var a=yield ac(n,i,"m.megolm_backup.v1");if(a){for(var c=!1,g=null;!c;)try{g=yield qa(e),c=!0}catch(e){_.info("Failed to get backup version during migration, retrying in 2 seconds",e),yield(0,ra.yy)(2e3)}if(g&&"m.megolm_backup.v1.curve25519-aes-sha2"==g.algorithm)try{var u,d=ue.fromBase64(a),l=null===(u=g.auth_data)||void 0===u?void 0:u.public_key;d.megolmV1PublicKey.publicKeyBase64==l?(o.backupVersion=g.version,o.backupRecoveryKey=a):_.debug("The backup key to migrate does not match the active backup version","Cached pub key: ".concat(d.megolmV1PublicKey.publicKeyBase64),"Active pub key: ".concat(l))}catch(e){_.warn("Failed to check if the backup key to migrate matches the active backup version",e)}}o.privateCrossSigningMasterKey=yield ac(n,i,"master"),o.privateCrossSigningSelfSigningKey=yield ac(n,i,"self_signing"),o.privateCrossSigningUserSigningKey=yield ac(n,i,"user_signing"),yield Qt.migrateBaseData(o,i,s,_)})).apply(this,arguments)}function nc(){return(nc=(0,s.A)(function*(e,t){var r;return e.debug("Counting olm sessions to be migrated"),yield t.doTxn("readonly",[Za.y.STORE_SESSIONS],e=>t.countEndToEndSessions(e,e=>r=e)),r})).apply(this,arguments)}function ic(){return(ic=(0,s.A)(function*(e,t){return e.debug("Counting megolm sessions to be migrated"),yield t.countEndToEndInboundGroupSessions()})).apply(this,arguments)}function sc(){return(sc=(0,s.A)(function*(e,t,r,n,i){for(;;){var s=yield t.getEndToEndSessionsBatch();if(null===s)return;e.debug("Migrating batch of ".concat(s.length," olm sessions"));var _=[];for(var o of s){var a=new sr;a.senderKey=o.deviceKey,a.pickle=o.session,a.lastUseTime=a.creationTime=new Date(o.lastReceivedMessageTs),_.push(a)}yield Qt.migrateOlmSessions(_,r,n,e),yield t.deleteEndToEndSessionsBatch(s),i(s.length)}})).apply(this,arguments)}function _c(){return(_c=(0,s.A)(function*(e,t,r,n,i){for(;;){var s=yield t.getEndToEndInboundGroupSessionsBatch();if(null===s)return;e.debug("Migrating batch of ".concat(s.length," megolm sessions"));var _=[];for(var o of s){var a,c=o.sessionData,g=new nr;g.pickle=c.session,g.roomId=new Cr(c.room_id),g.senderKey=o.senderKey,g.senderSigningKey=null===(a=c.keysClaimed)||void 0===a?void 0:a.ed25519,g.backedUp=!o.needsBackup,g.imported=!0===c.untrusted,_.push(g)}yield Qt.migrateMegolmSessions(_,r,n,e),yield t.deleteEndToEndInboundGroupSessionsBatch(s),i(s.length)}})).apply(this,arguments)}function oc(){return(oc=(0,s.A)(function*(e){var{logger:t,legacyStore:r,olmMachine:n}=e;if((yield r.containsData())&&!((yield r.getMigrationState())>=$a.Il.ROOM_SETTINGS_MIGRATED)){var i={};for(var[s,_]of(yield r.doTxn("readwrite",[Za.y.STORE_ROOMS],e=>{r.getEndToEndRooms(e,e=>{i=e})}),t.debug("Migrating ".concat(Object.keys(i).length," sets of room settings")),Object.entries(i)))try{var o=new Pr;if("m.megolm.v1.aes-sha2"!==_.algorithm){t.warn("Room ".concat(s,": ignoring room with invalid algorithm ").concat(_.algorithm));continue}o.algorithm=W.MegolmV1AesSha2,o.sessionRotationPeriodMs=_.rotation_period_ms,o.sessionRotationPeriodMessages=_.rotation_period_msgs,yield n.setRoomSettings(new Cr(s),o)}catch(e){t.warn("Room ".concat(s,": ignoring settings ").concat(JSON.stringify(_)," which caused error ").concat(e))}t.debug("Completed room settings migration"),yield r.setMigrationState($a.Il.ROOM_SETTINGS_MIGRATED)}})).apply(this,arguments)}function ac(e,t,r){return cc.apply(this,arguments)}function cc(){return(cc=(0,s.A)(function*(e,t,r){var n=yield new Promise(t=>{e.doTxn("readonly",[Za.y.STORE_ACCOUNT],n=>{e.getSecretStorePrivateKey(n,t,r)})});return n&&n.ciphertext&&n.iv&&n.mac?yield(0,ec.A)(n,t,r):n instanceof Uint8Array?(0,sa.WG)(n):void 0})).apply(this,arguments)}function gc(){return gc=(0,s.A)(function*(e){var{legacyCryptoStore:t,rustCrypto:r,logger:n}=e,i=yield r.getOwnIdentity();if(i&&!i.isVerified()){var s=yield function(e){return uc.apply(this,arguments)}(t);if(s){var _=JSON.parse(i.masterKey);if(_.keys&&0!==Object.keys(_.keys).length){var o=Object.values(_.keys)[0];o&&o==s&&(n.info("Post Migration: Migrating legacy trusted MSK: ".concat(s," to locally verified.")),yield i.verify())}else n.error("Post Migration | Unexpected error: no master key in the rust session.")}}}),gc.apply(this,arguments)}function uc(){return(uc=(0,s.A)(function*(e){var t=null;return yield e.doTxn("readonly","account",r=>{e.getCrossSigningKeys(r,e=>{var r=null==e?void 0:e.master;r&&0!=Object.keys(r.keys).length&&(t=Object.values(r.keys)[0])})}),t})).apply(this,arguments)}function dc(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function lc(e){return pc.apply(this,arguments)}function pc(){return pc=(0,s.A)(function*(e){var t,{logger:r}=e;r.debug("Initialising Rust crypto-sdk WASM artifact"),yield Qo(),r.debug("Opening Rust CryptoStore"),t=e.storePrefix?e.storeKey?yield nn.openWithKey(e.storePrefix,e.storeKey,r):yield nn.open(e.storePrefix,e.storePassphrase,r):yield nn.open(null,null,r),e.legacyCryptoStore&&(yield function(e){return tc.apply(this,arguments)}(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dc(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dc(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({legacyStore:e.legacyCryptoStore,storeHandle:t},e)));var n=yield function(e,t,r,n,i,s,_,o,a){return wc.apply(this,arguments)}(r,e.http,e.userId,e.deviceId,e.secretStorage,e.cryptoCallbacks,t,e.legacyCryptoStore,e.enableEncryptedStateEvents);return t.free(),r.debug("Completed rust crypto-sdk setup"),n}),pc.apply(this,arguments)}function wc(){return wc=(0,s.A)(function*(e,t,r,n,i,s,_,o,a){e.debug("Init OlmMachine");var c=yield Ht.initFromStore(new kn(r),new Xe(n),_,e);o&&(yield function(e){return oc.apply(this,arguments)}({logger:e,legacyStore:o,olmMachine:c})),c.roomKeyRequestsEnabled=!1;var g=new Ha(e,c,t,r,n,i,s,a);if(yield c.registerRoomKeyUpdatedCallback(e=>g.onRoomKeysUpdated(e)),yield c.registerRoomKeysWithheldCallback(e=>g.onRoomKeysWithheld(e)),yield c.registerUserIdentityUpdatedCallback(e=>g.onUserIdentityUpdated(e)),yield c.registerDevicesUpdatedCallback(e=>g.onDevicesUpdated(e)),g.checkSecrets("m.megolm_backup.v1"),yield c.registerReceiveSecretCallback((e,t)=>g.checkSecrets(e)),yield c.outgoingRequests(),o&&(yield o.containsData())&&(yield o.getMigrationState())<$a.Il.INITIAL_OWN_KEY_QUERY_DONE){e.debug("Performing initial key query after migration");for(var u=!1;!u;)try{yield g.userHasCrossSigningKeys(r),u=!0}catch(t){e.error("Failed to check for cross-signing keys after migration, retrying",t)}yield function(e){return gc.apply(this,arguments)}({legacyCryptoStore:o,rustCrypto:g,logger:e}),yield o.setMigrationState($a.Il.INITIAL_OWN_KEY_QUERY_DONE)}return g}),wc.apply(this,arguments)}},4069:e=>{for(var t=/[\\\"\x00-\x1F]/g,r={},n=0;n<32;++n)r[String.fromCharCode(n)]="\\U"+("0000"+n.toString(16)).slice(-4).toUpperCase();function i(e){return t.lastIndex=0,e.replace(t,function(e){return r[e]})}r["\b"]="\\b",r["\t"]="\\t",r["\n"]="\\n",r["\f"]="\\f",r["\r"]="\\r",r['"']='\\"',r["\\"]="\\\\",e.exports={stringify:function e(t){switch(typeof t){case"string":return'"'+i(t)+'"';case"number":return isFinite(t)?t:"null";case"boolean":return t;case"object":return null===t?"null":Array.isArray(t)?function(t){for(var r="[",n="",i=0;i<t.length;++i)n+=r,r=",",n+=e(t[i]);return","!=r?"[]":n+"]"}(t):function(t){var r="{",n="",s=Object.keys(t);s.sort();for(var _=0;_<s.length;++_){var o=s[_];n+=r+'"'+i(o)+'":',r=",",n+=e(t[o])}return","!=r?"{}":n+"}"}(t);default:throw new Error("Cannot stringify: "+typeof t)}}}},9627:(e,t,r)=>{e.exports=r.p+"1f6e9ab2edc928a2d45a.wasm"}}]);